var De=Object.defineProperty;var Fe=(s,e,t)=>e in s?De(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var y=(s,e,t)=>Fe(s,typeof e!="symbol"?e+"":e,t);import{r as ze,a as Oe,g as _e}from"./react-DavUf6mE.js";import{c as Be,r as h,R as Ue}from"./zustand-YjDNudvZ.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();var ue={exports:{}},X={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ve;function Ge(){if(ve)return X;ve=1;var s=ze(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,n=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function o(l,a,d){var u,m={},f=null,g=null;d!==void 0&&(f=""+d),a.key!==void 0&&(f=""+a.key),a.ref!==void 0&&(g=a.ref);for(u in a)r.call(a,u)&&!i.hasOwnProperty(u)&&(m[u]=a[u]);if(l&&l.defaultProps)for(u in a=l.defaultProps,a)m[u]===void 0&&(m[u]=a[u]);return{$$typeof:e,type:l,key:f,ref:g,props:m,_owner:n.current}}return X.Fragment=t,X.jsx=o,X.jsxs=o,X}var Se;function He(){return Se||(Se=1,ue.exports=Ge()),ue.exports}var c=He(),Q={},we;function Je(){if(we)return Q;we=1;var s=Oe();return Q.createRoot=s.createRoot,Q.hydrateRoot=s.hydrateRoot,Q}var We=Je();const Xe=_e(We),V=class V{constructor(){y(this,"performanceMetrics",{lastRenderTime:0,averageRenderTime:0,renderCount:0})}static getPresetRule(e){const t=V.PRESET_RULES[e];return{birth:[...t.birth],survival:[...t.survival],notation:t.notation}}static getAllPresetRules(){return Object.entries(V.PRESET_RULES).map(([e,t])=>({id:e,name:e.charAt(0).toUpperCase()+e.slice(1),birth:[...t.birth],survival:[...t.survival],notation:t.notation}))}countNeighbors(e,t,r,n,i){let o=0;const l=t-1,a=r-1,d=n>0?-1:0,u=n<l?1:0,m=i>0?-1:0,f=i<a?1:0;for(let g=m;g<=f;g++){const S=(i+g)*t;for(let R=d;R<=u;R++)R===0&&g===0||(o+=e[S+n+R]??0)}return o}computeNextGeneration(e,t,r,n){const i=performance.now(),o=new Uint8Array(e.length),l=new Set(n.birth),a=new Set(n.survival);for(let u=0;u<r;u++){const m=u*t;for(let f=0;f<t;f++){const g=m+f,S=this.countNeighbors(e,t,r,f,u);e[g]===1?o[g]=a.has(S)?1:0:o[g]=l.has(S)?1:0}}const d=performance.now();return this.updatePerformanceMetrics(d-i),o}updatePerformanceMetrics(e){this.performanceMetrics.lastRenderTime=e,this.performanceMetrics.renderCount++;const t=.1;this.performanceMetrics.renderCount===1?this.performanceMetrics.averageRenderTime=e:this.performanceMetrics.averageRenderTime=t*e+(1-t)*this.performanceMetrics.averageRenderTime}getPerformanceMetrics(){return{...this.performanceMetrics}}resetPerformanceMetrics(){this.performanceMetrics={lastRenderTime:0,averageRenderTime:0,renderCount:0}}static validateGridBounds(e,t){return e>=20&&e<=200&&t>=20&&t<=200&&e*t<=4e4}static copyGrid(e){return new Uint8Array(e)}};y(V,"PRESET_RULES",{conway:{birth:[3],survival:[2,3],notation:"B3/S23"},highlife:{birth:[3,6],survival:[2,3],notation:"B36/S23"},seeds:{birth:[2],survival:[],notation:"B2/S"},daynight:{birth:[3,6,7,8],survival:[3,4,6,7,8],notation:"B3678/S34678"}});let he=V;var me=(s=>(s.CANVAS_UNSUPPORTED="canvas_unsupported",s.MEMORY_EXCEEDED="memory_exceeded",s.INVALID_RULE="invalid_rule",s.PATTERN_TOO_LARGE="pattern_too_large",s.IMPORT_FAILED="import_failed",s))(me||{});class Me{static validateRule(e){if(!e||typeof e!="string")return{valid:!1,error:"Rule notation must be a non-empty string"};const t=e.trim();if(t==="")return{valid:!1,error:"Rule notation cannot be empty"};const r=/^B([0-8]*)\/S([0-8]*)$/,n=t.match(r);if(!n)return{valid:!1,error:'Invalid format. Use B/S notation like "B3/S23" (numbers 0-8 only)'};const i=n[1]??"",o=n[2]??"";if(i.length>9)return{valid:!1,error:"Too many birth conditions (maximum 9)"};if(o.length>9)return{valid:!1,error:"Too many survival conditions (maximum 9)"};const l=i.split("").map(Number),a=o.split("").map(Number);return new Set(l).size!==l.length?{valid:!1,error:"Duplicate birth conditions not allowed"}:new Set(a).size!==a.length?{valid:!1,error:"Duplicate survival conditions not allowed"}:{valid:!0}}static parseRule(e){if(!this.validateRule(e).valid)return null;const r=e.trim().match(/^B([0-8]*)\/S([0-8]*)$/);if(!r)return null;const n=r[1]??"",i=r[2]??"";return{birth:n.split("").map(Number),survival:i.split("").map(Number),notation:e.trim()}}static formatRule(e,t){const r=[...e].sort((i,o)=>i-o),n=[...t].sort((i,o)=>i-o);return`B${r.join("")}/S${n.join("")}`}static getPresetRule(e){const t=this.PRESET_RULES[e];return{name:t.name,birth:[...t.birth],survival:[...t.survival],notation:t.notation,description:t.description}}static getAllPresetRules(){return Object.entries(this.PRESET_RULES).map(([e,t])=>({id:e,name:t.name,birth:[...t.birth],survival:[...t.survival],notation:t.notation,description:t.description}))}static isPresetRule(e){const t=e.trim();for(const[r,n]of Object.entries(this.PRESET_RULES))if(n.notation===t)return r;return null}static getPresetRuleByNotation(e){const t=this.isPresetRule(e);return t?this.getPresetRule(t):null}static validateRuleNumbers(e,t){for(const r of e)if(!Number.isInteger(r)||r<0||r>8)return{valid:!1,error:`Invalid birth condition: ${r}. Must be integer 0-8`};for(const r of t)if(!Number.isInteger(r)||r<0||r>8)return{valid:!1,error:`Invalid survival condition: ${r}. Must be integer 0-8`};return new Set(e).size!==e.length?{valid:!1,error:"Duplicate birth conditions not allowed"}:new Set(t).size!==t.length?{valid:!1,error:"Duplicate survival conditions not allowed"}:{valid:!0}}static createRule(e,t){return this.validateRuleNumbers(e,t).valid?{birth:[...e].sort((n,i)=>n-i),survival:[...t].sort((n,i)=>n-i),notation:this.formatRule(e,t)}:null}static rulesEqual(e,t){const r=[...e.birth].sort((l,a)=>l-a),n=[...t.birth].sort((l,a)=>l-a),i=[...e.survival].sort((l,a)=>l-a),o=[...t.survival].sort((l,a)=>l-a);return r.length===n.length&&i.length===o.length&&r.every((l,a)=>l===n[a])&&i.every((l,a)=>l===o[a])}}y(Me,"PRESET_RULES",{conway:{name:"Conway's Game of Life",birth:[3],survival:[2,3],notation:"B3/S23",description:"The classic cellular automaton with balanced birth and survival rules"},highlife:{name:"HighLife",birth:[3,6],survival:[2,3],notation:"B36/S23",description:"Like Conway's Life but with additional birth on 6 neighbors, creating replicators"},seeds:{name:"Seeds",birth:[2],survival:[],notation:"B2/S",description:"Every living cell dies, new cells born with 2 neighbors - creates explosive growth"},daynight:{name:"Day & Night",birth:[3,6,7,8],survival:[3,4,6,7,8],notation:"B3678/S34678",description:"Symmetric rule where both crowded and sparse areas can sustain life"}});class J{static coordinatesToIndex(e,t,r){return t*r+e}static indexToCoordinates(e,t){return{x:e%t,y:Math.floor(e/t)}}static isValidCoordinate(e,t,r,n){return e>=0&&e<r&&t>=0&&t<n}static isValidIndex(e,t){return e>=0&&e<t}static createEmptyGrid(e,t){return new Uint8Array(e*t)}static createFilledGrid(e,t,r){const n=new Uint8Array(e*t);return r===1&&n.fill(1),n}static copyGrid(e){return new Uint8Array(e)}static clearGrid(e){e.fill(0)}static countLivingCells(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r]??0;return t}static calculateDensity(e){const t=this.countLivingCells(e);return e.length>0?t/e.length:0}static getLivingCellCoordinates(e,t){const r=[];for(let n=0;n<e.length;n++)e[n]===1&&r.push(this.indexToCoordinates(n,t));return r}static getLivingCellPositions(e,t){const r=[];for(let n=0;n<e.length;n++)if(e[n]===1){const i=this.indexToCoordinates(n,t);r.push({index:n,x:i.x,y:i.y})}return r}static gridsEqual(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}static getGridBounds(e,t,r){let n=t,i=-1,o=r,l=-1;for(let a=0;a<e.length;a++)if(e[a]===1){const d=this.indexToCoordinates(a,t);n=Math.min(n,d.x),i=Math.max(i,d.x),o=Math.min(o,d.y),l=Math.max(l,d.y)}return i===-1?null:{minX:n,maxX:i,minY:o,maxY:l}}static centerPattern(e,t,r,n){return{x:Math.floor((r-e)/2),y:Math.floor((n-t)/2)}}static canFitPattern(e,t,r,n,i,o){return r>=0&&n>=0&&r+e<=i&&n+t<=o}static getGridStatistics(e,t,r){const n=this.countLivingCells(e),i=this.calculateDensity(e),o=this.getGridBounds(e,t,r);return{totalCells:e.length,livingCells:n,deadCells:e.length-n,density:i,bounds:o,isEmpty:n===0,isFull:n===e.length}}static resizeGrid(e,t,r,n,i,o=!0){const l=this.createEmptyGrid(n,i);if(o){const a=Math.floor((n-t)/2),d=Math.floor((i-r)/2),u=Math.min(t,n),m=Math.min(r,i),f=Math.max(0,-a),g=Math.max(0,-d),S=Math.max(0,a),R=Math.max(0,d);for(let M=0;M<m-Math.abs(Math.min(0,d));M++)for(let w=0;w<u-Math.abs(Math.min(0,a));w++){const P=this.coordinatesToIndex(f+w,g+M,t),j=this.coordinatesToIndex(S+w,R+M,n);P<e.length&&j<l.length&&(l[j]=e[P]??0)}}else{const a=Math.min(t,n),d=Math.min(r,i);for(let u=0;u<d;u++)for(let m=0;m<a;m++){const f=this.coordinatesToIndex(m,u,t),g=this.coordinatesToIndex(m,u,n);l[g]=e[f]??0}}return l}}class A{static getFamousPattern(e){const t=this.FAMOUS_PATTERNS[e.toLowerCase()];return t?{...t,cells:[...t.cells]}:null}static getAllFamousPatterns(){return Object.values(this.FAMOUS_PATTERNS).map(e=>({...e,cells:[...e.cells]}))}static validatePattern(e){if(!e.name||e.name.trim()==="")return{valid:!1,error:"Pattern must have a name"};if(e.width<=0||e.height<=0)return{valid:!1,error:"Pattern dimensions must be positive"};if(e.width>200||e.height>200)return{valid:!1,error:"Pattern too large (maximum 200x200)"};for(const r of e.cells)if(r.x<0||r.x>=e.width||r.y<0||r.y>=e.height)return{valid:!1,error:`Cell at (${r.x}, ${r.y}) is outside pattern bounds`};return new Set(e.cells.map(r=>`${r.x},${r.y}`)).size!==e.cells.length?{valid:!1,error:"Pattern contains duplicate cells"}:{valid:!0}}static patternToGrid(e){const t=new Uint8Array(e.width*e.height);for(const r of e.cells){const n=J.coordinatesToIndex(r.x,r.y,e.width);n>=0&&n<t.length&&(t[n]=1)}return t}static gridToPattern(e,t,r,n="Custom Pattern"){const i=[];for(let o=0;o<e.length;o++)if(e[o]===1){const l=J.indexToCoordinates(o,t);i.push(l)}return{name:n,width:t,height:r,cells:i}}static placePatternOnGrid(e,t,r,n,i,o,l=!0){if(!this.validatePattern(n).valid)return{success:!1,error:me.PATTERN_TOO_LARGE};if(!J.canFitPattern(n.width,n.height,i,o,t,r))return{success:!1,error:me.PATTERN_TOO_LARGE};for(const d of n.cells){const u=i+d.x,m=o+d.y;if(J.isValidCoordinate(u,m,t,r)){const f=J.coordinatesToIndex(u,m,t);(l||e[f]===0)&&(e[f]=1)}}return{success:!0}}static centerPatternOnGrid(e,t,r,n,i=!0){const o=J.centerPattern(n.width,n.height,t,r);return this.placePatternOnGrid(e,t,r,n,o.x,o.y,i)}static rotatePattern(e,t){if(!this.validatePattern(e).valid)return e;let n,i=e.width,o=e.height;switch(t){case 90:i=e.height,o=e.width,n=e.cells.map(l=>({x:e.height-1-l.y,y:l.x}));break;case 180:n=e.cells.map(l=>({x:e.width-1-l.x,y:e.height-1-l.y}));break;case 270:i=e.height,o=e.width,n=e.cells.map(l=>({x:l.y,y:e.width-1-l.x}));break;default:n=[...e.cells]}return{name:`${e.name} (${t}°)`,width:i,height:o,cells:n,...e.rule&&{rule:e.rule}}}static flipPatternHorizontal(e){if(!this.validatePattern(e).valid)return e;const r=e.cells.map(n=>({x:e.width-1-n.x,y:n.y}));return{name:`${e.name} (H-flip)`,width:e.width,height:e.height,cells:r,...e.rule&&{rule:e.rule}}}static flipPatternVertical(e){if(!this.validatePattern(e).valid)return e;const r=e.cells.map(n=>({x:n.x,y:e.height-1-n.y}));return{name:`${e.name} (V-flip)`,width:e.width,height:e.height,cells:r,...e.rule&&{rule:e.rule}}}static scalePattern(e,t){if(!this.validatePattern(e).valid||t<=0)return e;const n=Math.floor(e.width*t),i=Math.floor(e.height*t);if(n>200||i>200)return e;const o=[];for(const a of e.cells)for(let d=0;d<t;d++)for(let u=0;u<t;u++){const m=Math.floor(a.x*t)+u,f=Math.floor(a.y*t)+d;m<n&&f<i&&o.push({x:m,y:f})}const l=Array.from(new Set(o.map(a=>`${a.x},${a.y}`))).map(a=>{const[d,u]=a.split(",").map(Number);return{x:d,y:u}});return{name:`${e.name} (${t}x)`,width:n,height:i,cells:l,...e.rule&&{rule:e.rule}}}static getPatternBounds(e){if(e.cells.length===0)return null;let t=e.width,r=-1,n=e.height,i=-1;for(const o of e.cells)t=Math.min(t,o.x),r=Math.max(r,o.x),n=Math.min(n,o.y),i=Math.max(i,o.y);return{minX:t,maxX:r,minY:n,maxY:i}}static normalizePattern(e){const t=this.getPatternBounds(e);if(!t)return e;const r=e.cells.map(n=>({x:n.x-t.minX,y:n.y-t.minY}));return{name:e.name,width:t.maxX-t.minX+1,height:t.maxY-t.minY+1,cells:r,...e.rule&&{rule:e.rule}}}static patternsEqual(e,t){if(e.width!==t.width||e.height!==t.height||e.cells.length!==t.cells.length)return!1;const r=new Set(e.cells.map(i=>`${i.x},${i.y}`)),n=new Set(t.cells.map(i=>`${i.x},${i.y}`));return r.size===n.size&&[...r].every(i=>n.has(i))}}y(A,"FAMOUS_PATTERNS",{glider:{name:"Glider",width:3,height:3,cells:[{x:1,y:0},{x:2,y:1},{x:0,y:2},{x:1,y:2},{x:2,y:2}],rule:"B3/S23"},blinker:{name:"Blinker",width:3,height:1,cells:[{x:0,y:0},{x:1,y:0},{x:2,y:0}],rule:"B3/S23"},block:{name:"Block",width:2,height:2,cells:[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1}],rule:"B3/S23"},beacon:{name:"Beacon",width:4,height:4,cells:[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:3,y:2},{x:2,y:3},{x:3,y:3}],rule:"B3/S23"},toad:{name:"Toad",width:4,height:2,cells:[{x:1,y:0},{x:2,y:0},{x:3,y:0},{x:0,y:1},{x:1,y:1},{x:2,y:1}],rule:"B3/S23"}});class G{static import(e){if(!e||typeof e!="string")return{pattern:null,error:"Invalid RLE input"};const t=e.trim().split(/\r?\n/).filter(u=>u.trim());if(t.length===0)return{pattern:null,error:"Empty RLE input"};let r="",n=[],i=!1;for(const u of t){const m=u.trim();m.startsWith("#")||(!i&&this.HEADER_REGEX.test(m)?(r=m,i=!0):(i||this.containsRLECharacters(m))&&n.push(m))}if(!i&&n.length===0)return{pattern:null,error:"No valid RLE pattern found"};let o=0,l=0,a="B3/S23";if(r){const u=r.match(this.HEADER_REGEX);if(u&&(o=parseInt(u[1],10),l=parseInt(u[2],10),u[3])){const m=u[3].trim();Me.validateRule(m).valid&&(a=m)}}const d=n.join("").replace(/\s+/g,"");if(!this.RLE_PATTERN_REGEX.test(d))return{pattern:null,error:"Invalid RLE pattern format"};try{const u=this.parseRLEPattern(d),m=this.calculateBounds(u);return o===0&&(o=m.maxX+1),l===0&&(l=m.maxY+1),o>200||l>200?{pattern:null,error:"Pattern too large (maximum 200x200)"}:{pattern:{name:"Imported Pattern",width:o,height:l,cells:u,rule:a}}}catch(u){return{pattern:null,error:`RLE parsing error: ${u instanceof Error?u.message:"Unknown error"}`}}}static containsRLECharacters(e){return/[bo$!]/.test(e)}static parseRLEPattern(e){const t=[];let r=0,n=0,i=0;for(;i<e.length&&e[i]!=="!";){let o=1,l="";for(;i<e.length&&/\d/.test(e[i]);)l+=e[i],i++;if(l&&(o=parseInt(l,10),o<=0||o>1e3))throw new Error(`Invalid run count: ${o}`);if(i>=e.length)throw new Error("Unexpected end of pattern");const a=e[i];switch(a){case"b":r+=o;break;case"o":for(let d=0;d<o;d++)t.push({x:r+d,y:n});r+=o;break;case"$":n+=o,r=0;break;default:throw new Error(`Invalid RLE character: ${a}`)}i++}return t}static calculateBounds(e){if(e.length===0)return{minX:0,maxX:0,minY:0,maxY:0};let t=e[0].x,r=e[0].x,n=e[0].y,i=e[0].y;for(const o of e)t=Math.min(t,o.x),r=Math.max(r,o.x),n=Math.min(n,o.y),i=Math.max(i,o.y);return{minX:t,maxX:r,minY:n,maxY:i}}static exportToRLE(e){if(!e.cells||e.cells.length===0)return`x = ${e.width}, y = ${e.height}, rule = ${e.rule||"B3/S23"}
!`;const t=`x = ${e.width}, y = ${e.height}, rule = ${e.rule||"B3/S23"}`,r=new Set(e.cells.map(o=>`${o.x},${o.y}`)),n=[];for(let o=0;o<e.height;o++){let l="",a=0;for(let d=0;d<e.width;d++)r.has(`${d},${o}`)?(a>0&&(l+=a===1?"b":`${a}b`,a=0),l+="o"):a++;a>0&&o<e.height-1&&(l+=a===1?"b":`${a}b`),n.push(l)}for(;n.length>0&&n[n.length-1]==="";)n.pop();let i=n.join("$");return i?i+="!":i="!",`${t}
${i}`}}y(G,"HEADER_REGEX",/^x\s*=\s*(\d+)\s*,\s*y\s*=\s*(\d+)(?:\s*,\s*rule\s*=\s*([^\r\n]+))?/i),y(G,"RLE_PATTERN_REGEX",/^([bo$!]|\d+[bo$!])+$/);class B{static exportToJSON(e,t,r,n,i,o="Exported Pattern"){const l=[];for(let a=0;a<e.length;a++)if(e[a]===1){const d=Math.floor(a/t),u=a%t;l.push(u,d)}return{name:o,created:new Date().toISOString(),grid:{width:t,height:r,data:l},rule:n,generation:i}}static exportJSONToFile(e){const t=JSON.stringify(e,null,2),r=new Blob([t],{type:"application/json"}),n=URL.createObjectURL(r),i=document.createElement("a");i.href=n,i.download=`${this.sanitizeFilename(e.name)}-${this.formatDate(e.created)}.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(n)}static exportCanvasToPNG(e,t="grid"){try{e.toBlob(r=>{if(!r)throw new Error("Failed to create image blob");const n=URL.createObjectURL(r),i=document.createElement("a");i.href=n,i.download=`${this.sanitizeFilename(t)}-${this.formatDate(new Date().toISOString())}.png`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(n)},"image/png")}catch(r){throw console.error("PNG export failed:",r),new Error("PNG export not supported in this browser")}}static importFromJSON(e){try{const t=JSON.parse(e);if(!this.validateExportedPattern(t))return{pattern:null,error:"Invalid JSON format"};const r=[],n=t.grid.data;for(let o=0;o<n.length;o+=2){const l=n[o],a=n[o+1];l>=0&&l<t.grid.width&&a>=0&&a<t.grid.height&&r.push({x:l,y:a})}return{pattern:{name:t.name,width:t.grid.width,height:t.grid.height,cells:r,rule:t.rule}}}catch(t){return{pattern:null,error:`JSON parsing error: ${t instanceof Error?t.message:"Unknown error"}`}}}static validateExportedPattern(e){return typeof e=="object"&&e!==null&&typeof e.name=="string"&&typeof e.created=="string"&&typeof e.grid=="object"&&typeof e.grid.width=="number"&&typeof e.grid.height=="number"&&Array.isArray(e.grid.data)&&typeof e.rule=="string"&&typeof e.generation=="number"}static sanitizeFilename(e){return e.replace(/[^a-z0-9\-_]/gi,"_").replace(/_{2,}/g,"_").replace(/^_|_$/g,"").toLowerCase()}static formatDate(e){return new Date(e).toISOString().slice(0,19).replace(/[:.]/g,"-")}}class ie{static placePattern(e,t,r,n,i,o,l={}){const{overwrite:a=!0,merge:d=!1,saveState:u=!0,description:m="Pattern placement"}=l;u&&this.saveState(e,m);const f=A.validatePattern(n);if(!f.valid)return{success:!1,error:f.error||"Pattern validation failed"};if(i<0||o<0||i+n.width>t||o+n.height>r)return{success:!1,error:"Pattern extends beyond grid boundaries"};let g=0;try{for(const S of n.cells){const R=i+S.x,M=o+S.y;if(R>=0&&R<t&&M>=0&&M<r){const w=M*t+R;e[w]===0&&(e[w]=1,g++)}}return{success:!0,affectedCells:g}}catch(S){return{success:!1,error:`Placement failed: ${S instanceof Error?S.message:"Unknown error"}`}}}static centerPattern(e,t,r,n,i={}){const o=Math.floor((t-n.width)/2),l=Math.floor((r-n.height)/2),a=this.placePattern(e,t,r,n,o,l,{...i,description:`Center ${n.name}`});return a.success?{success:!0,position:{x:o,y:l}}:{success:!1,error:a.error||"Pattern placement failed"}}static canPlacePattern(e,t,r,n,i){return n>=0&&i>=0&&n+r.width<=e&&i+r.height<=t}static getPlacementPreview(e,t,r,n,i){return this.canPlacePattern(n,i,e,t,r)?e.cells.map(o=>({x:t+o.x,y:r+o.y})):[]}static clearPattern(e,t,r,n,i,o,l=!0){if(l&&this.saveState(e,`Clear ${n.name}`),!this.canPlacePattern(t,r,n,i,o))return{success:!1,error:"Pattern extends beyond grid boundaries"};let a=0;try{for(const d of n.cells){const u=i+d.x,f=(o+d.y)*t+u;e[f]===1&&(e[f]=0,a++)}return{success:!0,clearedCells:a}}catch(d){return{success:!1,error:`Clear failed: ${d instanceof Error?d.message:"Unknown error"}`}}}static saveState(e,t){const r=new Uint8Array(e.length);r.set(e),this.placementHistory.push({grid:r,timestamp:Date.now(),description:t}),this.placementHistory.length>this.MAX_HISTORY&&this.placementHistory.shift()}static undo(e){if(this.placementHistory.length===0)return{success:!1};const t=this.placementHistory.pop();return e.set(t.grid),{success:!0,description:t.description}}static canUndo(){return this.placementHistory.length>0}static getUndoDescription(){return this.placementHistory.length===0?null:this.placementHistory[this.placementHistory.length-1].description}static clearHistory(){this.placementHistory.length=0}static getBestPlacementPosition(e,t,r,n,i){const o=Math.max(0,Math.min(n-Math.floor(r.width/2),e-r.width)),l=Math.max(0,Math.min(i-Math.floor(r.height/2),t-r.height));return{x:o,y:l}}}y(ie,"placementHistory",[]),y(ie,"MAX_HISTORY",10);const ee=50,Ye=200,fe=(s,e)=>new Uint8Array(s*e),Re={grid:{current:fe(ee,ee),width:ee,height:ee,generation:0},simulation:{isRunning:!1,speed:Ye,intervalId:null},rule:{birth:[3],survival:[2,3],notation:"B3/S23"},ui:{selectedPattern:null,isDrawing:!1,lastDrawnCell:null,showGrid:!0,patternPlacementMode:!1}},ae=Be((s,e)=>({...Re,setGridSize:(t,r)=>{const n=e();n.simulation.intervalId&&clearInterval(n.simulation.intervalId),s({grid:{current:fe(t,r),width:t,height:r,generation:0},simulation:{...n.simulation,isRunning:!1,intervalId:null}})},setCell:(t,r)=>{const n=e(),i=new Uint8Array(n.grid.current);i[t]=r,s({grid:{...n.grid,current:i}})},toggleCell:t=>{const n=e().grid.current[t];e().setCell(t,n===1?0:1)},clearGrid:()=>{const t=e(),{width:r,height:n}=t.grid;s({grid:{...t.grid,current:fe(r,n),generation:0}})},setRule:t=>{s(()=>({rule:{...t}}))},setSpeed:t=>{s(r=>({simulation:{...r.simulation,speed:t}}))},startSimulation:()=>{const t=e();if(t.simulation.isRunning)return;const r=window.setInterval(()=>{e().stepSimulation()},t.simulation.speed);s({simulation:{...t.simulation,isRunning:!0,intervalId:r}})},stopSimulation:()=>{const t=e();t.simulation.intervalId&&clearInterval(t.simulation.intervalId),s({simulation:{...t.simulation,isRunning:!1,intervalId:null}})},stepSimulation:()=>{const t=e(),{current:r,width:n,height:i,generation:o}=t.grid,{rule:l}=t,d=new he().computeNextGeneration(r,n,i,l);s({grid:{...t.grid,current:d,generation:o+1}})},incrementGeneration:()=>{s(t=>({grid:{...t.grid,generation:t.grid.generation+1}}))},setSelectedPattern:t=>{s(r=>({ui:{...r.ui,selectedPattern:t}}))},setIsDrawing:t=>{s(r=>({ui:{...r.ui,isDrawing:t}}))},setLastDrawnCell:t=>{s(r=>({ui:{...r.ui,lastDrawnCell:t}}))},toggleGridLines:()=>{s(t=>({ui:{...t.ui,showGrid:!t.ui.showGrid}}))},resetState:()=>{const t=e();t.simulation.intervalId!==null&&clearInterval(t.simulation.intervalId),s({...Re})},placePattern:(t,r,n)=>{const i=e(),o=new Uint8Array(i.grid.current),l=ie.placePattern(o,i.grid.width,i.grid.height,t,r,n,{saveState:!1});return l.success?(s({grid:{...i.grid,current:o}}),{success:!0}):{success:!1,error:l.error}},centerPattern:t=>{const r=e(),n=new Uint8Array(r.grid.current),i=ie.centerPattern(n,r.grid.width,r.grid.height,t,{saveState:!1});return i.success?(s({grid:{...r.grid,current:n}}),{success:!0,position:i.position}):{success:!1,error:i.error}},setPatternPlacementMode:(t,r)=>{s(n=>({ui:{...n.ui,patternPlacementMode:t,selectedPattern:r?.name||null}}))}}));/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=s=>s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Ve=s=>s.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase()),Ce=s=>{const e=Ve(s);return e.charAt(0).toUpperCase()+e.slice(1)},Pe=(...s)=>s.filter((e,t,r)=>!!e&&e.trim()!==""&&r.indexOf(e)===t).join(" ").trim(),Ke=s=>{for(const e in s)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ze={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=h.forwardRef(({color:s="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:r,className:n="",children:i,iconNode:o,...l},a)=>h.createElement("svg",{ref:a,...Ze,width:e,height:e,stroke:s,strokeWidth:r?Number(t)*24/Number(e):t,className:Pe("lucide",n),...!i&&!Ke(l)&&{"aria-hidden":"true"},...l},[...o.map(([d,u])=>h.createElement(d,u)),...Array.isArray(i)?i:[i]]));/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=(s,e)=>{const t=h.forwardRef(({className:r,...n},i)=>h.createElement(Qe,{ref:i,iconNode:e,className:Pe(`lucide-${qe(Ce(s))}`,`lucide-${s}`,r),...n}));return t.displayName=Ce(s),t};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],tt=K("info",et);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]],nt=K("pause",rt);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const it=[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]],st=K("play",it);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],at=K("rotate-ccw",ot);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lt=[["polygon",{points:"5 4 15 12 5 20 5 4",key:"16p6eg"}],["line",{x1:"19",x2:"19",y1:"5",y2:"19",key:"futhcm"}]],ct=K("skip-forward",lt);let dt={data:""},ut=s=>typeof window=="object"?((s?s.querySelector("#_goober"):window._goober)||Object.assign((s||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:s||dt,ht=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,mt=/\/\*[^]*?\*\/|  +/g,Ee=/\n+/g,F=(s,e)=>{let t="",r="",n="";for(let i in s){let o=s[i];i[0]=="@"?i[1]=="i"?t=i+" "+o+";":r+=i[1]=="f"?F(o,i):i+"{"+F(o,i[1]=="k"?"":e)+"}":typeof o=="object"?r+=F(o,e?e.replace(/([^,])+/g,l=>i.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,a=>/&/.test(a)?a.replace(/&/g,l):l?l+" "+a:a)):i):o!=null&&(i=/^--/.test(i)?i:i.replace(/[A-Z]/g,"-$&").toLowerCase(),n+=F.p?F.p(i,o):i+":"+o+";")}return t+(e&&n?e+"{"+n+"}":n)+r},$={},Te=s=>{if(typeof s=="object"){let e="";for(let t in s)e+=t+Te(s[t]);return e}return s},ft=(s,e,t,r,n)=>{let i=Te(s),o=$[i]||($[i]=(a=>{let d=0,u=11;for(;d<a.length;)u=101*u+a.charCodeAt(d++)>>>0;return"go"+u})(i));if(!$[o]){let a=i!==s?s:(d=>{let u,m,f=[{}];for(;u=ht.exec(d.replace(mt,""));)u[4]?f.shift():u[3]?(m=u[3].replace(Ee," ").trim(),f.unshift(f[0][m]=f[0][m]||{})):f[0][u[1]]=u[2].replace(Ee," ").trim();return f[0]})(s);$[o]=F(n?{["@keyframes "+o]:a}:a,t?"":"."+o)}let l=t&&$.g?$.g:null;return t&&($.g=$[o]),((a,d,u,m)=>{m?d.data=d.data.replace(m,a):d.data.indexOf(a)===-1&&(d.data=u?a+d.data:d.data+a)})($[o],e,r,l),o},pt=(s,e,t)=>s.reduce((r,n,i)=>{let o=e[i];if(o&&o.call){let l=o(t),a=l&&l.props&&l.props.className||/^go/.test(l)&&l;o=a?"."+a:l&&typeof l=="object"?l.props?"":F(l,""):l===!1?"":l}return r+n+(o??"")},"");function le(s){let e=this||{},t=s.call?s(e.p):s;return ft(t.unshift?t.raw?pt(t,[].slice.call(arguments,1),e.p):t.reduce((r,n)=>Object.assign(r,n&&n.call?n(e.p):n),{}):t,ut(e.target),e.g,e.o,e.k)}let ke,pe,ge;le.bind({g:1});let D=le.bind({k:1});function gt(s,e,t,r){F.p=e,ke=s,pe=t,ge=r}function z(s,e){let t=this||{};return function(){let r=arguments;function n(i,o){let l=Object.assign({},i),a=l.className||n.className;t.p=Object.assign({theme:pe&&pe()},l),t.o=/ *go\d+/.test(a),l.className=le.apply(t,r)+(a?" "+a:"");let d=s;return s[0]&&(d=l.as||s,delete l.as),ge&&d[0]&&ge(l),ke(d,l)}return n}}var xt=s=>typeof s=="function",se=(s,e)=>xt(s)?s(e):s,yt=(()=>{let s=0;return()=>(++s).toString()})(),je=(()=>{let s;return()=>{if(s===void 0&&typeof window<"u"){let e=matchMedia("(prefers-reduced-motion: reduce)");s=!e||e.matches}return s}})(),bt=20,Ie=(s,e)=>{switch(e.type){case 0:return{...s,toasts:[e.toast,...s.toasts].slice(0,bt)};case 1:return{...s,toasts:s.toasts.map(i=>i.id===e.toast.id?{...i,...e.toast}:i)};case 2:let{toast:t}=e;return Ie(s,{type:s.toasts.find(i=>i.id===t.id)?1:0,toast:t});case 3:let{toastId:r}=e;return{...s,toasts:s.toasts.map(i=>i.id===r||r===void 0?{...i,dismissed:!0,visible:!1}:i)};case 4:return e.toastId===void 0?{...s,toasts:[]}:{...s,toasts:s.toasts.filter(i=>i.id!==e.toastId)};case 5:return{...s,pausedAt:e.time};case 6:let n=e.time-(s.pausedAt||0);return{...s,pausedAt:void 0,toasts:s.toasts.map(i=>({...i,pauseDuration:i.pauseDuration+n}))}}},ne=[],U={toasts:[],pausedAt:void 0},H=s=>{U=Ie(U,s),ne.forEach(e=>{e(U)})},vt={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},St=(s={})=>{let[e,t]=h.useState(U),r=h.useRef(U);h.useEffect(()=>(r.current!==U&&t(U),ne.push(t),()=>{let i=ne.indexOf(t);i>-1&&ne.splice(i,1)}),[]);let n=e.toasts.map(i=>{var o,l,a;return{...s,...s[i.type],...i,removeDelay:i.removeDelay||((o=s[i.type])==null?void 0:o.removeDelay)||s?.removeDelay,duration:i.duration||((l=s[i.type])==null?void 0:l.duration)||s?.duration||vt[i.type],style:{...s.style,...(a=s[i.type])==null?void 0:a.style,...i.style}}});return{...e,toasts:n}},wt=(s,e="blank",t)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:e,ariaProps:{role:"status","aria-live":"polite"},message:s,pauseDuration:0,...t,id:t?.id||yt()}),Z=s=>(e,t)=>{let r=wt(e,s,t);return H({type:2,toast:r}),r.id},k=(s,e)=>Z("blank")(s,e);k.error=Z("error");k.success=Z("success");k.loading=Z("loading");k.custom=Z("custom");k.dismiss=s=>{H({type:3,toastId:s})};k.remove=s=>H({type:4,toastId:s});k.promise=(s,e,t)=>{let r=k.loading(e.loading,{...t,...t?.loading});return typeof s=="function"&&(s=s()),s.then(n=>{let i=e.success?se(e.success,n):void 0;return i?k.success(i,{id:r,...t,...t?.success}):k.dismiss(r),n}).catch(n=>{let i=e.error?se(e.error,n):void 0;i?k.error(i,{id:r,...t,...t?.error}):k.dismiss(r)}),s};var Rt=(s,e)=>{H({type:1,toast:{id:s,height:e}})},Ct=()=>{H({type:5,time:Date.now()})},q=new Map,Et=1e3,Mt=(s,e=Et)=>{if(q.has(s))return;let t=setTimeout(()=>{q.delete(s),H({type:4,toastId:s})},e);q.set(s,t)},Pt=s=>{let{toasts:e,pausedAt:t}=St(s);h.useEffect(()=>{if(t)return;let i=Date.now(),o=e.map(l=>{if(l.duration===1/0)return;let a=(l.duration||0)+l.pauseDuration-(i-l.createdAt);if(a<0){l.visible&&k.dismiss(l.id);return}return setTimeout(()=>k.dismiss(l.id),a)});return()=>{o.forEach(l=>l&&clearTimeout(l))}},[e,t]);let r=h.useCallback(()=>{t&&H({type:6,time:Date.now()})},[t]),n=h.useCallback((i,o)=>{let{reverseOrder:l=!1,gutter:a=8,defaultPosition:d}=o||{},u=e.filter(g=>(g.position||d)===(i.position||d)&&g.height),m=u.findIndex(g=>g.id===i.id),f=u.filter((g,S)=>S<m&&g.visible).length;return u.filter(g=>g.visible).slice(...l?[f+1]:[0,f]).reduce((g,S)=>g+(S.height||0)+a,0)},[e]);return h.useEffect(()=>{e.forEach(i=>{if(i.dismissed)Mt(i.id,i.removeDelay);else{let o=q.get(i.id);o&&(clearTimeout(o),q.delete(i.id))}})},[e]),{toasts:e,handlers:{updateHeight:Rt,startPause:Ct,endPause:r,calculateOffset:n}}},Tt=D`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,kt=D`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,jt=D`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,It=z("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${s=>s.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${Tt} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${kt} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${s=>s.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${jt} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,Lt=D`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,Nt=z("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${s=>s.secondary||"#e0e0e0"};
  border-right-color: ${s=>s.primary||"#616161"};
  animation: ${Lt} 1s linear infinite;
`,$t=D`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,At=D`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,Dt=z("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${s=>s.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${$t} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${At} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${s=>s.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,Ft=z("div")`
  position: absolute;
`,zt=z("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,Ot=D`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,_t=z("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${Ot} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,Bt=({toast:s})=>{let{icon:e,type:t,iconTheme:r}=s;return e!==void 0?typeof e=="string"?h.createElement(_t,null,e):e:t==="blank"?null:h.createElement(zt,null,h.createElement(Nt,{...r}),t!=="loading"&&h.createElement(Ft,null,t==="error"?h.createElement(It,{...r}):h.createElement(Dt,{...r})))},Ut=s=>`
0% {transform: translate3d(0,${s*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,Gt=s=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${s*-150}%,-1px) scale(.6); opacity:0;}
`,Ht="0%{opacity:0;} 100%{opacity:1;}",Jt="0%{opacity:1;} 100%{opacity:0;}",Wt=z("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,Xt=z("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,Yt=(s,e)=>{let t=s.includes("top")?1:-1,[r,n]=je()?[Ht,Jt]:[Ut(t),Gt(t)];return{animation:e?`${D(r)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${D(n)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},qt=h.memo(({toast:s,position:e,style:t,children:r})=>{let n=s.height?Yt(s.position||e||"top-center",s.visible):{opacity:0},i=h.createElement(Bt,{toast:s}),o=h.createElement(Xt,{...s.ariaProps},se(s.message,s));return h.createElement(Wt,{className:s.className,style:{...n,...t,...s.style}},typeof r=="function"?r({icon:i,message:o}):h.createElement(h.Fragment,null,i,o))});gt(h.createElement);var Vt=({id:s,className:e,style:t,onHeightUpdate:r,children:n})=>{let i=h.useCallback(o=>{if(o){let l=()=>{let a=o.getBoundingClientRect().height;r(s,a)};l(),new MutationObserver(l).observe(o,{subtree:!0,childList:!0,characterData:!0})}},[s,r]);return h.createElement("div",{ref:i,className:e,style:t},n)},Kt=(s,e)=>{let t=s.includes("top"),r=t?{top:0}:{bottom:0},n=s.includes("center")?{justifyContent:"center"}:s.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:je()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${e*(t?1:-1)}px)`,...r,...n}},Zt=le`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,te=16,Qt=({reverseOrder:s,position:e="top-center",toastOptions:t,gutter:r,children:n,containerStyle:i,containerClassName:o})=>{let{toasts:l,handlers:a}=Pt(t);return h.createElement("div",{id:"_rht_toaster",style:{position:"fixed",zIndex:9999,top:te,left:te,right:te,bottom:te,pointerEvents:"none",...i},className:o,onMouseEnter:a.startPause,onMouseLeave:a.endPause},l.map(d=>{let u=d.position||e,m=a.calculateOffset(d,{reverseOrder:s,gutter:r,defaultPosition:e}),f=Kt(u,m);return h.createElement(Vt,{id:d.id,key:d.id,onHeightUpdate:a.updateHeight,className:d.visible?Zt:"",style:f},d.type==="custom"?se(d.message,d):n?n(d):h.createElement(qt,{toast:d,position:u}))}))},re=k;class er{constructor(e){y(this,"canvas");y(this,"ctx");y(this,"devicePixelRatio");y(this,"lastFrameTime",0);y(this,"frameCount",0);y(this,"fps",0);this.canvas=e;const t=e.getContext("2d");if(!t)throw new Error("Canvas 2D context not supported");this.ctx=t,this.devicePixelRatio=window.devicePixelRatio||1,this.setupCanvas()}setupCanvas(){const{canvas:e,ctx:t,devicePixelRatio:r}=this,n=e.getBoundingClientRect();e.width=n.width*r,e.height=n.height*r,t.scale(r,r),e.style.width=`${n.width}px`,e.style.height=`${n.height}px`,t.imageSmoothingEnabled=!1}resize(){this.setupCanvas()}render(e,t,r,n={showGrid:!1}){const i=performance.now(),{canvas:o,ctx:l}=this,a=o.getBoundingClientRect(),d=Math.min(a.width/t,a.height/r);l.fillStyle="#1a1a2a",l.fillRect(0,0,a.width,a.height),l.fillStyle="#00d4ff";for(let u=0;u<e.length;u++)if(e[u]===1){const m=u%t*d,f=Math.floor(u/t)*d;l.fillRect(m,f,d,d)}n.showGrid&&t<=50&&this.renderGridLines(t,r,d),this.updateFPS(i)}renderGridLines(e,t,r){const{ctx:n}=this;n.strokeStyle="#333344",n.lineWidth=1,n.beginPath();for(let i=0;i<=e;i++){const o=i*r;n.moveTo(o,0),n.lineTo(o,t*r)}for(let i=0;i<=t;i++){const o=i*r;n.moveTo(0,o),n.lineTo(e*r,o)}n.stroke()}updateFPS(e){const t=performance.now(),r=t-e;t-this.lastFrameTime>=1e3&&(this.fps=this.frameCount,this.frameCount=0,this.lastFrameTime=t,r>16.67&&console.warn(`Slow render: ${r.toFixed(2)}ms (target: <16.67ms)`)),this.frameCount++}getFPS(){return this.fps}getCellSize(e,t){const r=this.canvas.getBoundingClientRect();return Math.min(r.width/e,r.height/t)}coordinateToCell(e,t,r,n){const i=this.canvas.getBoundingClientRect(),o=this.getCellSize(r,n),l=Math.floor((e-i.left)/o),a=Math.floor((t-i.top)/o);return l>=0&&l<r&&a>=0&&a<n?{x:l,y:a,index:a*r+l}:null}}class tr{constructor(e,t,r,n,i){y(this,"isDrawing",!1);y(this,"lastCell",null);y(this,"canvas");y(this,"onCellChange");y(this,"onDrawingStateChange");y(this,"onLastCellChange");y(this,"getCurrentGrid");y(this,"handleMouseDown",e=>{e.preventDefault(),this.startDrawing(),this.handleCellInteraction(e.clientX,e.clientY)});y(this,"handleMouseMove",e=>{this.isDrawing&&(e.preventDefault(),this.handleCellInteraction(e.clientX,e.clientY))});y(this,"handleMouseUp",e=>{this.stopDrawing()});y(this,"handleMouseLeave",e=>{this.stopDrawing()});y(this,"handleTouchStart",e=>{if(e.preventDefault(),e.touches.length!==1)return;const t=e.touches[0];t&&(this.startDrawing(),this.handleCellInteraction(t.clientX,t.clientY))});y(this,"handleTouchMove",e=>{if(e.preventDefault(),!this.isDrawing||e.touches.length!==1)return;const t=e.touches[0];t&&this.handleCellInteraction(t.clientX,t.clientY)});y(this,"handleTouchEnd",e=>{e.preventDefault(),this.stopDrawing()});this.canvas=e,this.onCellChange=t,this.onDrawingStateChange=r,this.onLastCellChange=n,this.getCurrentGrid=i,this.setupEventListeners()}setupEventListeners(){this.canvas.addEventListener("mousedown",this.handleMouseDown),this.canvas.addEventListener("mousemove",this.handleMouseMove),this.canvas.addEventListener("mouseup",this.handleMouseUp),this.canvas.addEventListener("mouseleave",this.handleMouseLeave),this.canvas.addEventListener("touchstart",this.handleTouchStart,{passive:!1}),this.canvas.addEventListener("touchmove",this.handleTouchMove,{passive:!1}),this.canvas.addEventListener("touchend",this.handleTouchEnd,{passive:!1}),this.canvas.addEventListener("touchcancel",this.handleTouchEnd,{passive:!1})}startDrawing(){this.isDrawing=!0,this.onDrawingStateChange(!0)}stopDrawing(){this.isDrawing=!1,this.lastCell=null,this.onDrawingStateChange(!1),this.onLastCellChange(null)}handleCellInteraction(e,t){const r=this.getTouch(e,t);if(!r||r.cellIndex===null||r.cellIndex===this.lastCell)return;this.lastCell=r.cellIndex,this.onLastCellChange(r.cellIndex);const i=this.getCurrentGridState()[r.cellIndex];this.onCellChange(r.cellIndex,i===1?0:1)}getTouch(e,t){const r=this.canvas.getBoundingClientRect(),n=e-r.left,i=t-r.top;return{x:n,y:i,cellIndex:this.getCellIndex(n,i)}}getCellIndex(e,t){const{width:r,height:n}=this.getGridDimensions(),i=this.getCellSize(),o=Math.floor(e/i),l=Math.floor(t/i);return o>=0&&o<r&&l>=0&&l<n?l*r+o:null}getCellSize(){const{width:e,height:t}=this.getGridDimensions(),r=this.canvas.getBoundingClientRect();return Math.min(r.width/e,r.height/t)}getGridDimensions(){const e=this.canvas;return{width:parseInt(e.dataset.gridWidth||"50"),height:parseInt(e.dataset.gridHeight||"50")}}getCurrentGridState(){return this.getCurrentGrid()}destroy(){this.canvas.removeEventListener("mousedown",this.handleMouseDown),this.canvas.removeEventListener("mousemove",this.handleMouseMove),this.canvas.removeEventListener("mouseup",this.handleMouseUp),this.canvas.removeEventListener("mouseleave",this.handleMouseLeave),this.canvas.removeEventListener("touchstart",this.handleTouchStart),this.canvas.removeEventListener("touchmove",this.handleTouchMove),this.canvas.removeEventListener("touchend",this.handleTouchEnd),this.canvas.removeEventListener("touchcancel",this.handleTouchEnd)}}class rr{constructor(e){y(this,"frameCount",0);y(this,"frameTimeSum",0);y(this,"renderCount",0);y(this,"fps",0);y(this,"lastFPSUpdate",0);y(this,"frameTimes",[]);y(this,"maxFrameTimes",60);y(this,"targetFrameTime",16.67);y(this,"onWarning");this.onWarning=e}startFrame(){return performance.now()}endFrame(e){const t=performance.now(),r=t-e;if(this.frameCount++,this.renderCount++,this.frameTimeSum+=r,this.frameTimes.push(r),this.frameTimes.length>this.maxFrameTimes&&this.frameTimes.shift(),t-this.lastFPSUpdate>=1e3&&(this.fps=this.frameCount,this.frameCount=0,this.lastFPSUpdate=t),r>this.targetFrameTime){const n=this.getMetrics();this.onWarning?.(`Frame time ${r.toFixed(2)}ms exceeds target ${this.targetFrameTime}ms`,n)}}getMetrics(){const e=this.frameTimeSum/Math.max(this.renderCount,1);return{fps:this.fps,frameTime:this.frameTimes[this.frameTimes.length-1]||0,memoryUsage:this.getMemoryUsage(),renderCount:this.renderCount,averageFrameTime:e}}getMemoryUsage(){return"memory"in performance?performance.memory.usedJSHeapSize/1024/1024:0}reset(){this.frameCount=0,this.frameTimeSum=0,this.renderCount=0,this.frameTimes=[],this.lastFPSUpdate=0}isPerformanceGood(){const e=this.getMetrics();return e.fps>=55&&e.averageFrameTime<=this.targetFrameTime*1.2}getPerformanceGrade(){const e=this.getMetrics();return e.fps>=58&&e.averageFrameTime<=this.targetFrameTime?"excellent":e.fps>=50&&e.averageFrameTime<=this.targetFrameTime*1.5?"good":e.fps>=30&&e.averageFrameTime<=this.targetFrameTime*2?"fair":"poor"}createReportString(){const e=this.getMetrics();return[`Performance: ${this.getPerformanceGrade().toUpperCase()}`,`FPS: ${e.fps}`,`Frame Time: ${e.frameTime.toFixed(2)}ms (avg: ${e.averageFrameTime.toFixed(2)}ms)`,`Memory: ${e.memoryUsage.toFixed(1)}MB`,`Renders: ${e.renderCount}`].join(" | ")}}const Le=h.memo(({width:s=400,height:e=400,className:t="",onPerformanceUpdate:r,canvasRef:n})=>{const i=h.useRef(null),o=n||i,l=h.useRef(null),a=h.useRef(null),d=h.useRef(null),u=h.useRef(null),{grid:m,ui:f,setCell:g,setIsDrawing:S,setLastDrawnCell:R}=ae(),M=h.useCallback((p,v)=>{console.warn(`GridCanvas Performance Warning: ${p}`,v),r?.(v)},[r]),w=h.useCallback(()=>{if(o.current)try{l.current=new er(o.current),d.current=new rr(M)}catch(p){console.error("Failed to initialize GridRenderer:",p)}},[M]),P=h.useCallback(()=>{if(!o.current||!l.current)return;const p=(b,E)=>{g(b,E)},v=b=>{S(b)},C=b=>{R(b)},x=()=>m.current;a.current=new tr(o.current,p,v,C,x)},[g,S,R,m]),j=h.useCallback(()=>{if(!l.current||!d.current)return;const p=d.current.startFrame();l.current.render(m.current,m.width,m.height,{showGrid:f.showGrid}),d.current.endFrame(p);const v=d.current.getMetrics();r?.(v)},[m,f.showGrid,r]),T=h.useCallback(()=>{u.current&&cancelAnimationFrame(u.current),u.current=requestAnimationFrame(j)},[j]);return h.useEffect(()=>(w(),()=>{u.current&&cancelAnimationFrame(u.current)}),[w]),h.useEffect(()=>(P(),()=>{a.current?.destroy()}),[P]),h.useEffect(()=>{T()},[T]),h.useEffect(()=>{const p=()=>{l.current?.resize(),T()};return window.addEventListener("resize",p),()=>window.removeEventListener("resize",p)},[T]),h.useEffect(()=>{o.current&&(o.current.dataset.gridWidth=m.width.toString(),o.current.dataset.gridHeight=m.height.toString())},[m.width,m.height]),c.jsx("canvas",{ref:o,width:s,height:e,className:`border border-grid-line cursor-pointer touch-none ${t}`,style:{width:`${s}px`,height:`${e}px`,maxWidth:"100%",maxHeight:"100%"},"aria-label":`Cellular automata grid, ${m.width} by ${m.height} cells, generation ${m.generation}`,role:"img"})});Le.displayName="GridCanvas";const nr=({className:s="",showPerformanceMetrics:e=!1,canvasRef:t})=>{const{grid:r}=ae(),[n,i]=h.useState(null),o=h.useCallback(d=>{i(d)},[]),l=h.useMemo(()=>{const d=r.width/r.height,u=Math.min(window.innerWidth*.8,window.innerHeight*.6,500);let m,f;return d>1?(m=u,f=u/d):(f=u,m=u*d),{width:Math.max(320,Math.min(m,500)),height:Math.max(320,Math.min(f,500))}},[r.width,r.height]),a=h.useMemo(()=>n?n.fps>=58&&n.averageFrameTime<=16.67?{grade:"excellent",color:"text-green-400"}:n.fps>=50&&n.averageFrameTime<=25?{grade:"good",color:"text-blue-400"}:n.fps>=30&&n.averageFrameTime<=33?{grade:"fair",color:"text-yellow-400"}:{grade:"poor",color:"text-red-400"}:null,[n]);return c.jsxs("div",{className:`flex flex-col items-center ${s}`,children:[c.jsxs("div",{className:"relative",children:[c.jsx(Le,{width:l.width,height:l.height,onPerformanceUpdate:o,className:"rounded-lg shadow-lg",canvasRef:t}),e&&n&&c.jsxs("div",{className:"absolute top-2 right-2 bg-black bg-opacity-75 text-white text-xs px-2 py-1 rounded",children:[c.jsx("div",{className:`font-semibold ${a?.color}`,children:a?.grade.toUpperCase()}),c.jsxs("div",{children:["FPS: ",n.fps]}),c.jsxs("div",{children:["Frame: ",n.frameTime.toFixed(1),"ms"]}),n.memoryUsage>0&&c.jsxs("div",{children:["Memory: ",n.memoryUsage.toFixed(1),"MB"]})]})]}),c.jsxs("div",{className:"mt-4 text-center text-sm text-text-secondary",children:[c.jsxs("div",{children:["Grid Size: ",r.width," × ",r.height," cells"]}),c.jsxs("div",{children:["Generation: ",r.generation]}),n&&c.jsxs("div",{className:"mt-1",children:["Rendered ",n.renderCount," frames"]})]})]})},oe=({pattern:s,size:e=64,selected:t=!1,onClick:r,className:n=""})=>{const i=h.useRef(null),[o,l]=h.useState(!1);return h.useEffect(()=>{const a=i.current;if(!a)return;const d=a.getContext("2d");if(!d)return;a.width=e,a.height=e,d.fillStyle="#0a0a0f",d.fillRect(0,0,e,e);const u=Math.min(Math.floor(e/Math.max(s.width,s.height))-1,8);if(u<1)return;const m=Math.floor((e-s.width*u)/2),f=Math.floor((e-s.height*u)/2);d.fillStyle="#00d4ff";for(const g of s.cells){const S=m+g.x*u,R=f+g.y*u;d.fillRect(S,R,u-1,u-1)}(t||o)&&(d.strokeStyle=t?"#00d4ff":"#666",d.lineWidth=t?2:1,d.strokeRect(0,0,e,e))},[s,e,t,o]),c.jsxs("div",{className:`pattern-preview ${n} ${t?"selected":""}`,onClick:r,onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"8px",borderRadius:"8px",backgroundColor:t?"#1a1a2a":"transparent",cursor:r?"pointer":"default",transition:"background-color 0.2s",minWidth:`${e+16}px`},children:[c.jsx("canvas",{ref:i,width:e,height:e,style:{display:"block",borderRadius:"4px",marginBottom:"4px"}}),c.jsx("span",{style:{fontSize:"12px",color:"#ccc",textAlign:"center",wordBreak:"break-word",maxWidth:`${e+16}px`},children:s.name})]})},ir=({onImport:s,onClose:e,className:t=""})=>{const[r,n]=h.useState(""),[i,o]=h.useState(""),[l,a]=h.useState("rle"),[d,u]=h.useState(null),[m,f]=h.useState(""),[g,S]=h.useState(!1),R=h.useRef(null),M=()=>{if(!r.trim()){f("Please enter RLE text");return}S(!0),f("");try{const p=G.import(r);p.pattern?(u(p.pattern),f("")):(f(p.error||"Failed to import RLE pattern"),u(null))}catch(p){f(`Import failed: ${p instanceof Error?p.message:"Unknown error"}`),u(null)}finally{S(!1)}},w=()=>{if(!i.trim()){f("Please enter JSON text");return}S(!0),f("");try{const p=B.importFromJSON(i);p.pattern?(u(p.pattern),f("")):(f(p.error||"Failed to import JSON pattern"),u(null))}catch(p){f(`Import failed: ${p instanceof Error?p.message:"Unknown error"}`),u(null)}finally{S(!1)}},P=p=>{const v=p.target.files?.[0];if(!v)return;S(!0),f("");const C=new FileReader;C.onload=x=>{const b=x.target?.result;if(!b){f("Failed to read file"),S(!1);return}try{let E;v.name.toLowerCase().endsWith(".rle")?E=G.import(b):v.name.toLowerCase().endsWith(".json")?E=B.importFromJSON(b):(E=G.import(b),E.pattern||(E=B.importFromJSON(b))),E.pattern?(u(E.pattern),f("")):(f(E.error||"Failed to import file"),u(null))}catch(E){f(`Import failed: ${E instanceof Error?E.message:"Unknown error"}`),u(null)}finally{S(!1)}},C.onerror=()=>{f("Failed to read file"),S(!1)},C.readAsText(v)},j=()=>{d&&(s(d),e())},T=()=>{n(""),o(""),u(null),f(""),R.current&&(R.current.value="")};return c.jsxs("div",{className:`pattern-import ${t}`,style:{display:"flex",flexDirection:"column",gap:"16px",padding:"20px",backgroundColor:"#1a1a2a",borderRadius:"12px",border:"1px solid #333344",maxWidth:"600px",width:"100%"},children:[c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[c.jsx("h3",{style:{margin:0,color:"#fff",fontSize:"18px"},children:"Import Pattern"}),c.jsx("button",{onClick:e,style:{background:"none",border:"none",color:"#ccc",fontSize:"18px",cursor:"pointer",padding:"4px 8px"},children:"×"})]}),c.jsx("div",{style:{display:"flex",gap:"8px",marginBottom:"12px"},children:["rle","json","file"].map(p=>c.jsx("button",{onClick:()=>a(p),style:{padding:"8px 16px",border:"1px solid #333344",borderRadius:"6px",backgroundColor:l===p?"#00d4ff":"#2a2a3a",color:l===p?"#000":"#ccc",cursor:"pointer",fontSize:"14px",textTransform:"uppercase"},children:p},p))}),l==="rle"&&c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[c.jsx("label",{style:{color:"#ccc",fontSize:"14px"},children:'RLE Pattern (e.g. "x = 3, y = 3, rule = B3/S23\\nbo$2bo$3o!")'}),c.jsx("textarea",{value:r,onChange:p=>n(p.target.value),placeholder:"Enter RLE pattern...",style:{minHeight:"120px",padding:"12px",borderRadius:"6px",border:"1px solid #333344",backgroundColor:"#2a2a3a",color:"#fff",fontSize:"14px",fontFamily:"monospace",resize:"vertical"}}),c.jsx("button",{onClick:M,disabled:g||!r.trim(),style:{padding:"10px 20px",borderRadius:"6px",border:"none",backgroundColor:g||!r.trim()?"#444":"#00d4ff",color:g||!r.trim()?"#888":"#000",cursor:g||!r.trim()?"not-allowed":"pointer",fontSize:"14px",fontWeight:"bold"},children:g?"Processing...":"Import RLE"})]}),l==="json"&&c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[c.jsx("label",{style:{color:"#ccc",fontSize:"14px"},children:"JSON Pattern (exported from CellularLab)"}),c.jsx("textarea",{value:i,onChange:p=>o(p.target.value),placeholder:"Paste JSON pattern...",style:{minHeight:"120px",padding:"12px",borderRadius:"6px",border:"1px solid #333344",backgroundColor:"#2a2a3a",color:"#fff",fontSize:"14px",fontFamily:"monospace",resize:"vertical"}}),c.jsx("button",{onClick:w,disabled:g||!i.trim(),style:{padding:"10px 20px",borderRadius:"6px",border:"none",backgroundColor:g||!i.trim()?"#444":"#00d4ff",color:g||!i.trim()?"#888":"#000",cursor:g||!i.trim()?"not-allowed":"pointer",fontSize:"14px",fontWeight:"bold"},children:g?"Processing...":"Import JSON"})]}),l==="file"&&c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[c.jsx("label",{style:{color:"#ccc",fontSize:"14px"},children:"Upload File (.rle, .json, or .txt)"}),c.jsx("input",{ref:R,type:"file",accept:".rle,.json,.txt",onChange:P,style:{padding:"12px",borderRadius:"6px",border:"1px solid #333344",backgroundColor:"#2a2a3a",color:"#ccc",fontSize:"14px"}})]}),m&&c.jsx("div",{style:{padding:"12px",borderRadius:"6px",backgroundColor:"#4a1a1a",border:"1px solid #aa3333",color:"#ffaaaa",fontSize:"14px"},children:m}),d&&c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px",padding:"16px",borderRadius:"6px",backgroundColor:"#2a2a3a",border:"1px solid #333344"},children:[c.jsx("div",{style:{color:"#ccc",fontSize:"14px",fontWeight:"bold"},children:"Preview:"}),c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[c.jsx(oe,{pattern:d,size:80}),c.jsxs("div",{style:{color:"#ccc",fontSize:"14px"},children:[c.jsx("div",{children:c.jsx("strong",{children:d.name})}),c.jsxs("div",{children:["Size: ",d.width," × ",d.height]}),c.jsxs("div",{children:["Cells: ",d.cells.length]}),d.rule&&c.jsxs("div",{children:["Rule: ",d.rule]})]})]}),c.jsxs("div",{style:{display:"flex",gap:"8px"},children:[c.jsx("button",{onClick:j,style:{padding:"10px 20px",borderRadius:"6px",border:"none",backgroundColor:"#00d4ff",color:"#000",cursor:"pointer",fontSize:"14px",fontWeight:"bold"},children:"Import Pattern"}),c.jsx("button",{onClick:T,style:{padding:"10px 20px",borderRadius:"6px",border:"1px solid #666",backgroundColor:"transparent",color:"#ccc",cursor:"pointer",fontSize:"14px"},children:"Clear"})]})]})]})},sr=({grid:s,gridWidth:e,gridHeight:t,rule:r,generation:n,canvasRef:i,onClose:o,className:l=""})=>{const[a,d]=h.useState("json"),[u,m]=h.useState("Custom Pattern"),[f,g]=h.useState(!1),[S,R]=h.useState(""),[M,w]=h.useState(""),P=A.gridToPattern(s,e,t,u);P.rule=r;const j=async()=>{if(!u.trim()){w("Please enter a pattern name");return}g(!0),w(""),R("");try{switch(a){case"json":{const b=B.exportToJSON(s,e,t,r,n,u);B.exportJSONToFile(b),R("JSON file downloaded successfully!");break}case"rle":{const b=G.exportToRLE(P),E=new Blob([b],{type:"text/plain"}),I=URL.createObjectURL(E),L=document.createElement("a");L.href=I,L.download=`${u.replace(/[^a-z0-9\-_]/gi,"_").toLowerCase()}.rle`,document.body.appendChild(L),L.click(),document.body.removeChild(L),URL.revokeObjectURL(I),R("RLE file downloaded successfully!");break}case"png":{if(!i?.current){w("Canvas not available for PNG export");return}B.exportCanvasToPNG(i.current,u),R("PNG image downloaded successfully!");break}default:w("Invalid export mode")}}catch(b){w(`Export failed: ${b instanceof Error?b.message:"Unknown error"}`)}finally{g(!1)}},T=()=>{switch(a){case"json":const b=B.exportToJSON(s,e,t,r,n,u);return JSON.stringify(b,null,2);case"rle":return G.exportToRLE(P);case"png":return"PNG image export (visual representation of current grid)";default:return""}},p=()=>{switch(a){case"json":return".json";case"rle":return".rle";case"png":return".png";default:return""}},v=P.cells.length,C=e*t,x=C>0?(v/C*100).toFixed(1):"0.0";return c.jsxs("div",{className:`pattern-export ${l}`,style:{display:"flex",flexDirection:"column",gap:"16px",padding:"20px",backgroundColor:"#1a1a2a",borderRadius:"12px",border:"1px solid #333344",maxWidth:"700px",width:"100%"},children:[c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[c.jsx("h3",{style:{margin:0,color:"#fff",fontSize:"18px"},children:"Export Pattern"}),c.jsx("button",{onClick:o,style:{background:"none",border:"none",color:"#ccc",fontSize:"18px",cursor:"pointer",padding:"4px 8px"},children:"×"})]}),c.jsxs("div",{style:{display:"flex",gap:"16px",padding:"16px",borderRadius:"8px",backgroundColor:"#2a2a3a",border:"1px solid #333344"},children:[c.jsx(oe,{pattern:P,size:80}),c.jsxs("div",{style:{color:"#ccc",fontSize:"14px"},children:[c.jsx("div",{style:{marginBottom:"8px"},children:c.jsx("strong",{style:{color:"#fff"},children:"Current Grid"})}),c.jsxs("div",{children:["Size: ",e," × ",t]}),c.jsxs("div",{children:["Living Cells: ",v]}),c.jsxs("div",{children:["Density: ",x,"%"]}),c.jsxs("div",{children:["Generation: ",n]}),c.jsxs("div",{children:["Rule: ",r]})]})]}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[c.jsx("label",{style:{color:"#ccc",fontSize:"14px",fontWeight:"bold"},children:"Pattern Name:"}),c.jsx("input",{type:"text",value:u,onChange:b=>m(b.target.value),placeholder:"Enter pattern name...",style:{padding:"10px 12px",borderRadius:"6px",border:"1px solid #333344",backgroundColor:"#2a2a3a",color:"#fff",fontSize:"14px"}})]}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[c.jsx("label",{style:{color:"#ccc",fontSize:"14px",fontWeight:"bold"},children:"Export Format:"}),c.jsx("div",{style:{display:"flex",gap:"8px"},children:["json","rle","png"].map(b=>c.jsx("button",{onClick:()=>d(b),style:{padding:"8px 16px",border:"1px solid #333344",borderRadius:"6px",backgroundColor:a===b?"#00d4ff":"#2a2a3a",color:a===b?"#000":"#ccc",cursor:"pointer",fontSize:"14px",textTransform:"uppercase"},children:b},b))}),c.jsxs("div",{style:{color:"#888",fontSize:"12px"},children:[a==="json"&&"CellularLab JSON format (can be imported back)",a==="rle"&&"Run Length Encoded format (standard cellular automata format)",a==="png"&&"PNG image of current grid visualization"]})]}),a!=="png"&&c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[c.jsx("label",{style:{color:"#ccc",fontSize:"14px",fontWeight:"bold"},children:"Preview:"}),c.jsx("textarea",{value:T(),readOnly:!0,style:{minHeight:"120px",maxHeight:"200px",padding:"12px",borderRadius:"6px",border:"1px solid #333344",backgroundColor:"#2a2a3a",color:"#ccc",fontSize:"12px",fontFamily:"monospace",resize:"vertical"}})]}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[c.jsxs("div",{style:{color:"#888",fontSize:"12px"},children:["File will be saved as: ",u.replace(/[^a-z0-9\-_]/gi,"_").toLowerCase(),p()]}),c.jsx("button",{onClick:j,disabled:f||!u.trim(),style:{padding:"12px 24px",borderRadius:"6px",border:"none",backgroundColor:f||!u.trim()?"#444":"#00d4ff",color:f||!u.trim()?"#888":"#000",cursor:f||!u.trim()?"not-allowed":"pointer",fontSize:"14px",fontWeight:"bold"},children:f?"Exporting...":`Export ${a.toUpperCase()}`})]}),S&&c.jsx("div",{style:{padding:"12px",borderRadius:"6px",backgroundColor:"#1a4a1a",border:"1px solid #33aa33",color:"#aaffaa",fontSize:"14px"},children:S}),M&&c.jsx("div",{style:{padding:"12px",borderRadius:"6px",backgroundColor:"#4a1a1a",border:"1px solid #aa3333",color:"#ffaaaa",fontSize:"14px"},children:M})]})},or=({onPatternSelect:s,grid:e,gridWidth:t=50,gridHeight:r=50,rule:n="B3/S23",generation:i=0,canvasRef:o,className:l=""})=>{const[a,d]=h.useState(null),[u,m]=h.useState(!1),[f,g]=h.useState(!1),[S,R]=h.useState(""),M=h.useMemo(()=>A.getAllFamousPatterns(),[]),w=h.useMemo(()=>S.trim()?M.filter(v=>v.name.toLowerCase().includes(S.toLowerCase())):M,[M,S]),P=v=>{d(v)},j=()=>{a&&s(a)},T=v=>{if(!a)return;let C;switch(v){case"rotate90":C=A.rotatePattern(a,90);break;case"rotate180":C=A.rotatePattern(a,180);break;case"rotate270":C=A.rotatePattern(a,270);break;case"flipH":C=A.flipPatternHorizontal(a);break;case"flipV":C=A.flipPatternVertical(a);break;default:return}d(C)},p=v=>{s(v)};return c.jsxs("div",{className:`pattern-library ${l}`,style:{display:"flex",flexDirection:"column",gap:"16px",padding:"20px",backgroundColor:"#1a1a2a",borderRadius:"12px",border:"1px solid #333344",maxWidth:"800px",width:"100%",maxHeight:"600px"},children:[u&&c.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"20px"},children:c.jsx(ir,{onImport:p,onClose:()=>m(!1)})}),f&&e&&c.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"20px"},children:c.jsx(sr,{grid:e,gridWidth:t,gridHeight:r,rule:n,generation:i,canvasRef:o,onClose:()=>g(!1)})}),c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[c.jsx("h3",{style:{margin:0,color:"#fff",fontSize:"18px"},children:"Pattern Library"}),c.jsxs("div",{style:{display:"flex",gap:"8px"},children:[c.jsx("button",{onClick:()=>m(!0),style:{padding:"8px 12px",borderRadius:"6px",border:"1px solid #333344",backgroundColor:"#2a2a3a",color:"#00d4ff",cursor:"pointer",fontSize:"12px",fontWeight:"bold"},children:"Import"}),e&&c.jsx("button",{onClick:()=>g(!0),style:{padding:"8px 12px",borderRadius:"6px",border:"1px solid #333344",backgroundColor:"#2a2a3a",color:"#00d4ff",cursor:"pointer",fontSize:"12px",fontWeight:"bold"},children:"Export"})]})]}),c.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:c.jsx("input",{type:"text",placeholder:"Search patterns...",value:S,onChange:v=>R(v.target.value),style:{padding:"10px 12px",borderRadius:"6px",border:"1px solid #333344",backgroundColor:"#2a2a3a",color:"#fff",fontSize:"14px"}})}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px",flex:1,overflowY:"auto"},children:[c.jsxs("div",{style:{color:"#ccc",fontSize:"14px",fontWeight:"bold"},children:["Famous Patterns (",w.length,")"]}),c.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(100px, 1fr))",gap:"12px",padding:"8px"},children:w.map(v=>c.jsx(oe,{pattern:v,size:80,selected:a?.name===v.name,onClick:()=>P(v)},v.name))}),w.length===0&&c.jsxs("div",{style:{textAlign:"center",color:"#888",fontSize:"14px",padding:"20px"},children:['No patterns found matching "',S,'"']})]}),a&&c.jsx("div",{style:{padding:"16px",borderRadius:"8px",backgroundColor:"#2a2a3a",border:"1px solid #333344"},children:c.jsxs("div",{style:{display:"flex",gap:"16px",alignItems:"flex-start"},children:[c.jsx(oe,{pattern:a,size:100}),c.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"12px"},children:[c.jsxs("div",{children:[c.jsx("div",{style:{color:"#fff",fontSize:"16px",fontWeight:"bold",marginBottom:"4px"},children:a.name}),c.jsxs("div",{style:{color:"#ccc",fontSize:"12px"},children:["Size: ",a.width," × ",a.height," | Cells: ",a.cells.length," | Rule: ",a.rule||"B3/S23"]})]}),c.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px"},children:[c.jsx("div",{style:{color:"#ccc",fontSize:"12px",fontWeight:"bold",width:"100%"},children:"Transformations:"}),c.jsx("button",{onClick:()=>T("rotate90"),style:{padding:"4px 8px",borderRadius:"4px",border:"1px solid #444",backgroundColor:"#3a3a4a",color:"#ccc",cursor:"pointer",fontSize:"11px"},children:"↻ 90°"}),c.jsx("button",{onClick:()=>T("rotate180"),style:{padding:"4px 8px",borderRadius:"4px",border:"1px solid #444",backgroundColor:"#3a3a4a",color:"#ccc",cursor:"pointer",fontSize:"11px"},children:"↻ 180°"}),c.jsx("button",{onClick:()=>T("rotate270"),style:{padding:"4px 8px",borderRadius:"4px",border:"1px solid #444",backgroundColor:"#3a3a4a",color:"#ccc",cursor:"pointer",fontSize:"11px"},children:"↻ 270°"}),c.jsx("button",{onClick:()=>T("flipH"),style:{padding:"4px 8px",borderRadius:"4px",border:"1px solid #444",backgroundColor:"#3a3a4a",color:"#ccc",cursor:"pointer",fontSize:"11px"},children:"↔ Flip H"}),c.jsx("button",{onClick:()=>T("flipV"),style:{padding:"4px 8px",borderRadius:"4px",border:"1px solid #444",backgroundColor:"#3a3a4a",color:"#ccc",cursor:"pointer",fontSize:"11px"},children:"↕ Flip V"})]}),c.jsx("button",{onClick:j,style:{padding:"10px 20px",borderRadius:"6px",border:"none",backgroundColor:"#00d4ff",color:"#000",cursor:"pointer",fontSize:"14px",fontWeight:"bold",alignSelf:"flex-start"},children:"Place Pattern"})]})]})})]})},ar=(s={})=>{const{enableKeyboardShortcuts:e=!0,enableScreenReaderAnnouncements:t=!0,enableFocusManagement:r=!0,reducedMotion:n=!1}=s,i=h.useRef(null),o=h.useRef(null),l=h.useRef(""),{simulation:a,grid:d,rule:u,startSimulation:m,stopSimulation:f,stepSimulation:g,clearGrid:S,setRule:R}=ae(),M=h.useCallback(()=>{const x=n||window.matchMedia("(prefers-reduced-motion: reduce)").matches,b=window.matchMedia("(prefers-contrast: high)").matches||window.matchMedia("(prefers-contrast: more)").matches,E=navigator.userAgent.includes("JAWS")||navigator.userAgent.includes("NVDA")||"speechSynthesis"in window;return{isKeyboardNavigation:document.querySelector(":focus-visible")!==null,isScreenReaderActive:E,hasReducedMotion:x,highContrastMode:b}},[n]),w=h.useCallback((x,b="polite")=>{if(!t||!i.current||l.current===x)return;l.current=x;const E=i.current;E.setAttribute("aria-live",b),E.textContent=x,setTimeout(()=>{E.textContent===x&&(E.textContent="")},1e3)},[t]),P=h.useCallback(x=>{if(!e)return;const b=x.ctrlKey||x.metaKey,E=x.target,I=E.tagName==="INPUT"||E.tagName==="TEXTAREA"||E.isContentEditable;if(!(I&&!b))switch(x.code){case"Space":I||(x.preventDefault(),a.isRunning?(f(),w("Simulation paused")):(m(),w("Simulation started")));break;case"ArrowRight":!I&&b&&(x.preventDefault(),g(),w(`Step completed. Generation ${d.generation+1}`));break;case"KeyR":b&&(x.preventDefault(),S(),w("Grid reset to empty state"));break;case"Escape":x.preventDefault();const L=document.querySelector('[role="dialog"]');if(L){const N=L.querySelector('button[aria-label*="close"], button[data-close]');N instanceof HTMLElement&&(N.click(),w("Modal closed"))}break;case"Tab":r&&document.querySelectorAll('button:not([disabled]), [href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"])').length>0&&(o.current=x.target);break;case"Digit1":case"Digit2":case"Digit3":case"Digit4":case"Digit5":if(b){x.preventDefault();const N=[{birth:[3],survival:[2,3],notation:"B3/S23"},{birth:[3,6],survival:[2,3],notation:"B36/S23"},{birth:[2],survival:[],notation:"B2/S"},{birth:[3,6,7,8],survival:[3,4,6,7,8],notation:"B3678/S34678"},{birth:[1],survival:[1],notation:"B1/S1"}],ce=parseInt(x.code.slice(-1))-1;if(ce>=0&&ce<N.length){const de=N[ce];de&&(R(de),w(`Rule changed to ${de.notation}`))}}break;case"KeyH":b&&(x.preventDefault(),j());break}},[e,a.isRunning,d.generation,m,f,g,S,R,w,r]),j=h.useCallback(()=>{const b="Keyboard shortcuts: "+["Space: Play/Pause simulation","Ctrl/Cmd + Right Arrow: Step forward","Ctrl/Cmd + R: Reset grid","Ctrl/Cmd + 1-5: Load preset rules","Escape: Close modals","Tab: Navigate focusable elements","Ctrl/Cmd + H: Show this help"].join(", ");w(b,"assertive"),k(b,{duration:5e3,icon:"⌨️"})},[w]),T=h.useCallback((x,b)=>{!r||!x||(requestAnimationFrame(()=>{x.focus(),b&&w(`Focus moved to ${b}`)}),o.current=x)},[r,w]),p=h.useCallback(x=>{if(!r)return()=>{};const b=x.querySelectorAll('button:not([disabled]), [href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"])'),E=b[0],I=b[b.length-1],L=N=>{N.key==="Tab"&&(N.shiftKey?document.activeElement===E&&(N.preventDefault(),I.focus()):document.activeElement===I&&(N.preventDefault(),E.focus()))};return x.addEventListener("keydown",L),()=>{x.removeEventListener("keydown",L)}},[r]),v=h.useCallback(()=>{if(!t)return null;if(!i.current){const x=document.createElement("div");x.setAttribute("aria-live","polite"),x.setAttribute("aria-atomic","true"),x.setAttribute("aria-relevant","text"),x.style.position="absolute",x.style.left="-10000px",x.style.width="1px",x.style.height="1px",x.style.overflow="hidden",document.body.appendChild(x),i.current=x}return i.current},[t]),C=h.useCallback((x,b)=>{Object.entries(b).forEach(([E,I])=>{x.setAttribute(E,I)})},[]);return h.useEffect(()=>{if(e)return document.addEventListener("keydown",P),()=>document.removeEventListener("keydown",P)},[P,e]),h.useEffect(()=>{const x=v();return()=>{x&&x.parentNode&&(x.parentNode.removeChild(x),i.current=null)}},[v]),h.useEffect(()=>{t&&w(`Cellular automata grid loaded. Size: ${d.width} by ${d.height}. Current rule: ${u.notation}`)},[]),h.useEffect(()=>{if(t&&a.isRunning){const x=setInterval(()=>{w(`Generation ${d.generation}, living cells: ${Array.from(d.current).filter(b=>b===1).length}`)},5e3);return()=>clearInterval(x)}},[a.isRunning,d.generation,d.current,w,t]),{announceToScreenReader:w,manageFocus:T,trapFocus:p,updateAriaProperties:C,showKeyboardShortcuts:j,getAccessibilityState:M,liveRegionRef:i}},O=class O{constructor(){y(this,"options");y(this,"fpsHistory",[]);y(this,"memoryHistory",[]);y(this,"rafId",null);y(this,"isMonitoring",!1);y(this,"onReportCallback");y(this,"warningThresholds");this.options={enableFPSMonitoring:!0,enableMemoryTracking:!0,enableBundleAnalysis:!0,sampleInterval:1e3,maxHistorySize:60},this.warningThresholds={frameRate:60,renderTime:16,memoryUsage:100,startupTime:2e3,targetFPS:60,maxMemoryMB:100,maxLoadTimeMS:2e3,maxBundleSizeMB:5,maxRuleSwitchingMS:50,maxGenerationTimeMS:16},this.setupPerformanceObserver()}static getInstance(){return O.instance||(O.instance=new O),O.instance}setOptions(e){this.options={...this.options,...e}}setReportCallback(e){this.onReportCallback=e}setWarningThresholds(e){this.warningThresholds={...this.warningThresholds,...e}}startMonitoring(){this.isMonitoring||(this.isMonitoring=!0,this.options.enableFPSMonitoring&&this.startFPSMonitoring(),this.options.enableMemoryTracking&&this.startMemoryTracking())}stopMonitoring(){this.isMonitoring&&(this.isMonitoring=!1,this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null))}startFPSMonitoring(){let e=performance.now(),t=0,r=e;const n=i=>{if(!this.isMonitoring)return;t++;const o=i-r;if(o>=1e3){const l=Math.round(t*1e3/o);this.recordFPS(l),t=0,r=i}this.rafId=requestAnimationFrame(n)};this.rafId=requestAnimationFrame(n)}startMemoryTracking(){const e=()=>{if(!this.isMonitoring)return;const t=this.getMemoryInfo();t&&this.recordMemory(t),setTimeout(e,this.options.sampleInterval)};e()}recordFPS(e){this.fpsHistory.push(e),this.fpsHistory.length>this.options.maxHistorySize&&this.fpsHistory.shift(),e<this.warningThresholds.targetFPS*.8&&this.detectPerformanceDegradation()}recordMemory(e){this.memoryHistory.push(e),this.memoryHistory.length>this.options.maxHistorySize&&this.memoryHistory.shift(),e.usedJSHeapSize/1024/1024>this.warningThresholds.maxMemoryMB&&this.detectMemoryLeak()}getMemoryInfo(){const e=performance.memory;return e?{usedJSHeapSize:e.usedJSHeapSize,totalJSHeapSize:e.totalJSHeapSize,jsHeapSizeLimit:e.jsHeapSizeLimit}:null}detectPerformanceDegradation(){const e=this.fpsHistory.slice(-10),t=e.reduce((r,n)=>r+n,0)/e.length;t<this.warningThresholds.targetFPS*.6?(console.warn(`[PerformanceProfiler] Severe FPS degradation detected: ${t}fps`),this.triggerDegradationWarning("severe","Low FPS detected")):t<this.warningThresholds.targetFPS*.8&&(console.warn(`[PerformanceProfiler] Moderate FPS degradation detected: ${t}fps`),this.triggerDegradationWarning("moderate","FPS below target"))}detectMemoryLeak(){if(this.memoryHistory.length<10)return;const e=this.memoryHistory.slice(-10),t=this.calculateMemoryGrowthRate(e);t>5&&(console.warn(`[PerformanceProfiler] Potential memory leak detected: ${t}MB/min growth`),this.triggerDegradationWarning("moderate","Memory usage growing rapidly"))}calculateMemoryGrowthRate(e){if(e.length<2)return 0;const t=e[0],r=e[e.length-1];if(!t||!r)return 0;const n=t.usedJSHeapSize/1024/1024,i=r.usedJSHeapSize/1024/1024,o=(e.length-1)*(this.options.sampleInterval/1e3/60);return(i-n)/o}triggerDegradationWarning(e,t){const r=this.generateReport();r.degradation.detected=!0,r.degradation.severity=e,r.degradation.causes.push(t),this.onReportCallback&&this.onReportCallback(r)}measureOperationTime(e,t){const r=performance.now(),n=e(),o=performance.now()-r;return console.log(`[PerformanceProfiler] ${t}: ${o.toFixed(2)}ms`),t.includes("rule switching")&&o>this.warningThresholds.maxRuleSwitchingMS&&console.warn(`[PerformanceProfiler] Slow rule switching: ${o.toFixed(2)}ms`),t.includes("generation")&&o>this.warningThresholds.maxGenerationTimeMS&&console.warn(`[PerformanceProfiler] Slow generation computation: ${o.toFixed(2)}ms`),n}async measureAsyncOperation(e,t){const r=performance.now(),n=await e(),o=performance.now()-r;return console.log(`[PerformanceProfiler] ${t}: ${o.toFixed(2)}ms`),n}generateReport(){const e=this.getMemoryInfo()||{usedJSHeapSize:0,totalJSHeapSize:0,jsHeapSizeLimit:0},t=this.calculateFPSMetrics(),r=this.calculateMemoryMetrics(e),n=this.getLoadTimeMetrics(),i=this.estimateBundleSize();return{fps:t,memory:r,loadTime:n,bundleSize:i,degradation:{detected:!1,severity:"none",causes:[],recommendations:this.generateRecommendations(t,r)},timestamp:new Date}}calculateFPSMetrics(){if(this.fpsHistory.length===0)return{current:0,average:0,min:0,max:0,history:[]};const e=this.fpsHistory[this.fpsHistory.length-1]||0,t=this.fpsHistory.reduce((i,o)=>i+o,0)/this.fpsHistory.length,r=Math.min(...this.fpsHistory),n=Math.max(...this.fpsHistory);return{current:e,average:Math.round(t),min:r,max:n,history:[...this.fpsHistory]}}calculateMemoryMetrics(e){const t=this.memoryHistory.reduce((i,o)=>o.usedJSHeapSize>i.usedJSHeapSize?o:i,e),r=this.memoryHistory.length>1?this.calculateMemoryGrowthRate(this.memoryHistory):0,n=r>2;return{current:e,peak:t,leaked:n,growthRate:r,history:[...this.memoryHistory]}}getLoadTimeMetrics(){try{const t=(performance.getEntriesByType?performance.getEntriesByType("navigation"):[])[0];return t?{initial:t.loadEventEnd-t.fetchStart,interactive:t.domInteractive-t.fetchStart,complete:t.loadEventEnd-t.fetchStart}:{initial:0,interactive:0,complete:0}}catch{return{initial:0,interactive:0,complete:0}}}estimateBundleSize(){const e=performance.getEntriesByType("resource");let t=0;const r={};return e.forEach(n=>{if(n.name.includes(".js")||n.name.includes(".css")){const i=n.transferSize||n.encodedBodySize||0;t+=i;const o=n.name.split("/").pop()||"unknown";r[o]=i}}),{total:t,chunks:r,estimated:!0}}generateRecommendations(e,t){const r=[];return e.average<this.warningThresholds.targetFPS*.8&&(r.push("Consider reducing grid size for better performance"),r.push("Enable performance mode in settings")),t.current.usedJSHeapSize/1024/1024>this.warningThresholds.maxMemoryMB&&(r.push("Clear grid history to free memory"),r.push("Avoid running simulations for extended periods")),t.leaked&&(r.push("Refresh the page to clear memory leaks"),r.push("Report persistent memory issues")),r}runBenchmarks(){const e=[],t=this.generateReport();e.push({name:"Average FPS",target:this.warningThresholds.targetFPS,current:t.fps.average,status:t.fps.average>=this.warningThresholds.targetFPS?"pass":t.fps.average>=this.warningThresholds.targetFPS*.8?"warning":"fail",impact:"high"});const r=t.memory.current.usedJSHeapSize/1024/1024;e.push({name:"Memory Usage (MB)",target:this.warningThresholds.maxMemoryMB,current:Math.round(r),status:r<=this.warningThresholds.maxMemoryMB?"pass":r<=this.warningThresholds.maxMemoryMB*1.2?"warning":"fail",impact:"medium"}),e.push({name:"Initial Load Time (ms)",target:this.warningThresholds.maxLoadTimeMS,current:Math.round(t.loadTime.initial),status:t.loadTime.initial<=this.warningThresholds.maxLoadTimeMS?"pass":t.loadTime.initial<=this.warningThresholds.maxLoadTimeMS*1.2?"warning":"fail",impact:"medium"});const n=t.bundleSize.total/1024/1024;return e.push({name:"Bundle Size (MB)",target:this.warningThresholds.maxBundleSizeMB,current:Math.round(n*100)/100,status:n<=this.warningThresholds.maxBundleSizeMB?"pass":n<=this.warningThresholds.maxBundleSizeMB*1.1?"warning":"fail",impact:"low"}),e}setupPerformanceObserver(){if("PerformanceObserver"in window)try{new PerformanceObserver(t=>{t.getEntries().forEach(n=>{n.entryType==="measure"&&console.log(`[PerformanceProfiler] ${n.name}: ${n.duration.toFixed(2)}ms`)})}).observe({entryTypes:["measure","navigation","paint"]})}catch{console.warn("[PerformanceProfiler] PerformanceObserver not fully supported")}}markStart(e){performance.mark(`${e}-start`)}markEnd(e){performance.mark(`${e}-end`);try{performance.measure(e,`${e}-start`,`${e}-end`)}catch{console.warn(`[PerformanceProfiler] Failed to measure ${e}`)}}clearMarks(e){e?(performance.clearMarks(`${e}-start`),performance.clearMarks(`${e}-end`),performance.clearMeasures(e)):(performance.clearMarks(),performance.clearMeasures())}getDetailedReport(){const e=this.generateReport(),t=this.runBenchmarks();return`
# Performance Report - ${e.timestamp.toLocaleString()}

## FPS Metrics
- Current: ${e.fps.current} fps
- Average: ${e.fps.average} fps
- Min: ${e.fps.min} fps
- Max: ${e.fps.max} fps

## Memory Usage
- Current: ${Math.round(e.memory.current.usedJSHeapSize/1024/1024)}MB
- Peak: ${Math.round(e.memory.peak.usedJSHeapSize/1024/1024)}MB
- Growth Rate: ${e.memory.growthRate.toFixed(2)}MB/min
- Memory Leak: ${e.memory.leaked?"Detected":"None"}

## Load Performance
- Initial Load: ${Math.round(e.loadTime.initial)}ms
- Interactive: ${Math.round(e.loadTime.interactive)}ms
- Complete: ${Math.round(e.loadTime.complete)}ms

## Bundle Analysis
- Total Size: ${Math.round(e.bundleSize.total/1024/1024*100)/100}MB
- Main Chunks: ${Object.entries(e.bundleSize.chunks).map(([r,n])=>`${r}: ${Math.round(n/1024)}KB`).join(", ")}

## Benchmarks
${t.map(r=>`- ${r.name}: ${r.current}/${r.target} - ${r.status.toUpperCase()}`).join(`
`)}

## Recommendations
${e.degradation.recommendations.map(r=>`- ${r}`).join(`
`)}
`}};y(O,"instance");let xe=O;const W=xe.getInstance();var Ne=(s=>(s.LOW="low",s.MEDIUM="medium",s.HIGH="high",s.CRITICAL="critical",s))(Ne||{});class $e extends Error{constructor(t,r,n="medium",i=void 0,o=!0){super(r);y(this,"code");y(this,"severity");y(this,"context");y(this,"recoverable");this.name="CellularLabError",this.code=t,this.severity=n,this.context=i,this.recoverable=o}}const _=class _{constructor(){y(this,"errorLog",[]);y(this,"maxLogSize",100);y(this,"onErrorCallback")}static getInstance(){return _.instance||(_.instance=new _),_.instance}setErrorCallback(e){this.onErrorCallback=e}getSystemInfo(){return{browserInfo:navigator.userAgent,timestamp:new Date,userAgent:navigator.userAgent}}createErrorInfo(e,t){if(e instanceof $e)return{code:e.code,message:e.message,severity:e.severity,context:{...this.getSystemInfo(),...e.context||{},...t||{}},recoverable:e.recoverable,userMessage:this.getUserMessage(e.code,e.message),recoveryActions:this.getRecoveryActions(e.code)};const r=this.classifyError(e),n=this.determineSeverity(r,e);return{code:r,message:e.message,severity:n,context:{...this.getSystemInfo(),...t||{},stackTrace:e.stack||"No stack trace available"},recoverable:this.isRecoverable(r),userMessage:this.getUserMessage(r,e.message),recoveryActions:this.getRecoveryActions(r)}}classifyError(e){const t=e.message.toLowerCase(),r=e.stack?.toLowerCase()||"";return t.includes("canvas")||t.includes("2d")||t.includes("webgl")?"CANVAS_NOT_SUPPORTED":t.includes("memory")||t.includes("heap")?"MEMORY_EXCEEDED":t.includes("fetch")||t.includes("network")?"NETWORK_ERROR":t.includes("rle")||t.includes("pattern")?"PATTERN_IMPORT_FAILED":t.includes("rule")||t.includes("notation")?"INVALID_RULE_FORMAT":t.includes("grid")&&t.includes("size")?"GRID_SIZE_INVALID":r.includes("gridrenderer")||r.includes("rendering")?"RENDERING_FAILED":r.includes("ruleengine")||r.includes("simulation")?"SIMULATION_ERROR":"UNKNOWN_ERROR"}determineSeverity(e,t){switch(e){case"CANVAS_NOT_SUPPORTED":case"MEMORY_EXCEEDED":return"critical";case"RENDERING_FAILED":case"SIMULATION_ERROR":return"high";case"PATTERN_IMPORT_FAILED":case"INVALID_RULE_FORMAT":case"GRID_SIZE_INVALID":return"medium";case"NETWORK_ERROR":return"low";default:return"medium"}}isRecoverable(e){return!["CANVAS_NOT_SUPPORTED"].includes(e)}getUserMessage(e,t){return{CANVAS_NOT_SUPPORTED:"Your browser does not support HTML5 Canvas, which is required for this application. Please use a modern browser like Chrome, Firefox, Safari, or Edge.",MEMORY_EXCEEDED:"The application has run out of memory. Try reducing the grid size or refreshing the page.",PATTERN_IMPORT_FAILED:"Failed to import the pattern. Please check that the file format is correct (RLE or JSON).",INVALID_RULE_FORMAT:'The rule format is invalid. Please use the format "B3/S23" where numbers represent neighbor counts.',GRID_SIZE_INVALID:"The grid size is too large or invalid. Please choose a size between 20x20 and 200x200.",RENDERING_FAILED:"Failed to render the grid. This may be due to browser limitations or memory constraints.",SIMULATION_ERROR:"An error occurred during simulation. The simulation has been paused.",NETWORK_ERROR:"Network connection failed. Some features may not work properly.",UNKNOWN_ERROR:"An unexpected error occurred. Please try refreshing the page."}[e]||`An error occurred: ${t}`}getRecoveryActions(e){return{CANVAS_NOT_SUPPORTED:["Update your browser to the latest version","Try a different browser (Chrome, Firefox, Safari, Edge)","Enable hardware acceleration in browser settings"],MEMORY_EXCEEDED:["Reduce grid size to 100x100 or smaller","Close other browser tabs","Refresh the page to clear memory","Restart your browser"],PATTERN_IMPORT_FAILED:["Check file format (should be .rle or .json)","Verify file is not corrupted","Try a smaller pattern","Use manual pattern creation instead"],INVALID_RULE_FORMAT:['Use format B[numbers]/S[numbers] (e.g., "B3/S23")',"Check for typos in the rule","Try a preset rule instead","Refer to rule documentation"],GRID_SIZE_INVALID:["Choose size between 20x20 and 200x200","Use preset sizes","Clear browser cache if size persists","Refresh the page"],RENDERING_FAILED:["Reduce grid size","Close other applications using graphics","Update graphics drivers","Try refreshing the page"],SIMULATION_ERROR:["Reset the grid","Try a different rule","Reduce simulation speed","Refresh the page"],NETWORK_ERROR:["Check internet connection","Try again in a few moments","Use offline features only","Contact support if persistent"],UNKNOWN_ERROR:["Refresh the page","Clear browser cache","Try in a different browser","Report the issue if it persists"]}[e]||["Refresh the page","Try again","Contact support if the issue persists"]}handle(e,t){const r=this.createErrorInfo(e,t);return this.logError(r),this.notifyUser(r),this.onErrorCallback&&this.onErrorCallback(r),r}logError(e){console.error(`[CellularLab] ${e.code}: ${e.message}`,e.context),this.errorLog.unshift(e),this.errorLog.length>this.maxLogSize&&(this.errorLog=this.errorLog.slice(0,this.maxLogSize))}notifyUser(e){const t=this.getToastDuration(e.severity),r=this.getErrorIcon(e.severity);k.error(e.userMessage,{duration:t,icon:r,style:{maxWidth:"400px"}}),e.severity==="critical"&&this.showCriticalErrorModal(e)}getToastDuration(e){switch(e){case"low":return 3e3;case"medium":return 5e3;case"high":return 8e3;case"critical":return 0;default:return 5e3}}getErrorIcon(e){switch(e){case"low":return"⚠️";case"medium":return"❗";case"high":return"🚨";case"critical":return"💥";default:return"❗"}}showCriticalErrorModal(e){const t=document.createElement("div");t.className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",t.setAttribute("role","dialog"),t.setAttribute("aria-modal","true"),t.setAttribute("aria-labelledby","error-title"),t.innerHTML=`
      <div class="bg-white dark:bg-gray-800 p-6 rounded-lg max-w-md mx-4 shadow-xl">
        <h2 id="error-title" class="text-xl font-bold text-red-600 dark:text-red-400 mb-4">
          Critical Error
        </h2>
        <p class="text-gray-700 dark:text-gray-300 mb-4">
          ${e.userMessage}
        </p>
        <div class="mb-4">
          <h3 class="font-semibold text-gray-900 dark:text-gray-100 mb-2">
            Try these solutions:
          </h3>
          <ul class="list-disc list-inside text-sm text-gray-600 dark:text-gray-400 space-y-1">
            ${e.recoveryActions?.map(i=>`<li>${i}</li>`).join("")||""}
          </ul>
        </div>
        <div class="flex gap-2">
          <button id="error-close" class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors">
            Close
          </button>
          <button id="error-refresh" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors">
            Refresh Page
          </button>
        </div>
      </div>
    `;const r=t.querySelector("#error-close"),n=t.querySelector("#error-refresh");r?.addEventListener("click",()=>{document.body.removeChild(t)}),n?.addEventListener("click",()=>{window.location.reload()}),document.body.appendChild(t),requestAnimationFrame(()=>{t.querySelector("button")?.focus()})}getErrorLog(){return[...this.errorLog]}clearErrorLog(){this.errorLog=[]}createCanvasNotSupportedFallback(){const e=document.createElement("div");return e.className="flex flex-col items-center justify-center min-h-[400px] p-8 text-center bg-gray-50 dark:bg-gray-900 border-2 border-gray-200 dark:border-gray-700 rounded-lg",e.innerHTML=`
      <div class="text-6xl mb-4">🖥️</div>
      <h2 class="text-2xl font-bold text-gray-900 dark:text-gray-100 mb-4">
        Canvas Not Supported
      </h2>
      <p class="text-gray-600 dark:text-gray-400 mb-6 max-w-md">
        Your browser doesn't support HTML5 Canvas, which is required for this cellular automata simulator.
      </p>
      <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-600 mb-6">
        <h3 class="font-semibold text-gray-900 dark:text-gray-100 mb-2">
          Recommended Browsers:
        </h3>
        <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
          <li>• Chrome 80 or later</li>
          <li>• Firefox 75 or later</li>
          <li>• Safari 13 or later</li>
          <li>• Edge 80 or later</li>
        </ul>
      </div>
      <button onclick="window.location.reload()" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
        Try Again
      </button>
    `,e}checkBrowserSupport(){const e=[];return document.createElement("canvas").getContext||e.push("HTML5 Canvas"),window.localStorage||e.push("Local Storage"),(!window.CSS||!window.CSS.supports||!window.CSS.supports("display","grid"))&&e.push("CSS Grid"),(!window.CSS||!window.CSS.supports||!window.CSS.supports("--custom-property","value"))&&e.push("CSS Custom Properties"),Array.from||e.push("ES2015 Array.from"),Promise||e.push("ES2015 Promises"),{isSupported:e.length===0,missingFeatures:e}}};y(_,"instance");let ye=_;const be=ye.getInstance(),Y=(s,e)=>be.handle(s,e),lr=(s,e,t="medium",r,n=!0)=>new $e(s,e,t,r,n);function cr(){const s=h.useRef(null),e=h.useRef(null),{grid:t,simulation:r,rule:n,startSimulation:i,stopSimulation:o,stepSimulation:l,clearGrid:a,centerPattern:d,setPatternPlacementMode:u}=ae(),{announceToScreenReader:m,showKeyboardShortcuts:f,getAccessibilityState:g}=ar({enableKeyboardShortcuts:!0,enableScreenReaderAnnouncements:!0,enableFocusManagement:!0});h.useEffect(()=>(W.startMonitoring(),W.setWarningThresholds({targetFPS:60,maxMemoryMB:100,maxLoadTimeMS:2e3,maxBundleSizeMB:5,maxRuleSwitchingMS:50,maxGenerationTimeMS:16}),()=>{W.stopMonitoring()}),[]),h.useEffect(()=>{const p=be.checkBrowserSupport();if(!p.isSupported&&(console.error("Browser support issues:",p.missingFeatures),p.missingFeatures.includes("HTML5 Canvas"))){const v=be.createCanvasNotSupportedFallback(),C=document.querySelector('[data-testid="grid-container"]');C&&C.parentNode&&C.parentNode.replaceChild(v,C)}},[]);const S=g(),R=h.useCallback(()=>{const p=r.isRunning?"pause":"start";try{W.measureOperationTime(()=>{r.isRunning?o():i()},"simulation toggle");const v=r.isRunning?"Simulation paused":"Simulation started";re.success(v),m(v)}catch(v){const C=Y(v,{component:"App",operation:`simulation ${p}`});console.error("Simulation toggle failed:",C)}},[r.isRunning,i,o,m]),M=h.useCallback(()=>{try{W.measureOperationTime(()=>{l()},"generation computation");const p=`Generation ${t.generation+1}`;re.success(p),m(`Step completed. ${p}`)}catch(p){const v=Y(p,{component:"App",operation:"step simulation"});console.error("Step simulation failed:",v)}},[l,t.generation,m]),w=h.useCallback(()=>{try{r.isRunning&&o(),W.measureOperationTime(()=>{a()},"grid reset");const p="Grid cleared";re.success(p),m(p)}catch(p){const v=Y(p,{component:"App",operation:"reset grid"});console.error("Grid reset failed:",v)}},[r.isRunning,o,a,m]),P=h.useCallback(p=>{try{const v=d(p);if(v.success){const C=`${p.name} placed on grid`;re.success(C),m(C),u(!1)}else{const C=lr("PATTERN_PLACEMENT_FAILED",v.error||"Failed to place pattern",Ne.MEDIUM);Y(C,{component:"App",operation:"pattern placement"})}}catch(v){const C=Y(v,{component:"App",operation:"pattern placement"});console.error("Pattern placement failed:",C)}},[d,u,m]),j=h.useCallback(()=>{f()},[f]),T=["min-h-screen bg-background text-text-primary",S.highContrastMode&&"high-contrast",S.hasReducedMotion&&"reduce-motion"].filter(Boolean).join(" ");return c.jsxs("div",{ref:e,className:T,"data-testid":"app-root",children:[c.jsxs("div",{className:"container mx-auto px-4 py-8",children:[c.jsxs("header",{className:"text-center mb-8",children:[c.jsx("h1",{className:"text-3xl font-bold text-cell-alive mb-2",children:"CellularLab"}),c.jsx("p",{className:"text-text-secondary",children:"Interactive Cellular Automata Explorer"}),c.jsxs("div",{className:"sr-only",children:["Current rule: ",n.notation,". Grid size: ",t.width," by ",t.height,". Generation: ",t.generation,". Press Ctrl+H for keyboard shortcuts."]})]}),c.jsxs("main",{role:"main",className:"grid grid-cols-1 lg:grid-cols-4 gap-8",children:[c.jsx("section",{className:"lg:col-span-3","aria-labelledby":"grid-heading",children:c.jsxs("div",{className:"bg-surface rounded-lg p-6",children:[c.jsxs("div",{className:"flex justify-between items-center mb-4",children:[c.jsxs("h2",{id:"grid-heading",className:"text-xl font-semibold",children:["Grid (",t.width,"×",t.height,")"]}),c.jsxs("div",{className:"text-text-secondary","data-testid":"generation","aria-live":"polite","aria-atomic":"true",children:["Generation: ",t.generation]})]}),c.jsx(nr,{showPerformanceMetrics:!0,canvasRef:s,"aria-label":`Cellular automata grid, ${t.width} by ${t.height} cells, generation ${t.generation}`})]})}),c.jsxs("aside",{className:"space-y-6","aria-label":"Simulation controls and information",children:[c.jsxs("section",{className:"bg-surface rounded-lg p-6","aria-labelledby":"controls-heading",children:[c.jsx("h3",{id:"controls-heading",className:"text-lg font-semibold mb-4",children:"Simulation Controls"}),c.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-4",role:"group","aria-label":"Simulation actions",children:[c.jsxs("button",{onClick:R,className:"flex items-center justify-center gap-2 px-4 py-2 bg-primary-light hover:bg-opacity-80 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-cell-alive focus:ring-offset-2","aria-pressed":r.isRunning,"aria-label":r.isRunning?"Pause simulation":"Start simulation","data-testid":"play-pause-button",children:[r.isRunning?c.jsx(nt,{size:16}):c.jsx(st,{size:16}),r.isRunning?"Pause":"Play"]}),c.jsxs("button",{onClick:M,disabled:r.isRunning,className:"flex items-center justify-center gap-2 px-4 py-2 bg-primary-medium hover:bg-opacity-80 disabled:opacity-50 disabled:cursor-not-allowed rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-cell-alive focus:ring-offset-2","aria-label":"Step simulation forward one generation","aria-describedby":r.isRunning?"step-disabled-help":void 0,"data-testid":"step-button",children:[c.jsx(ct,{size:16}),"Step"]}),r.isRunning&&c.jsx("div",{id:"step-disabled-help",className:"sr-only",children:"Step button is disabled while simulation is running"})]}),c.jsxs("button",{onClick:w,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-warning hover:bg-opacity-80 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-warning focus:ring-offset-2","aria-label":"Reset grid to empty state","data-testid":"reset-button",children:[c.jsx(at,{size:16}),"Reset"]})]}),c.jsxs("section",{className:"bg-surface rounded-lg p-6","aria-labelledby":"rule-heading",children:[c.jsx("h3",{id:"rule-heading",className:"text-lg font-semibold mb-4",children:"Current Rule"}),c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"text-2xl font-mono text-cell-alive mb-2","aria-label":`Rule notation: ${n.notation}`,children:n.notation}),c.jsx("div",{className:"text-sm text-text-secondary",children:"Conway's Game of Life"})]})]}),c.jsxs("section",{className:"bg-surface rounded-lg p-6","aria-labelledby":"speed-heading",children:[c.jsx("h3",{id:"speed-heading",className:"text-lg font-semibold mb-4",children:"Simulation Speed"}),c.jsxs("div",{className:"text-center text-text-secondary","aria-label":`${r.speed} milliseconds per generation`,children:[r.speed,"ms per generation"]})]}),c.jsxs("section",{className:"bg-surface rounded-lg p-6","aria-labelledby":"help-heading",children:[c.jsx("h3",{id:"help-heading",className:"text-lg font-semibold mb-4",children:"Help"}),c.jsxs("button",{onClick:j,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-secondary hover:bg-opacity-80 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-cell-alive focus:ring-offset-2","aria-label":"Show keyboard shortcuts",children:[c.jsx(tt,{size:16}),"Keyboard Shortcuts"]})]})]})]}),c.jsx("section",{className:"mt-8","aria-labelledby":"patterns-heading",children:c.jsxs("div",{className:"bg-surface rounded-lg p-6",children:[c.jsx("h2",{id:"patterns-heading",className:"sr-only",children:"Pattern Library"}),c.jsx(or,{onPatternSelect:P,grid:t.current,gridWidth:t.width,gridHeight:t.height,rule:n.notation,generation:t.generation,canvasRef:s})]})})]}),!1]})}const Ae=document.getElementById("root");if(!Ae)throw new Error("Root element not found");Xe.createRoot(Ae).render(c.jsxs(Ue.StrictMode,{children:[c.jsx(cr,{}),c.jsx(Qt,{position:"top-right",toastOptions:{duration:3e3,style:{background:"#1e1e2f",color:"#ffffff",border:"1px solid #333344"}}})]}));
