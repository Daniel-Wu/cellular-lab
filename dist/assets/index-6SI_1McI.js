var De=Object.defineProperty;var Fe=(i,e,t)=>e in i?De(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var y=(i,e,t)=>Fe(i,typeof e!="symbol"?e+"":e,t);import{r as Oe,a as ze,g as _e}from"./react-DavUf6mE.js";import{c as Be,r as h,R as Ue}from"./zustand-YjDNudvZ.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}})();var ue={exports:{}},Y={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var be;function Ge(){if(be)return Y;be=1;var i=Oe(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,s=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,n={key:!0,ref:!0,__self:!0,__source:!0};function a(c,o,d){var u,m={},f=null,g=null;d!==void 0&&(f=""+d),o.key!==void 0&&(f=""+o.key),o.ref!==void 0&&(g=o.ref);for(u in o)r.call(o,u)&&!n.hasOwnProperty(u)&&(m[u]=o[u]);if(c&&c.defaultProps)for(u in o=c.defaultProps,o)m[u]===void 0&&(m[u]=o[u]);return{$$typeof:e,type:c,key:f,ref:g,props:m,_owner:s.current}}return Y.Fragment=t,Y.jsx=a,Y.jsxs=a,Y}var we;function He(){return we||(we=1,ue.exports=Ge()),ue.exports}var l=He(),Q={},Se;function Je(){if(Se)return Q;Se=1;var i=ze();return Q.createRoot=i.createRoot,Q.hydrateRoot=i.hydrateRoot,Q}var Xe=Je();const Ye=_e(Xe),V=class V{constructor(){y(this,"performanceMetrics",{lastRenderTime:0,averageRenderTime:0,renderCount:0})}static getPresetRule(e){const t=V.PRESET_RULES[e];return{birth:[...t.birth],survival:[...t.survival],notation:t.notation}}static getAllPresetRules(){return Object.entries(V.PRESET_RULES).map(([e,t])=>({id:e,name:e.charAt(0).toUpperCase()+e.slice(1),birth:[...t.birth],survival:[...t.survival],notation:t.notation}))}countNeighbors(e,t,r,s,n){let a=0;const c=t-1,o=r-1,d=s>0?-1:0,u=s<c?1:0,m=n>0?-1:0,f=n<o?1:0;for(let g=m;g<=f;g++){const w=(n+g)*t;for(let R=d;R<=u;R++)R===0&&g===0||(a+=e[w+s+R]??0)}return a}computeNextGeneration(e,t,r,s){const n=performance.now(),a=new Uint8Array(e.length),c=new Set(s.birth),o=new Set(s.survival);for(let u=0;u<r;u++){const m=u*t;for(let f=0;f<t;f++){const g=m+f,w=this.countNeighbors(e,t,r,f,u);e[g]===1?a[g]=o.has(w)?1:0:a[g]=c.has(w)?1:0}}const d=performance.now();return this.updatePerformanceMetrics(d-n),a}updatePerformanceMetrics(e){this.performanceMetrics.lastRenderTime=e,this.performanceMetrics.renderCount++;const t=.1;this.performanceMetrics.renderCount===1?this.performanceMetrics.averageRenderTime=e:this.performanceMetrics.averageRenderTime=t*e+(1-t)*this.performanceMetrics.averageRenderTime}getPerformanceMetrics(){return{...this.performanceMetrics}}resetPerformanceMetrics(){this.performanceMetrics={lastRenderTime:0,averageRenderTime:0,renderCount:0}}static validateGridBounds(e,t){return e>=20&&e<=200&&t>=20&&t<=200&&e*t<=4e4}static copyGrid(e){return new Uint8Array(e)}};y(V,"PRESET_RULES",{conway:{birth:[3],survival:[2,3],notation:"B3/S23"},highlife:{birth:[3,6],survival:[2,3],notation:"B36/S23"},seeds:{birth:[2],survival:[],notation:"B2/S"},daynight:{birth:[3,6,7,8],survival:[3,4,6,7,8],notation:"B3678/S34678"}});let he=V;var me=(i=>(i.CANVAS_UNSUPPORTED="canvas_unsupported",i.MEMORY_EXCEEDED="memory_exceeded",i.INVALID_RULE="invalid_rule",i.PATTERN_TOO_LARGE="pattern_too_large",i.IMPORT_FAILED="import_failed",i))(me||{});class Me{static validateRule(e){if(!e||typeof e!="string")return{valid:!1,error:"Rule notation must be a non-empty string"};const t=e.trim();if(t==="")return{valid:!1,error:"Rule notation cannot be empty"};const r=/^B([0-8]*)\/S([0-8]*)$/,s=t.match(r);if(!s)return{valid:!1,error:'Invalid format. Use B/S notation like "B3/S23" (numbers 0-8 only)'};const n=s[1]??"",a=s[2]??"";if(n.length>9)return{valid:!1,error:"Too many birth conditions (maximum 9)"};if(a.length>9)return{valid:!1,error:"Too many survival conditions (maximum 9)"};const c=n.split("").map(Number),o=a.split("").map(Number);return new Set(c).size!==c.length?{valid:!1,error:"Duplicate birth conditions not allowed"}:new Set(o).size!==o.length?{valid:!1,error:"Duplicate survival conditions not allowed"}:{valid:!0}}static parseRule(e){if(!this.validateRule(e).valid)return null;const r=e.trim().match(/^B([0-8]*)\/S([0-8]*)$/);if(!r)return null;const s=r[1]??"",n=r[2]??"";return{birth:s.split("").map(Number),survival:n.split("").map(Number),notation:e.trim()}}static formatRule(e,t){const r=[...e].sort((n,a)=>n-a),s=[...t].sort((n,a)=>n-a);return`B${r.join("")}/S${s.join("")}`}static getPresetRule(e){const t=this.PRESET_RULES[e];return{name:t.name,birth:[...t.birth],survival:[...t.survival],notation:t.notation,description:t.description}}static getAllPresetRules(){return Object.entries(this.PRESET_RULES).map(([e,t])=>({id:e,name:t.name,birth:[...t.birth],survival:[...t.survival],notation:t.notation,description:t.description}))}static isPresetRule(e){const t=e.trim();for(const[r,s]of Object.entries(this.PRESET_RULES))if(s.notation===t)return r;return null}static getPresetRuleByNotation(e){const t=this.isPresetRule(e);return t?this.getPresetRule(t):null}static validateRuleNumbers(e,t){for(const r of e)if(!Number.isInteger(r)||r<0||r>8)return{valid:!1,error:`Invalid birth condition: ${r}. Must be integer 0-8`};for(const r of t)if(!Number.isInteger(r)||r<0||r>8)return{valid:!1,error:`Invalid survival condition: ${r}. Must be integer 0-8`};return new Set(e).size!==e.length?{valid:!1,error:"Duplicate birth conditions not allowed"}:new Set(t).size!==t.length?{valid:!1,error:"Duplicate survival conditions not allowed"}:{valid:!0}}static createRule(e,t){return this.validateRuleNumbers(e,t).valid?{birth:[...e].sort((s,n)=>s-n),survival:[...t].sort((s,n)=>s-n),notation:this.formatRule(e,t)}:null}static rulesEqual(e,t){const r=[...e.birth].sort((c,o)=>c-o),s=[...t.birth].sort((c,o)=>c-o),n=[...e.survival].sort((c,o)=>c-o),a=[...t.survival].sort((c,o)=>c-o);return r.length===s.length&&n.length===a.length&&r.every((c,o)=>c===s[o])&&n.every((c,o)=>c===a[o])}}y(Me,"PRESET_RULES",{conway:{name:"Conway's Game of Life",birth:[3],survival:[2,3],notation:"B3/S23",description:"The classic cellular automaton with balanced birth and survival rules"},highlife:{name:"HighLife",birth:[3,6],survival:[2,3],notation:"B36/S23",description:"Like Conway's Life but with additional birth on 6 neighbors, creating replicators"},seeds:{name:"Seeds",birth:[2],survival:[],notation:"B2/S",description:"Every living cell dies, new cells born with 2 neighbors - creates explosive growth"},daynight:{name:"Day & Night",birth:[3,6,7,8],survival:[3,4,6,7,8],notation:"B3678/S34678",description:"Symmetric rule where both crowded and sparse areas can sustain life"}});class J{static coordinatesToIndex(e,t,r){return t*r+e}static indexToCoordinates(e,t){return{x:e%t,y:Math.floor(e/t)}}static isValidCoordinate(e,t,r,s){return e>=0&&e<r&&t>=0&&t<s}static isValidIndex(e,t){return e>=0&&e<t}static createEmptyGrid(e,t){return new Uint8Array(e*t)}static createFilledGrid(e,t,r){const s=new Uint8Array(e*t);return r===1&&s.fill(1),s}static copyGrid(e){return new Uint8Array(e)}static clearGrid(e){e.fill(0)}static countLivingCells(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r]??0;return t}static calculateDensity(e){const t=this.countLivingCells(e);return e.length>0?t/e.length:0}static getLivingCellCoordinates(e,t){const r=[];for(let s=0;s<e.length;s++)e[s]===1&&r.push(this.indexToCoordinates(s,t));return r}static getLivingCellPositions(e,t){const r=[];for(let s=0;s<e.length;s++)if(e[s]===1){const n=this.indexToCoordinates(s,t);r.push({index:s,x:n.x,y:n.y})}return r}static gridsEqual(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}static getGridBounds(e,t,r){let s=t,n=-1,a=r,c=-1;for(let o=0;o<e.length;o++)if(e[o]===1){const d=this.indexToCoordinates(o,t);s=Math.min(s,d.x),n=Math.max(n,d.x),a=Math.min(a,d.y),c=Math.max(c,d.y)}return n===-1?null:{minX:s,maxX:n,minY:a,maxY:c}}static centerPattern(e,t,r,s){return{x:Math.floor((r-e)/2),y:Math.floor((s-t)/2)}}static canFitPattern(e,t,r,s,n,a){return r>=0&&s>=0&&r+e<=n&&s+t<=a}static getGridStatistics(e,t,r){const s=this.countLivingCells(e),n=this.calculateDensity(e),a=this.getGridBounds(e,t,r);return{totalCells:e.length,livingCells:s,deadCells:e.length-s,density:n,bounds:a,isEmpty:s===0,isFull:s===e.length}}static resizeGrid(e,t,r,s,n,a=!0){const c=this.createEmptyGrid(s,n);if(a){const o=Math.floor((s-t)/2),d=Math.floor((n-r)/2),u=Math.min(t,s),m=Math.min(r,n),f=Math.max(0,-o),g=Math.max(0,-d),w=Math.max(0,o),R=Math.max(0,d);for(let M=0;M<m-Math.abs(Math.min(0,d));M++)for(let S=0;S<u-Math.abs(Math.min(0,o));S++){const P=this.coordinatesToIndex(f+S,g+M,t),k=this.coordinatesToIndex(w+S,R+M,s);P<e.length&&k<c.length&&(c[k]=e[P]??0)}}else{const o=Math.min(t,s),d=Math.min(r,n);for(let u=0;u<d;u++)for(let m=0;m<o;m++){const f=this.coordinatesToIndex(m,u,t),g=this.coordinatesToIndex(m,u,s);c[g]=e[f]??0}}return c}}class A{static getFamousPattern(e){const t=this.FAMOUS_PATTERNS[e.toLowerCase()];return t?{...t,cells:[...t.cells]}:null}static getAllFamousPatterns(){return Object.values(this.FAMOUS_PATTERNS).map(e=>({...e,cells:[...e.cells]}))}static validatePattern(e){if(!e.name||e.name.trim()==="")return{valid:!1,error:"Pattern must have a name"};if(e.width<=0||e.height<=0)return{valid:!1,error:"Pattern dimensions must be positive"};if(e.width>200||e.height>200)return{valid:!1,error:"Pattern too large (maximum 200x200)"};for(const r of e.cells)if(r.x<0||r.x>=e.width||r.y<0||r.y>=e.height)return{valid:!1,error:`Cell at (${r.x}, ${r.y}) is outside pattern bounds`};return new Set(e.cells.map(r=>`${r.x},${r.y}`)).size!==e.cells.length?{valid:!1,error:"Pattern contains duplicate cells"}:{valid:!0}}static patternToGrid(e){const t=new Uint8Array(e.width*e.height);for(const r of e.cells){const s=J.coordinatesToIndex(r.x,r.y,e.width);s>=0&&s<t.length&&(t[s]=1)}return t}static gridToPattern(e,t,r,s="Custom Pattern"){const n=[];for(let a=0;a<e.length;a++)if(e[a]===1){const c=J.indexToCoordinates(a,t);n.push(c)}return{name:s,width:t,height:r,cells:n}}static placePatternOnGrid(e,t,r,s,n,a,c=!0){if(!this.validatePattern(s).valid)return{success:!1,error:me.PATTERN_TOO_LARGE};if(!J.canFitPattern(s.width,s.height,n,a,t,r))return{success:!1,error:me.PATTERN_TOO_LARGE};for(const d of s.cells){const u=n+d.x,m=a+d.y;if(J.isValidCoordinate(u,m,t,r)){const f=J.coordinatesToIndex(u,m,t);(c||e[f]===0)&&(e[f]=1)}}return{success:!0}}static centerPatternOnGrid(e,t,r,s,n=!0){const a=J.centerPattern(s.width,s.height,t,r);return this.placePatternOnGrid(e,t,r,s,a.x,a.y,n)}static rotatePattern(e,t){if(!this.validatePattern(e).valid)return e;let s,n=e.width,a=e.height;switch(t){case 90:n=e.height,a=e.width,s=e.cells.map(c=>({x:e.height-1-c.y,y:c.x}));break;case 180:s=e.cells.map(c=>({x:e.width-1-c.x,y:e.height-1-c.y}));break;case 270:n=e.height,a=e.width,s=e.cells.map(c=>({x:c.y,y:e.width-1-c.x}));break;default:s=[...e.cells]}return{name:`${e.name} (${t}°)`,width:n,height:a,cells:s,...e.rule&&{rule:e.rule}}}static flipPatternHorizontal(e){if(!this.validatePattern(e).valid)return e;const r=e.cells.map(s=>({x:e.width-1-s.x,y:s.y}));return{name:`${e.name} (H-flip)`,width:e.width,height:e.height,cells:r,...e.rule&&{rule:e.rule}}}static flipPatternVertical(e){if(!this.validatePattern(e).valid)return e;const r=e.cells.map(s=>({x:s.x,y:e.height-1-s.y}));return{name:`${e.name} (V-flip)`,width:e.width,height:e.height,cells:r,...e.rule&&{rule:e.rule}}}static scalePattern(e,t){if(!this.validatePattern(e).valid||t<=0)return e;const s=Math.floor(e.width*t),n=Math.floor(e.height*t);if(s>200||n>200)return e;const a=[];for(const o of e.cells)for(let d=0;d<t;d++)for(let u=0;u<t;u++){const m=Math.floor(o.x*t)+u,f=Math.floor(o.y*t)+d;m<s&&f<n&&a.push({x:m,y:f})}const c=Array.from(new Set(a.map(o=>`${o.x},${o.y}`))).map(o=>{const[d,u]=o.split(",").map(Number);return{x:d,y:u}});return{name:`${e.name} (${t}x)`,width:s,height:n,cells:c,...e.rule&&{rule:e.rule}}}static getPatternBounds(e){if(e.cells.length===0)return null;let t=e.width,r=-1,s=e.height,n=-1;for(const a of e.cells)t=Math.min(t,a.x),r=Math.max(r,a.x),s=Math.min(s,a.y),n=Math.max(n,a.y);return{minX:t,maxX:r,minY:s,maxY:n}}static normalizePattern(e){const t=this.getPatternBounds(e);if(!t)return e;const r=e.cells.map(s=>({x:s.x-t.minX,y:s.y-t.minY}));return{name:e.name,width:t.maxX-t.minX+1,height:t.maxY-t.minY+1,cells:r,...e.rule&&{rule:e.rule}}}static patternsEqual(e,t){if(e.width!==t.width||e.height!==t.height||e.cells.length!==t.cells.length)return!1;const r=new Set(e.cells.map(n=>`${n.x},${n.y}`)),s=new Set(t.cells.map(n=>`${n.x},${n.y}`));return r.size===s.size&&[...r].every(n=>s.has(n))}}y(A,"FAMOUS_PATTERNS",{glider:{name:"Glider",width:3,height:3,cells:[{x:1,y:0},{x:2,y:1},{x:0,y:2},{x:1,y:2},{x:2,y:2}],rule:"B3/S23"},blinker:{name:"Blinker",width:3,height:1,cells:[{x:0,y:0},{x:1,y:0},{x:2,y:0}],rule:"B3/S23"},block:{name:"Block",width:2,height:2,cells:[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1}],rule:"B3/S23"},beacon:{name:"Beacon",width:4,height:4,cells:[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:3,y:2},{x:2,y:3},{x:3,y:3}],rule:"B3/S23"},toad:{name:"Toad",width:4,height:2,cells:[{x:1,y:0},{x:2,y:0},{x:3,y:0},{x:0,y:1},{x:1,y:1},{x:2,y:1}],rule:"B3/S23"}});class G{static import(e){if(!e||typeof e!="string")return{pattern:null,error:"Invalid RLE input"};const t=e.trim().split(/\r?\n/).filter(u=>u.trim());if(t.length===0)return{pattern:null,error:"Empty RLE input"};let r="",s=[],n=!1;for(const u of t){const m=u.trim();m.startsWith("#")||(!n&&this.HEADER_REGEX.test(m)?(r=m,n=!0):(n||this.containsRLECharacters(m))&&s.push(m))}if(!n&&s.length===0)return{pattern:null,error:"No valid RLE pattern found"};let a=0,c=0,o="B3/S23";if(r){const u=r.match(this.HEADER_REGEX);if(u&&(a=parseInt(u[1],10),c=parseInt(u[2],10),u[3])){const m=u[3].trim();Me.validateRule(m).valid&&(o=m)}}const d=s.join("").replace(/\s+/g,"");if(!this.RLE_PATTERN_REGEX.test(d))return{pattern:null,error:"Invalid RLE pattern format"};try{const u=this.parseRLEPattern(d),m=this.calculateBounds(u);return a===0&&(a=m.maxX+1),c===0&&(c=m.maxY+1),a>200||c>200?{pattern:null,error:"Pattern too large (maximum 200x200)"}:{pattern:{name:"Imported Pattern",width:a,height:c,cells:u,rule:o}}}catch(u){return{pattern:null,error:`RLE parsing error: ${u instanceof Error?u.message:"Unknown error"}`}}}static containsRLECharacters(e){return/[bo$!]/.test(e)}static parseRLEPattern(e){const t=[];let r=0,s=0,n=0;for(;n<e.length&&e[n]!=="!";){let a=1,c="";for(;n<e.length&&/\d/.test(e[n]);)c+=e[n],n++;if(c&&(a=parseInt(c,10),a<=0||a>1e3))throw new Error(`Invalid run count: ${a}`);if(n>=e.length)throw new Error("Unexpected end of pattern");const o=e[n];switch(o){case"b":r+=a;break;case"o":for(let d=0;d<a;d++)t.push({x:r+d,y:s});r+=a;break;case"$":s+=a,r=0;break;default:throw new Error(`Invalid RLE character: ${o}`)}n++}return t}static calculateBounds(e){if(e.length===0)return{minX:0,maxX:0,minY:0,maxY:0};let t=e[0].x,r=e[0].x,s=e[0].y,n=e[0].y;for(const a of e)t=Math.min(t,a.x),r=Math.max(r,a.x),s=Math.min(s,a.y),n=Math.max(n,a.y);return{minX:t,maxX:r,minY:s,maxY:n}}static exportToRLE(e){if(!e.cells||e.cells.length===0)return`x = ${e.width}, y = ${e.height}, rule = ${e.rule||"B3/S23"}
!`;const t=`x = ${e.width}, y = ${e.height}, rule = ${e.rule||"B3/S23"}`,r=new Set(e.cells.map(a=>`${a.x},${a.y}`)),s=[];for(let a=0;a<e.height;a++){let c="",o=0;for(let d=0;d<e.width;d++)r.has(`${d},${a}`)?(o>0&&(c+=o===1?"b":`${o}b`,o=0),c+="o"):o++;o>0&&a<e.height-1&&(c+=o===1?"b":`${o}b`),s.push(c)}for(;s.length>0&&s[s.length-1]==="";)s.pop();let n=s.join("$");return n?n+="!":n="!",`${t}
${n}`}}y(G,"HEADER_REGEX",/^x\s*=\s*(\d+)\s*,\s*y\s*=\s*(\d+)(?:\s*,\s*rule\s*=\s*([^\r\n]+))?/i),y(G,"RLE_PATTERN_REGEX",/^([bo$!]|\d+[bo$!])+$/);class B{static exportToJSON(e,t,r,s,n,a="Exported Pattern"){const c=[];for(let o=0;o<e.length;o++)if(e[o]===1){const d=Math.floor(o/t),u=o%t;c.push(u,d)}return{name:a,created:new Date().toISOString(),grid:{width:t,height:r,data:c},rule:s,generation:n}}static exportJSONToFile(e){const t=JSON.stringify(e,null,2),r=new Blob([t],{type:"application/json"}),s=URL.createObjectURL(r),n=document.createElement("a");n.href=s,n.download=`${this.sanitizeFilename(e.name)}-${this.formatDate(e.created)}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(s)}static exportCanvasToPNG(e,t="grid"){try{e.toBlob(r=>{if(!r)throw new Error("Failed to create image blob");const s=URL.createObjectURL(r),n=document.createElement("a");n.href=s,n.download=`${this.sanitizeFilename(t)}-${this.formatDate(new Date().toISOString())}.png`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(s)},"image/png")}catch(r){throw console.error("PNG export failed:",r),new Error("PNG export not supported in this browser")}}static importFromJSON(e){try{const t=JSON.parse(e);if(!this.validateExportedPattern(t))return{pattern:null,error:"Invalid JSON format"};const r=[],s=t.grid.data;for(let a=0;a<s.length;a+=2){const c=s[a],o=s[a+1];c>=0&&c<t.grid.width&&o>=0&&o<t.grid.height&&r.push({x:c,y:o})}return{pattern:{name:t.name,width:t.grid.width,height:t.grid.height,cells:r,rule:t.rule}}}catch(t){return{pattern:null,error:`JSON parsing error: ${t instanceof Error?t.message:"Unknown error"}`}}}static validateExportedPattern(e){return typeof e=="object"&&e!==null&&typeof e.name=="string"&&typeof e.created=="string"&&typeof e.grid=="object"&&typeof e.grid.width=="number"&&typeof e.grid.height=="number"&&Array.isArray(e.grid.data)&&typeof e.rule=="string"&&typeof e.generation=="number"}static sanitizeFilename(e){return e.replace(/[^a-z0-9\-_]/gi,"_").replace(/_{2,}/g,"_").replace(/^_|_$/g,"").toLowerCase()}static formatDate(e){return new Date(e).toISOString().slice(0,19).replace(/[:.]/g,"-")}}class ne{static placePattern(e,t,r,s,n,a,c={}){const{overwrite:o=!0,merge:d=!1,saveState:u=!0,description:m="Pattern placement"}=c;u&&this.saveState(e,m);const f=A.validatePattern(s);if(!f.valid)return{success:!1,error:f.error||"Pattern validation failed"};if(n<0||a<0||n+s.width>t||a+s.height>r)return{success:!1,error:"Pattern extends beyond grid boundaries"};let g=0;try{for(const w of s.cells){const R=n+w.x,M=a+w.y;if(R>=0&&R<t&&M>=0&&M<r){const S=M*t+R;e[S]===0&&(e[S]=1,g++)}}return{success:!0,affectedCells:g}}catch(w){return{success:!1,error:`Placement failed: ${w instanceof Error?w.message:"Unknown error"}`}}}static centerPattern(e,t,r,s,n={}){const a=Math.floor((t-s.width)/2),c=Math.floor((r-s.height)/2),o=this.placePattern(e,t,r,s,a,c,{...n,description:`Center ${s.name}`});return o.success?{success:!0,position:{x:a,y:c}}:{success:!1,error:o.error||"Pattern placement failed"}}static canPlacePattern(e,t,r,s,n){return s>=0&&n>=0&&s+r.width<=e&&n+r.height<=t}static getPlacementPreview(e,t,r,s,n){return this.canPlacePattern(s,n,e,t,r)?e.cells.map(a=>({x:t+a.x,y:r+a.y})):[]}static clearPattern(e,t,r,s,n,a,c=!0){if(c&&this.saveState(e,`Clear ${s.name}`),!this.canPlacePattern(t,r,s,n,a))return{success:!1,error:"Pattern extends beyond grid boundaries"};let o=0;try{for(const d of s.cells){const u=n+d.x,f=(a+d.y)*t+u;e[f]===1&&(e[f]=0,o++)}return{success:!0,clearedCells:o}}catch(d){return{success:!1,error:`Clear failed: ${d instanceof Error?d.message:"Unknown error"}`}}}static saveState(e,t){const r=new Uint8Array(e.length);r.set(e),this.placementHistory.push({grid:r,timestamp:Date.now(),description:t}),this.placementHistory.length>this.MAX_HISTORY&&this.placementHistory.shift()}static undo(e){if(this.placementHistory.length===0)return{success:!1};const t=this.placementHistory.pop();return e.set(t.grid),{success:!0,description:t.description}}static canUndo(){return this.placementHistory.length>0}static getUndoDescription(){return this.placementHistory.length===0?null:this.placementHistory[this.placementHistory.length-1].description}static clearHistory(){this.placementHistory.length=0}static getBestPlacementPosition(e,t,r,s,n){const a=Math.max(0,Math.min(s-Math.floor(r.width/2),e-r.width)),c=Math.max(0,Math.min(n-Math.floor(r.height/2),t-r.height));return{x:a,y:c}}}y(ne,"placementHistory",[]),y(ne,"MAX_HISTORY",10);const ee=50,qe=200,fe=(i,e)=>new Uint8Array(i*e),Re={grid:{current:fe(ee,ee),width:ee,height:ee,generation:0},simulation:{isRunning:!1,speed:qe,intervalId:null},rule:{birth:[3],survival:[2,3],notation:"B3/S23"},ui:{selectedPattern:null,isDrawing:!1,lastDrawnCell:null,showGrid:!0,patternPlacementMode:!1}},oe=Be((i,e)=>({...Re,setGridSize:(t,r)=>{const s=e();s.simulation.intervalId&&clearInterval(s.simulation.intervalId),i({grid:{current:fe(t,r),width:t,height:r,generation:0},simulation:{...s.simulation,isRunning:!1,intervalId:null}})},setCell:(t,r)=>{const s=e(),n=new Uint8Array(s.grid.current);n[t]=r,i({grid:{...s.grid,current:n}})},toggleCell:t=>{const s=e().grid.current[t];e().setCell(t,s===1?0:1)},clearGrid:()=>{const t=e(),{width:r,height:s}=t.grid;i({grid:{...t.grid,current:fe(r,s),generation:0}})},setRule:t=>{i(()=>({rule:{...t}}))},setSpeed:t=>{i(r=>({simulation:{...r.simulation,speed:t}}))},startSimulation:()=>{const t=e();if(t.simulation.isRunning)return;const r=window.setInterval(()=>{e().stepSimulation()},t.simulation.speed);i({simulation:{...t.simulation,isRunning:!0,intervalId:r}})},stopSimulation:()=>{const t=e();t.simulation.intervalId&&clearInterval(t.simulation.intervalId),i({simulation:{...t.simulation,isRunning:!1,intervalId:null}})},stepSimulation:()=>{const t=e(),{current:r,width:s,height:n,generation:a}=t.grid,{rule:c}=t,d=new he().computeNextGeneration(r,s,n,c);i({grid:{...t.grid,current:d,generation:a+1}})},incrementGeneration:()=>{i(t=>({grid:{...t.grid,generation:t.grid.generation+1}}))},setSelectedPattern:t=>{i(r=>({ui:{...r.ui,selectedPattern:t}}))},setIsDrawing:t=>{i(r=>({ui:{...r.ui,isDrawing:t}}))},setLastDrawnCell:t=>{i(r=>({ui:{...r.ui,lastDrawnCell:t}}))},toggleGridLines:()=>{i(t=>({ui:{...t.ui,showGrid:!t.ui.showGrid}}))},resetState:()=>{const t=e();t.simulation.intervalId!==null&&clearInterval(t.simulation.intervalId),i({...Re})},placePattern:(t,r,s)=>{const n=e(),a=new Uint8Array(n.grid.current),c=ne.placePattern(a,n.grid.width,n.grid.height,t,r,s,{saveState:!1});return c.success?(i({grid:{...n.grid,current:a}}),{success:!0}):{success:!1,error:c.error}},centerPattern:t=>{const r=e(),s=new Uint8Array(r.grid.current),n=ne.centerPattern(s,r.grid.width,r.grid.height,t,{saveState:!1});return n.success?(i({grid:{...r.grid,current:s}}),{success:!0,position:n.position}):{success:!1,error:n.error}},setPatternPlacementMode:(t,r)=>{i(s=>({ui:{...s.ui,patternPlacementMode:t,selectedPattern:r?.name||null}}))}}));/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=i=>i.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Ve=i=>i.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase()),Ce=i=>{const e=Ve(i);return e.charAt(0).toUpperCase()+e.slice(1)},Pe=(...i)=>i.filter((e,t,r)=>!!e&&e.trim()!==""&&r.indexOf(e)===t).join(" ").trim(),Ke=i=>{for(const e in i)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ze={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=h.forwardRef(({color:i="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:r,className:s="",children:n,iconNode:a,...c},o)=>h.createElement("svg",{ref:o,...Ze,width:e,height:e,stroke:i,strokeWidth:r?Number(t)*24/Number(e):t,className:Pe("lucide",s),...!n&&!Ke(c)&&{"aria-hidden":"true"},...c},[...a.map(([d,u])=>h.createElement(d,u)),...Array.isArray(n)?n:[n]]));/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=(i,e)=>{const t=h.forwardRef(({className:r,...s},n)=>h.createElement(Qe,{ref:n,iconNode:e,className:Pe(`lucide-${We(Ce(i))}`,`lucide-${i}`,r),...s}));return t.displayName=Ce(i),t};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],tt=K("info",et);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]],st=K("pause",rt);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]],it=K("play",nt);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const at=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],ot=K("rotate-ccw",at);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lt=[["polygon",{points:"5 4 15 12 5 20 5 4",key:"16p6eg"}],["line",{x1:"19",x2:"19",y1:"5",y2:"19",key:"futhcm"}]],ct=K("skip-forward",lt);let dt={data:""},ut=i=>typeof window=="object"?((i?i.querySelector("#_goober"):window._goober)||Object.assign((i||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:i||dt,ht=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,mt=/\/\*[^]*?\*\/|  +/g,Ee=/\n+/g,F=(i,e)=>{let t="",r="",s="";for(let n in i){let a=i[n];n[0]=="@"?n[1]=="i"?t=n+" "+a+";":r+=n[1]=="f"?F(a,n):n+"{"+F(a,n[1]=="k"?"":e)+"}":typeof a=="object"?r+=F(a,e?e.replace(/([^,])+/g,c=>n.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,o=>/&/.test(o)?o.replace(/&/g,c):c?c+" "+o:o)):n):a!=null&&(n=/^--/.test(n)?n:n.replace(/[A-Z]/g,"-$&").toLowerCase(),s+=F.p?F.p(n,a):n+":"+a+";")}return t+(e&&s?e+"{"+s+"}":s)+r},$={},Te=i=>{if(typeof i=="object"){let e="";for(let t in i)e+=t+Te(i[t]);return e}return i},ft=(i,e,t,r,s)=>{let n=Te(i),a=$[n]||($[n]=(o=>{let d=0,u=11;for(;d<o.length;)u=101*u+o.charCodeAt(d++)>>>0;return"go"+u})(n));if(!$[a]){let o=n!==i?i:(d=>{let u,m,f=[{}];for(;u=ht.exec(d.replace(mt,""));)u[4]?f.shift():u[3]?(m=u[3].replace(Ee," ").trim(),f.unshift(f[0][m]=f[0][m]||{})):f[0][u[1]]=u[2].replace(Ee," ").trim();return f[0]})(i);$[a]=F(s?{["@keyframes "+a]:o}:o,t?"":"."+a)}let c=t&&$.g?$.g:null;return t&&($.g=$[a]),((o,d,u,m)=>{m?d.data=d.data.replace(m,o):d.data.indexOf(o)===-1&&(d.data=u?o+d.data:d.data+o)})($[a],e,r,c),a},pt=(i,e,t)=>i.reduce((r,s,n)=>{let a=e[n];if(a&&a.call){let c=a(t),o=c&&c.props&&c.props.className||/^go/.test(c)&&c;a=o?"."+o:c&&typeof c=="object"?c.props?"":F(c,""):c===!1?"":c}return r+s+(a??"")},"");function le(i){let e=this||{},t=i.call?i(e.p):i;return ft(t.unshift?t.raw?pt(t,[].slice.call(arguments,1),e.p):t.reduce((r,s)=>Object.assign(r,s&&s.call?s(e.p):s),{}):t,ut(e.target),e.g,e.o,e.k)}let je,pe,ge;le.bind({g:1});let D=le.bind({k:1});function gt(i,e,t,r){F.p=e,je=i,pe=t,ge=r}function O(i,e){let t=this||{};return function(){let r=arguments;function s(n,a){let c=Object.assign({},n),o=c.className||s.className;t.p=Object.assign({theme:pe&&pe()},c),t.o=/ *go\d+/.test(o),c.className=le.apply(t,r)+(o?" "+o:"");let d=i;return i[0]&&(d=c.as||i,delete c.as),ge&&d[0]&&ge(c),je(d,c)}return s}}var xt=i=>typeof i=="function",ie=(i,e)=>xt(i)?i(e):i,yt=(()=>{let i=0;return()=>(++i).toString()})(),ke=(()=>{let i;return()=>{if(i===void 0&&typeof window<"u"){let e=matchMedia("(prefers-reduced-motion: reduce)");i=!e||e.matches}return i}})(),vt=20,Ne=(i,e)=>{switch(e.type){case 0:return{...i,toasts:[e.toast,...i.toasts].slice(0,vt)};case 1:return{...i,toasts:i.toasts.map(n=>n.id===e.toast.id?{...n,...e.toast}:n)};case 2:let{toast:t}=e;return Ne(i,{type:i.toasts.find(n=>n.id===t.id)?1:0,toast:t});case 3:let{toastId:r}=e;return{...i,toasts:i.toasts.map(n=>n.id===r||r===void 0?{...n,dismissed:!0,visible:!1}:n)};case 4:return e.toastId===void 0?{...i,toasts:[]}:{...i,toasts:i.toasts.filter(n=>n.id!==e.toastId)};case 5:return{...i,pausedAt:e.time};case 6:let s=e.time-(i.pausedAt||0);return{...i,pausedAt:void 0,toasts:i.toasts.map(n=>({...n,pauseDuration:n.pauseDuration+s}))}}},se=[],U={toasts:[],pausedAt:void 0},H=i=>{U=Ne(U,i),se.forEach(e=>{e(U)})},bt={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},wt=(i={})=>{let[e,t]=h.useState(U),r=h.useRef(U);h.useEffect(()=>(r.current!==U&&t(U),se.push(t),()=>{let n=se.indexOf(t);n>-1&&se.splice(n,1)}),[]);let s=e.toasts.map(n=>{var a,c,o;return{...i,...i[n.type],...n,removeDelay:n.removeDelay||((a=i[n.type])==null?void 0:a.removeDelay)||i?.removeDelay,duration:n.duration||((c=i[n.type])==null?void 0:c.duration)||i?.duration||bt[n.type],style:{...i.style,...(o=i[n.type])==null?void 0:o.style,...n.style}}});return{...e,toasts:s}},St=(i,e="blank",t)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:e,ariaProps:{role:"status","aria-live":"polite"},message:i,pauseDuration:0,...t,id:t?.id||yt()}),Z=i=>(e,t)=>{let r=St(e,i,t);return H({type:2,toast:r}),r.id},j=(i,e)=>Z("blank")(i,e);j.error=Z("error");j.success=Z("success");j.loading=Z("loading");j.custom=Z("custom");j.dismiss=i=>{H({type:3,toastId:i})};j.remove=i=>H({type:4,toastId:i});j.promise=(i,e,t)=>{let r=j.loading(e.loading,{...t,...t?.loading});return typeof i=="function"&&(i=i()),i.then(s=>{let n=e.success?ie(e.success,s):void 0;return n?j.success(n,{id:r,...t,...t?.success}):j.dismiss(r),s}).catch(s=>{let n=e.error?ie(e.error,s):void 0;n?j.error(n,{id:r,...t,...t?.error}):j.dismiss(r)}),i};var Rt=(i,e)=>{H({type:1,toast:{id:i,height:e}})},Ct=()=>{H({type:5,time:Date.now()})},W=new Map,Et=1e3,Mt=(i,e=Et)=>{if(W.has(i))return;let t=setTimeout(()=>{W.delete(i),H({type:4,toastId:i})},e);W.set(i,t)},Pt=i=>{let{toasts:e,pausedAt:t}=wt(i);h.useEffect(()=>{if(t)return;let n=Date.now(),a=e.map(c=>{if(c.duration===1/0)return;let o=(c.duration||0)+c.pauseDuration-(n-c.createdAt);if(o<0){c.visible&&j.dismiss(c.id);return}return setTimeout(()=>j.dismiss(c.id),o)});return()=>{a.forEach(c=>c&&clearTimeout(c))}},[e,t]);let r=h.useCallback(()=>{t&&H({type:6,time:Date.now()})},[t]),s=h.useCallback((n,a)=>{let{reverseOrder:c=!1,gutter:o=8,defaultPosition:d}=a||{},u=e.filter(g=>(g.position||d)===(n.position||d)&&g.height),m=u.findIndex(g=>g.id===n.id),f=u.filter((g,w)=>w<m&&g.visible).length;return u.filter(g=>g.visible).slice(...c?[f+1]:[0,f]).reduce((g,w)=>g+(w.height||0)+o,0)},[e]);return h.useEffect(()=>{e.forEach(n=>{if(n.dismissed)Mt(n.id,n.removeDelay);else{let a=W.get(n.id);a&&(clearTimeout(a),W.delete(n.id))}})},[e]),{toasts:e,handlers:{updateHeight:Rt,startPause:Ct,endPause:r,calculateOffset:s}}},Tt=D`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,jt=D`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,kt=D`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,Nt=O("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${i=>i.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${Tt} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${jt} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${i=>i.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${kt} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,Lt=D`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,It=O("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${i=>i.secondary||"#e0e0e0"};
  border-right-color: ${i=>i.primary||"#616161"};
  animation: ${Lt} 1s linear infinite;
`,$t=D`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,At=D`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,Dt=O("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${i=>i.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${$t} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${At} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${i=>i.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,Ft=O("div")`
  position: absolute;
`,Ot=O("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,zt=D`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,_t=O("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${zt} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,Bt=({toast:i})=>{let{icon:e,type:t,iconTheme:r}=i;return e!==void 0?typeof e=="string"?h.createElement(_t,null,e):e:t==="blank"?null:h.createElement(Ot,null,h.createElement(It,{...r}),t!=="loading"&&h.createElement(Ft,null,t==="error"?h.createElement(Nt,{...r}):h.createElement(Dt,{...r})))},Ut=i=>`
0% {transform: translate3d(0,${i*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,Gt=i=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${i*-150}%,-1px) scale(.6); opacity:0;}
`,Ht="0%{opacity:0;} 100%{opacity:1;}",Jt="0%{opacity:1;} 100%{opacity:0;}",Xt=O("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,Yt=O("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,qt=(i,e)=>{let t=i.includes("top")?1:-1,[r,s]=ke()?[Ht,Jt]:[Ut(t),Gt(t)];return{animation:e?`${D(r)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${D(s)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},Wt=h.memo(({toast:i,position:e,style:t,children:r})=>{let s=i.height?qt(i.position||e||"top-center",i.visible):{opacity:0},n=h.createElement(Bt,{toast:i}),a=h.createElement(Yt,{...i.ariaProps},ie(i.message,i));return h.createElement(Xt,{className:i.className,style:{...s,...t,...i.style}},typeof r=="function"?r({icon:n,message:a}):h.createElement(h.Fragment,null,n,a))});gt(h.createElement);var Vt=({id:i,className:e,style:t,onHeightUpdate:r,children:s})=>{let n=h.useCallback(a=>{if(a){let c=()=>{let o=a.getBoundingClientRect().height;r(i,o)};c(),new MutationObserver(c).observe(a,{subtree:!0,childList:!0,characterData:!0})}},[i,r]);return h.createElement("div",{ref:n,className:e,style:t},s)},Kt=(i,e)=>{let t=i.includes("top"),r=t?{top:0}:{bottom:0},s=i.includes("center")?{justifyContent:"center"}:i.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:ke()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${e*(t?1:-1)}px)`,...r,...s}},Zt=le`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,te=16,Qt=({reverseOrder:i,position:e="top-center",toastOptions:t,gutter:r,children:s,containerStyle:n,containerClassName:a})=>{let{toasts:c,handlers:o}=Pt(t);return h.createElement("div",{id:"_rht_toaster",style:{position:"fixed",zIndex:9999,top:te,left:te,right:te,bottom:te,pointerEvents:"none",...n},className:a,onMouseEnter:o.startPause,onMouseLeave:o.endPause},c.map(d=>{let u=d.position||e,m=o.calculateOffset(d,{reverseOrder:i,gutter:r,defaultPosition:e}),f=Kt(u,m);return h.createElement(Vt,{id:d.id,key:d.id,onHeightUpdate:o.updateHeight,className:d.visible?Zt:"",style:f},d.type==="custom"?ie(d.message,d):s?s(d):h.createElement(Wt,{toast:d,position:u}))}))},re=j;class er{constructor(e){y(this,"canvas");y(this,"ctx");y(this,"devicePixelRatio");y(this,"lastFrameTime",0);y(this,"frameCount",0);y(this,"fps",0);this.canvas=e;const t=e.getContext("2d");if(!t)throw new Error("Canvas 2D context not supported");this.ctx=t,this.devicePixelRatio=window.devicePixelRatio||1,this.setupCanvas()}setupCanvas(){const{canvas:e,ctx:t,devicePixelRatio:r}=this,s=e.getBoundingClientRect();e.width=s.width*r,e.height=s.height*r,t.scale(r,r),e.style.width=`${s.width}px`,e.style.height=`${s.height}px`,t.imageSmoothingEnabled=!1}resize(){this.setupCanvas()}render(e,t,r,s={showGrid:!1}){const n=performance.now(),{canvas:a,ctx:c}=this,o=a.getBoundingClientRect(),d=Math.min(o.width/t,o.height/r);c.fillStyle="#1a1a2a",c.fillRect(0,0,o.width,o.height),c.fillStyle="#00d4ff";for(let u=0;u<e.length;u++)if(e[u]===1){const m=u%t*d,f=Math.floor(u/t)*d;c.fillRect(m,f,d,d)}s.showGrid&&t<=50&&this.renderGridLines(t,r,d),this.updateFPS(n)}renderGridLines(e,t,r){const{ctx:s}=this;s.strokeStyle="#333344",s.lineWidth=1,s.beginPath();for(let n=0;n<=e;n++){const a=n*r;s.moveTo(a,0),s.lineTo(a,t*r)}for(let n=0;n<=t;n++){const a=n*r;s.moveTo(0,a),s.lineTo(e*r,a)}s.stroke()}updateFPS(e){const t=performance.now(),r=t-e;t-this.lastFrameTime>=1e3&&(this.fps=this.frameCount,this.frameCount=0,this.lastFrameTime=t,r>16.67&&console.warn(`Slow render: ${r.toFixed(2)}ms (target: <16.67ms)`)),this.frameCount++}getFPS(){return this.fps}getCellSize(e,t){const r=this.canvas.getBoundingClientRect();return Math.min(r.width/e,r.height/t)}coordinateToCell(e,t,r,s){const n=this.canvas.getBoundingClientRect(),a=this.getCellSize(r,s),c=Math.floor((e-n.left)/a),o=Math.floor((t-n.top)/a);return c>=0&&c<r&&o>=0&&o<s?{x:c,y:o,index:o*r+c}:null}}class tr{constructor(e,t,r,s,n){y(this,"isDrawing",!1);y(this,"lastCell",null);y(this,"canvas");y(this,"onCellChange");y(this,"onDrawingStateChange");y(this,"onLastCellChange");y(this,"getCurrentGrid");y(this,"handleMouseDown",e=>{e.preventDefault(),this.startDrawing(),this.handleCellInteraction(e.clientX,e.clientY)});y(this,"handleMouseMove",e=>{this.isDrawing&&(e.preventDefault(),this.handleCellInteraction(e.clientX,e.clientY))});y(this,"handleMouseUp",e=>{this.stopDrawing()});y(this,"handleMouseLeave",e=>{this.stopDrawing()});y(this,"handleTouchStart",e=>{if(e.preventDefault(),e.touches.length!==1)return;const t=e.touches[0];t&&(this.startDrawing(),this.handleCellInteraction(t.clientX,t.clientY))});y(this,"handleTouchMove",e=>{if(e.preventDefault(),!this.isDrawing||e.touches.length!==1)return;const t=e.touches[0];t&&this.handleCellInteraction(t.clientX,t.clientY)});y(this,"handleTouchEnd",e=>{e.preventDefault(),this.stopDrawing()});this.canvas=e,this.onCellChange=t,this.onDrawingStateChange=r,this.onLastCellChange=s,this.getCurrentGrid=n,this.setupEventListeners()}setupEventListeners(){this.canvas.addEventListener("mousedown",this.handleMouseDown),this.canvas.addEventListener("mousemove",this.handleMouseMove),this.canvas.addEventListener("mouseup",this.handleMouseUp),this.canvas.addEventListener("mouseleave",this.handleMouseLeave),this.canvas.addEventListener("touchstart",this.handleTouchStart,{passive:!1}),this.canvas.addEventListener("touchmove",this.handleTouchMove,{passive:!1}),this.canvas.addEventListener("touchend",this.handleTouchEnd,{passive:!1}),this.canvas.addEventListener("touchcancel",this.handleTouchEnd,{passive:!1})}startDrawing(){this.isDrawing=!0,this.onDrawingStateChange(!0)}stopDrawing(){this.isDrawing=!1,this.lastCell=null,this.onDrawingStateChange(!1),this.onLastCellChange(null)}handleCellInteraction(e,t){const r=this.getTouch(e,t);if(!r||r.cellIndex===null||r.cellIndex===this.lastCell)return;this.lastCell=r.cellIndex,this.onLastCellChange(r.cellIndex);const n=this.getCurrentGridState()[r.cellIndex];this.onCellChange(r.cellIndex,n===1?0:1)}getTouch(e,t){const r=this.canvas.getBoundingClientRect(),s=e-r.left,n=t-r.top;return{x:s,y:n,cellIndex:this.getCellIndex(s,n)}}getCellIndex(e,t){const{width:r,height:s}=this.getGridDimensions(),n=this.getCellSize(),a=Math.floor(e/n),c=Math.floor(t/n);return a>=0&&a<r&&c>=0&&c<s?c*r+a:null}getCellSize(){const{width:e,height:t}=this.getGridDimensions(),r=this.canvas.getBoundingClientRect();return Math.min(r.width/e,r.height/t)}getGridDimensions(){const e=this.canvas;return{width:parseInt(e.dataset.gridWidth||"50"),height:parseInt(e.dataset.gridHeight||"50")}}getCurrentGridState(){return this.getCurrentGrid()}destroy(){this.canvas.removeEventListener("mousedown",this.handleMouseDown),this.canvas.removeEventListener("mousemove",this.handleMouseMove),this.canvas.removeEventListener("mouseup",this.handleMouseUp),this.canvas.removeEventListener("mouseleave",this.handleMouseLeave),this.canvas.removeEventListener("touchstart",this.handleTouchStart),this.canvas.removeEventListener("touchmove",this.handleTouchMove),this.canvas.removeEventListener("touchend",this.handleTouchEnd),this.canvas.removeEventListener("touchcancel",this.handleTouchEnd)}}class rr{constructor(e){y(this,"frameCount",0);y(this,"frameTimeSum",0);y(this,"renderCount",0);y(this,"fps",0);y(this,"lastFPSUpdate",0);y(this,"frameTimes",[]);y(this,"maxFrameTimes",60);y(this,"targetFrameTime",16.67);y(this,"onWarning");this.onWarning=e}startFrame(){return performance.now()}endFrame(e){const t=performance.now(),r=t-e;if(this.frameCount++,this.renderCount++,this.frameTimeSum+=r,this.frameTimes.push(r),this.frameTimes.length>this.maxFrameTimes&&this.frameTimes.shift(),t-this.lastFPSUpdate>=1e3&&(this.fps=this.frameCount,this.frameCount=0,this.lastFPSUpdate=t),r>this.targetFrameTime){const s=this.getMetrics();this.onWarning?.(`Frame time ${r.toFixed(2)}ms exceeds target ${this.targetFrameTime}ms`,s)}}getMetrics(){const e=this.frameTimeSum/Math.max(this.renderCount,1);return{fps:this.fps,frameTime:this.frameTimes[this.frameTimes.length-1]||0,memoryUsage:this.getMemoryUsage(),renderCount:this.renderCount,averageFrameTime:e}}getMemoryUsage(){return"memory"in performance?performance.memory.usedJSHeapSize/1024/1024:0}reset(){this.frameCount=0,this.frameTimeSum=0,this.renderCount=0,this.frameTimes=[],this.lastFPSUpdate=0}isPerformanceGood(){const e=this.getMetrics();return e.fps>=55&&e.averageFrameTime<=this.targetFrameTime*1.2}getPerformanceGrade(){const e=this.getMetrics();return e.fps>=58&&e.averageFrameTime<=this.targetFrameTime?"excellent":e.fps>=50&&e.averageFrameTime<=this.targetFrameTime*1.5?"good":e.fps>=30&&e.averageFrameTime<=this.targetFrameTime*2?"fair":"poor"}createReportString(){const e=this.getMetrics();return[`Performance: ${this.getPerformanceGrade().toUpperCase()}`,`FPS: ${e.fps}`,`Frame Time: ${e.frameTime.toFixed(2)}ms (avg: ${e.averageFrameTime.toFixed(2)}ms)`,`Memory: ${e.memoryUsage.toFixed(1)}MB`,`Renders: ${e.renderCount}`].join(" | ")}}const Le=h.memo(({width:i=400,height:e=400,className:t="",onPerformanceUpdate:r,canvasRef:s})=>{const n=h.useRef(null),a=s||n,c=h.useRef(null),o=h.useRef(null),d=h.useRef(null),u=h.useRef(null),{grid:m,ui:f,setCell:g,setIsDrawing:w,setLastDrawnCell:R}=oe(),M=h.useCallback((p,b)=>{console.warn(`GridCanvas Performance Warning: ${p}`,b),r?.(b)},[r]),S=h.useCallback(()=>{if(a.current)try{c.current=new er(a.current),d.current=new rr(M)}catch(p){console.error("Failed to initialize GridRenderer:",p)}},[M]),P=h.useCallback(()=>{if(!a.current||!c.current)return;const p=(v,E)=>{g(v,E)},b=v=>{w(v)},C=v=>{R(v)},x=()=>m.current;o.current=new tr(a.current,p,b,C,x)},[g,w,R,m]),k=h.useCallback(()=>{if(!c.current||!d.current)return;const p=d.current.startFrame();c.current.render(m.current,m.width,m.height,{showGrid:f.showGrid}),d.current.endFrame(p);const b=d.current.getMetrics();r?.(b)},[m,f.showGrid,r]),T=h.useCallback(()=>{u.current&&cancelAnimationFrame(u.current),u.current=requestAnimationFrame(k)},[k]);return h.useEffect(()=>(S(),()=>{u.current&&cancelAnimationFrame(u.current)}),[S]),h.useEffect(()=>(P(),()=>{o.current?.destroy()}),[P]),h.useEffect(()=>{T()},[T]),h.useEffect(()=>{const p=()=>{c.current?.resize(),T()};return window.addEventListener("resize",p),()=>window.removeEventListener("resize",p)},[T]),h.useEffect(()=>{a.current&&(a.current.dataset.gridWidth=m.width.toString(),a.current.dataset.gridHeight=m.height.toString())},[m.width,m.height]),l.jsx("canvas",{ref:a,width:i,height:e,className:`border border-grid-line cursor-pointer touch-none ${t}`,style:{width:`${i}px`,height:`${e}px`,maxWidth:"100%",maxHeight:"100%"},"aria-label":`Cellular automata grid, ${m.width} by ${m.height} cells, generation ${m.generation}`,role:"img"})});Le.displayName="GridCanvas";const sr=({className:i="",showPerformanceMetrics:e=!1,canvasRef:t})=>{const{grid:r}=oe(),[s,n]=h.useState(null),a=h.useCallback(d=>{n(d)},[]),c=h.useMemo(()=>{const d=r.width/r.height,u=Math.min(window.innerWidth*.8,window.innerHeight*.6,500);let m,f;return d>1?(m=u,f=u/d):(f=u,m=u*d),{width:Math.max(320,Math.min(m,500)),height:Math.max(320,Math.min(f,500))}},[r.width,r.height]),o=h.useMemo(()=>s?s.fps>=58&&s.averageFrameTime<=16.67?{grade:"excellent",color:"text-green-400"}:s.fps>=50&&s.averageFrameTime<=25?{grade:"good",color:"text-blue-400"}:s.fps>=30&&s.averageFrameTime<=33?{grade:"fair",color:"text-yellow-400"}:{grade:"poor",color:"text-red-400"}:null,[s]);return l.jsxs("div",{className:`flex flex-col items-center ${i}`,children:[l.jsxs("div",{className:"relative",children:[l.jsx(Le,{width:c.width,height:c.height,onPerformanceUpdate:a,className:"rounded-lg shadow-lg",canvasRef:t}),e&&s&&l.jsxs("div",{className:"absolute top-2 right-2 bg-black bg-opacity-75 text-white text-xs px-2 py-1 rounded",children:[l.jsx("div",{className:`font-semibold ${o?.color}`,children:o?.grade.toUpperCase()}),l.jsxs("div",{children:["FPS: ",s.fps]}),l.jsxs("div",{children:["Frame: ",s.frameTime.toFixed(1),"ms"]}),s.memoryUsage>0&&l.jsxs("div",{children:["Memory: ",s.memoryUsage.toFixed(1),"MB"]})]})]}),l.jsxs("div",{className:"mt-4 text-center text-sm text-text-secondary",children:[l.jsxs("div",{children:["Grid Size: ",r.width," × ",r.height," cells"]}),l.jsxs("div",{children:["Generation: ",r.generation]}),s&&l.jsxs("div",{className:"mt-1",children:["Rendered ",s.renderCount," frames"]})]})]})},ae=({pattern:i,size:e=64,selected:t=!1,onClick:r,className:s=""})=>{const n=h.useRef(null),[a,c]=h.useState(!1);return h.useEffect(()=>{const o=n.current;if(!o)return;const d=o.getContext("2d");if(!d)return;o.width=e,o.height=e,d.fillStyle="#0a0a0f",d.fillRect(0,0,e,e);const u=Math.min(Math.floor(e/Math.max(i.width,i.height))-1,8);if(u<1)return;const m=Math.floor((e-i.width*u)/2),f=Math.floor((e-i.height*u)/2);d.fillStyle="#00d4ff";for(const g of i.cells){const w=m+g.x*u,R=f+g.y*u;d.fillRect(w,R,u-1,u-1)}(t||a)&&(d.strokeStyle=t?"#00d4ff":"#666",d.lineWidth=t?2:1,d.strokeRect(0,0,e,e))},[i,e,t,a]),l.jsxs("div",{className:`pattern-preview ${s} ${t?"selected":""}`,onClick:r,onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"8px",borderRadius:"8px",backgroundColor:t?"#1a1a2a":"transparent",cursor:r?"pointer":"default",transition:"background-color 0.2s",minWidth:`${e+16}px`},children:[l.jsx("canvas",{ref:n,width:e,height:e,style:{display:"block",borderRadius:"4px",marginBottom:"4px"}}),l.jsx("span",{style:{fontSize:"12px",color:"#ccc",textAlign:"center",wordBreak:"break-word",maxWidth:`${e+16}px`},children:i.name})]})},nr=({onImport:i,onClose:e,className:t=""})=>{const[r,s]=h.useState(""),[n,a]=h.useState(""),[c,o]=h.useState("rle"),[d,u]=h.useState(null),[m,f]=h.useState(""),[g,w]=h.useState(!1),R=h.useRef(null),M=()=>{if(!r.trim()){f("Please enter RLE text");return}w(!0),f("");try{const p=G.import(r);p.pattern?(u(p.pattern),f("")):(f(p.error||"Failed to import RLE pattern"),u(null))}catch(p){f(`Import failed: ${p instanceof Error?p.message:"Unknown error"}`),u(null)}finally{w(!1)}},S=()=>{if(!n.trim()){f("Please enter JSON text");return}w(!0),f("");try{const p=B.importFromJSON(n);p.pattern?(u(p.pattern),f("")):(f(p.error||"Failed to import JSON pattern"),u(null))}catch(p){f(`Import failed: ${p instanceof Error?p.message:"Unknown error"}`),u(null)}finally{w(!1)}},P=p=>{const b=p.target.files?.[0];if(!b)return;w(!0),f("");const C=new FileReader;C.onload=x=>{const v=x.target?.result;if(!v){f("Failed to read file"),w(!1);return}try{let E;b.name.toLowerCase().endsWith(".rle")?E=G.import(v):b.name.toLowerCase().endsWith(".json")?E=B.importFromJSON(v):(E=G.import(v),E.pattern||(E=B.importFromJSON(v))),E.pattern?(u(E.pattern),f("")):(f(E.error||"Failed to import file"),u(null))}catch(E){f(`Import failed: ${E instanceof Error?E.message:"Unknown error"}`),u(null)}finally{w(!1)}},C.onerror=()=>{f("Failed to read file"),w(!1)},C.readAsText(b)},k=()=>{d&&(i(d),e())},T=()=>{s(""),a(""),u(null),f(""),R.current&&(R.current.value="")};return l.jsxs("div",{className:`pattern-import ${t}`,style:{display:"flex",flexDirection:"column",gap:"16px",padding:"20px",backgroundColor:"#1a1a2a",borderRadius:"12px",border:"1px solid #333344",maxWidth:"600px",width:"100%"},children:[l.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[l.jsx("h3",{style:{margin:0,color:"#fff",fontSize:"18px"},children:"Import Pattern"}),l.jsx("button",{onClick:e,style:{background:"none",border:"none",color:"#ccc",fontSize:"18px",cursor:"pointer",padding:"4px 8px"},children:"×"})]}),l.jsx("div",{style:{display:"flex",gap:"8px",marginBottom:"12px"},children:["rle","json","file"].map(p=>l.jsx("button",{onClick:()=>o(p),style:{padding:"8px 16px",border:"1px solid #333344",borderRadius:"6px",backgroundColor:c===p?"#00d4ff":"#2a2a3a",color:c===p?"#000":"#ccc",cursor:"pointer",fontSize:"14px",textTransform:"uppercase"},children:p},p))}),c==="rle"&&l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[l.jsx("label",{style:{color:"#ccc",fontSize:"14px"},children:'RLE Pattern (e.g. "x = 3, y = 3, rule = B3/S23\\nbo$2bo$3o!")'}),l.jsx("textarea",{value:r,onChange:p=>s(p.target.value),placeholder:"Enter RLE pattern...",style:{minHeight:"120px",padding:"12px",borderRadius:"6px",border:"1px solid #333344",backgroundColor:"#2a2a3a",color:"#fff",fontSize:"14px",fontFamily:"monospace",resize:"vertical"}}),l.jsx("button",{onClick:M,disabled:g||!r.trim(),style:{padding:"10px 20px",borderRadius:"6px",border:"none",backgroundColor:g||!r.trim()?"#444":"#00d4ff",color:g||!r.trim()?"#888":"#000",cursor:g||!r.trim()?"not-allowed":"pointer",fontSize:"14px",fontWeight:"bold"},children:g?"Processing...":"Import RLE"})]}),c==="json"&&l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[l.jsx("label",{style:{color:"#ccc",fontSize:"14px"},children:"JSON Pattern (exported from CellularLab)"}),l.jsx("textarea",{value:n,onChange:p=>a(p.target.value),placeholder:"Paste JSON pattern...",style:{minHeight:"120px",padding:"12px",borderRadius:"6px",border:"1px solid #333344",backgroundColor:"#2a2a3a",color:"#fff",fontSize:"14px",fontFamily:"monospace",resize:"vertical"}}),l.jsx("button",{onClick:S,disabled:g||!n.trim(),style:{padding:"10px 20px",borderRadius:"6px",border:"none",backgroundColor:g||!n.trim()?"#444":"#00d4ff",color:g||!n.trim()?"#888":"#000",cursor:g||!n.trim()?"not-allowed":"pointer",fontSize:"14px",fontWeight:"bold"},children:g?"Processing...":"Import JSON"})]}),c==="file"&&l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[l.jsx("label",{style:{color:"#ccc",fontSize:"14px"},children:"Upload File (.rle, .json, or .txt)"}),l.jsx("input",{ref:R,type:"file",accept:".rle,.json,.txt",onChange:P,style:{padding:"12px",borderRadius:"6px",border:"1px solid #333344",backgroundColor:"#2a2a3a",color:"#ccc",fontSize:"14px"}})]}),m&&l.jsx("div",{style:{padding:"12px",borderRadius:"6px",backgroundColor:"#4a1a1a",border:"1px solid #aa3333",color:"#ffaaaa",fontSize:"14px"},children:m}),d&&l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px",padding:"16px",borderRadius:"6px",backgroundColor:"#2a2a3a",border:"1px solid #333344"},children:[l.jsx("div",{style:{color:"#ccc",fontSize:"14px",fontWeight:"bold"},children:"Preview:"}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[l.jsx(ae,{pattern:d,size:80}),l.jsxs("div",{style:{color:"#ccc",fontSize:"14px"},children:[l.jsx("div",{children:l.jsx("strong",{children:d.name})}),l.jsxs("div",{children:["Size: ",d.width," × ",d.height]}),l.jsxs("div",{children:["Cells: ",d.cells.length]}),d.rule&&l.jsxs("div",{children:["Rule: ",d.rule]})]})]}),l.jsxs("div",{style:{display:"flex",gap:"8px"},children:[l.jsx("button",{onClick:k,style:{padding:"10px 20px",borderRadius:"6px",border:"none",backgroundColor:"#00d4ff",color:"#000",cursor:"pointer",fontSize:"14px",fontWeight:"bold"},children:"Import Pattern"}),l.jsx("button",{onClick:T,style:{padding:"10px 20px",borderRadius:"6px",border:"1px solid #666",backgroundColor:"transparent",color:"#ccc",cursor:"pointer",fontSize:"14px"},children:"Clear"})]})]})]})},ir=({grid:i,gridWidth:e,gridHeight:t,rule:r,generation:s,canvasRef:n,onClose:a,className:c=""})=>{const[o,d]=h.useState("json"),[u,m]=h.useState("Custom Pattern"),[f,g]=h.useState(!1),[w,R]=h.useState(""),[M,S]=h.useState(""),P=A.gridToPattern(i,e,t,u);P.rule=r;const k=async()=>{if(!u.trim()){S("Please enter a pattern name");return}g(!0),S(""),R("");try{switch(o){case"json":{const v=B.exportToJSON(i,e,t,r,s,u);B.exportJSONToFile(v),R("JSON file downloaded successfully!");break}case"rle":{const v=G.exportToRLE(P),E=new Blob([v],{type:"text/plain"}),N=URL.createObjectURL(E),L=document.createElement("a");L.href=N,L.download=`${u.replace(/[^a-z0-9\-_]/gi,"_").toLowerCase()}.rle`,document.body.appendChild(L),L.click(),document.body.removeChild(L),URL.revokeObjectURL(N),R("RLE file downloaded successfully!");break}case"png":{if(!n?.current){S("Canvas not available for PNG export");return}B.exportCanvasToPNG(n.current,u),R("PNG image downloaded successfully!");break}default:S("Invalid export mode")}}catch(v){S(`Export failed: ${v instanceof Error?v.message:"Unknown error"}`)}finally{g(!1)}},T=()=>{switch(o){case"json":const v=B.exportToJSON(i,e,t,r,s,u);return JSON.stringify(v,null,2);case"rle":return G.exportToRLE(P);case"png":return"PNG image export (visual representation of current grid)";default:return""}},p=()=>{switch(o){case"json":return".json";case"rle":return".rle";case"png":return".png";default:return""}},b=P.cells.length,C=e*t,x=C>0?(b/C*100).toFixed(1):"0.0";return l.jsxs("div",{className:`pattern-export ${c}`,style:{display:"flex",flexDirection:"column",gap:"16px",padding:"20px",backgroundColor:"#1a1a2a",borderRadius:"12px",border:"1px solid #333344",maxWidth:"700px",width:"100%"},children:[l.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[l.jsx("h3",{style:{margin:0,color:"#fff",fontSize:"18px"},children:"Export Pattern"}),l.jsx("button",{onClick:a,style:{background:"none",border:"none",color:"#ccc",fontSize:"18px",cursor:"pointer",padding:"4px 8px"},children:"×"})]}),l.jsxs("div",{style:{display:"flex",gap:"16px",padding:"16px",borderRadius:"8px",backgroundColor:"#2a2a3a",border:"1px solid #333344"},children:[l.jsx(ae,{pattern:P,size:80}),l.jsxs("div",{style:{color:"#ccc",fontSize:"14px"},children:[l.jsx("div",{style:{marginBottom:"8px"},children:l.jsx("strong",{style:{color:"#fff"},children:"Current Grid"})}),l.jsxs("div",{children:["Size: ",e," × ",t]}),l.jsxs("div",{children:["Living Cells: ",b]}),l.jsxs("div",{children:["Density: ",x,"%"]}),l.jsxs("div",{children:["Generation: ",s]}),l.jsxs("div",{children:["Rule: ",r]})]})]}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[l.jsx("label",{style:{color:"#ccc",fontSize:"14px",fontWeight:"bold"},children:"Pattern Name:"}),l.jsx("input",{type:"text",value:u,onChange:v=>m(v.target.value),placeholder:"Enter pattern name...",style:{padding:"10px 12px",borderRadius:"6px",border:"1px solid #333344",backgroundColor:"#2a2a3a",color:"#fff",fontSize:"14px"}})]}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[l.jsx("label",{style:{color:"#ccc",fontSize:"14px",fontWeight:"bold"},children:"Export Format:"}),l.jsx("div",{style:{display:"flex",gap:"8px"},children:["json","rle","png"].map(v=>l.jsx("button",{onClick:()=>d(v),style:{padding:"8px 16px",border:"1px solid #333344",borderRadius:"6px",backgroundColor:o===v?"#00d4ff":"#2a2a3a",color:o===v?"#000":"#ccc",cursor:"pointer",fontSize:"14px",textTransform:"uppercase"},children:v},v))}),l.jsxs("div",{style:{color:"#888",fontSize:"12px"},children:[o==="json"&&"CellularLab JSON format (can be imported back)",o==="rle"&&"Run Length Encoded format (standard cellular automata format)",o==="png"&&"PNG image of current grid visualization"]})]}),o!=="png"&&l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[l.jsx("label",{style:{color:"#ccc",fontSize:"14px",fontWeight:"bold"},children:"Preview:"}),l.jsx("textarea",{value:T(),readOnly:!0,style:{minHeight:"120px",maxHeight:"200px",padding:"12px",borderRadius:"6px",border:"1px solid #333344",backgroundColor:"#2a2a3a",color:"#ccc",fontSize:"12px",fontFamily:"monospace",resize:"vertical"}})]}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[l.jsxs("div",{style:{color:"#888",fontSize:"12px"},children:["File will be saved as: ",u.replace(/[^a-z0-9\-_]/gi,"_").toLowerCase(),p()]}),l.jsx("button",{onClick:k,disabled:f||!u.trim(),style:{padding:"12px 24px",borderRadius:"6px",border:"none",backgroundColor:f||!u.trim()?"#444":"#00d4ff",color:f||!u.trim()?"#888":"#000",cursor:f||!u.trim()?"not-allowed":"pointer",fontSize:"14px",fontWeight:"bold"},children:f?"Exporting...":`Export ${o.toUpperCase()}`})]}),w&&l.jsx("div",{style:{padding:"12px",borderRadius:"6px",backgroundColor:"#1a4a1a",border:"1px solid #33aa33",color:"#aaffaa",fontSize:"14px"},children:w}),M&&l.jsx("div",{style:{padding:"12px",borderRadius:"6px",backgroundColor:"#4a1a1a",border:"1px solid #aa3333",color:"#ffaaaa",fontSize:"14px"},children:M})]})},ar=({onPatternSelect:i,grid:e,gridWidth:t=50,gridHeight:r=50,rule:s="B3/S23",generation:n=0,canvasRef:a,className:c=""})=>{const[o,d]=h.useState(null),[u,m]=h.useState(!1),[f,g]=h.useState(!1),[w,R]=h.useState(""),M=h.useMemo(()=>A.getAllFamousPatterns(),[]),S=h.useMemo(()=>w.trim()?M.filter(b=>b.name.toLowerCase().includes(w.toLowerCase())):M,[M,w]),P=b=>{d(b)},k=()=>{o&&i(o)},T=b=>{if(!o)return;let C;switch(b){case"rotate90":C=A.rotatePattern(o,90);break;case"rotate180":C=A.rotatePattern(o,180);break;case"rotate270":C=A.rotatePattern(o,270);break;case"flipH":C=A.flipPatternHorizontal(o);break;case"flipV":C=A.flipPatternVertical(o);break;default:return}d(C)},p=b=>{i(b)};return l.jsxs("div",{className:`pattern-library ${c}`,children:[u&&l.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4 backdrop-blur-sm animate-fade-in",children:l.jsx(nr,{onImport:p,onClose:()=>m(!1)})}),f&&e&&l.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4 backdrop-blur-sm animate-fade-in",children:l.jsx(ir,{grid:e,gridWidth:t,gridHeight:r,rule:s,generation:n,canvasRef:a,onClose:()=>g(!1)})}),l.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[l.jsxs("h3",{className:"text-xl font-bold text-text-primary flex items-center gap-2",children:[l.jsx("div",{className:"w-3 h-3 bg-gradient-to-r from-cell-alive to-primary-400 rounded-full"}),"Pattern Library"]}),l.jsxs("div",{className:"flex gap-3",children:[l.jsx("button",{onClick:()=>m(!0),className:"btn-primary flex items-center gap-2 text-sm",children:"Import"}),e&&l.jsx("button",{onClick:()=>g(!0),className:"btn-secondary flex items-center gap-2 text-sm",children:"Export"})]})]}),l.jsx("div",{className:"mb-6",children:l.jsx("input",{type:"text",placeholder:"Search patterns...",value:w,onChange:b=>R(b.target.value),className:"input-field w-full"})}),l.jsxs("div",{className:"flex flex-col gap-4 flex-1 overflow-y-auto",children:[l.jsxs("div",{className:"flex items-center gap-2 text-text-secondary font-semibold",children:[l.jsx("div",{className:"w-2 h-2 bg-cell-alive rounded-full"}),l.jsxs("span",{children:["Famous Patterns (",S.length,")"]})]}),l.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4 p-2",children:S.map(b=>l.jsx(ae,{pattern:b,size:80,selected:o?.name===b.name,onClick:()=>P(b)},b.name))}),S.length===0&&l.jsxs("div",{className:"text-center text-text-tertiary py-12",children:[l.jsx("div",{className:"text-4xl mb-4",children:"🔍"}),l.jsx("p",{className:"text-lg mb-2",children:"No patterns found"}),l.jsxs("p",{className:"text-sm",children:['Try searching for "',w,'"']})]})]}),o&&l.jsx("div",{className:"mt-6 card-elevated p-6 animate-scale-in",children:l.jsxs("div",{className:"flex flex-col lg:flex-row gap-6 items-start",children:[l.jsx("div",{className:"flex-shrink-0",children:l.jsx(ae,{pattern:o,size:120})}),l.jsxs("div",{className:"flex-1 space-y-4",children:[l.jsxs("div",{children:[l.jsx("h4",{className:"text-xl font-bold text-text-primary mb-2",children:o.name}),l.jsxs("div",{className:"text-sm text-text-secondary space-y-1",children:[l.jsxs("div",{children:["Size: ",o.width," × ",o.height]}),l.jsxs("div",{children:["Cells: ",o.cells.length]}),l.jsxs("div",{children:["Rule: ",o.rule||"B3/S23"]})]})]}),l.jsxs("div",{children:[l.jsxs("div",{className:"text-sm font-semibold text-text-secondary mb-3 flex items-center gap-2",children:[l.jsx("div",{className:"w-2 h-2 bg-warning rounded-full"}),"Transformations"]}),l.jsxs("div",{className:"flex flex-wrap gap-2",children:[l.jsx("button",{onClick:()=>T("rotate90"),className:"btn-secondary text-xs px-3 py-1",children:"↻ 90°"}),l.jsx("button",{onClick:()=>T("rotate180"),className:"btn-secondary text-xs px-3 py-1",children:"↻ 180°"}),l.jsx("button",{onClick:()=>T("rotate270"),className:"btn-secondary text-xs px-3 py-1",children:"↻ 270°"}),l.jsx("button",{onClick:()=>T("flipH"),className:"btn-secondary text-xs px-3 py-1",children:"↔ Flip H"}),l.jsx("button",{onClick:()=>T("flipV"),className:"btn-secondary text-xs px-3 py-1",children:"↕ Flip V"})]})]}),l.jsxs("button",{onClick:k,className:"btn-primary flex items-center gap-2",children:[l.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),"Place Pattern"]})]})]})})]})},or=(i={})=>{const{enableKeyboardShortcuts:e=!0,enableScreenReaderAnnouncements:t=!0,enableFocusManagement:r=!0,reducedMotion:s=!1}=i,n=h.useRef(null),a=h.useRef(null),c=h.useRef(""),{simulation:o,grid:d,rule:u,startSimulation:m,stopSimulation:f,stepSimulation:g,clearGrid:w,setRule:R}=oe(),M=h.useCallback(()=>{const x=s||window.matchMedia("(prefers-reduced-motion: reduce)").matches,v=window.matchMedia("(prefers-contrast: high)").matches||window.matchMedia("(prefers-contrast: more)").matches,E=navigator.userAgent.includes("JAWS")||navigator.userAgent.includes("NVDA")||"speechSynthesis"in window;return{isKeyboardNavigation:document.querySelector(":focus-visible")!==null,isScreenReaderActive:E,hasReducedMotion:x,highContrastMode:v}},[s]),S=h.useCallback((x,v="polite")=>{if(!t||!n.current||c.current===x)return;c.current=x;const E=n.current;E.setAttribute("aria-live",v),E.textContent=x,setTimeout(()=>{E.textContent===x&&(E.textContent="")},1e3)},[t]),P=h.useCallback(x=>{if(!e)return;const v=x.ctrlKey||x.metaKey,E=x.target,N=E.tagName==="INPUT"||E.tagName==="TEXTAREA"||E.isContentEditable;if(!(N&&!v))switch(x.code){case"Space":N||(x.preventDefault(),o.isRunning?(f(),S("Simulation paused")):(m(),S("Simulation started")));break;case"ArrowRight":!N&&v&&(x.preventDefault(),g(),S(`Step completed. Generation ${d.generation+1}`));break;case"KeyR":v&&(x.preventDefault(),w(),S("Grid reset to empty state"));break;case"Escape":x.preventDefault();const L=document.querySelector('[role="dialog"]');if(L){const I=L.querySelector('button[aria-label*="close"], button[data-close]');I instanceof HTMLElement&&(I.click(),S("Modal closed"))}break;case"Tab":r&&document.querySelectorAll('button:not([disabled]), [href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"])').length>0&&(a.current=x.target);break;case"Digit1":case"Digit2":case"Digit3":case"Digit4":case"Digit5":if(v){x.preventDefault();const I=[{birth:[3],survival:[2,3],notation:"B3/S23"},{birth:[3,6],survival:[2,3],notation:"B36/S23"},{birth:[2],survival:[],notation:"B2/S"},{birth:[3,6,7,8],survival:[3,4,6,7,8],notation:"B3678/S34678"},{birth:[1],survival:[1],notation:"B1/S1"}],ce=parseInt(x.code.slice(-1))-1;if(ce>=0&&ce<I.length){const de=I[ce];de&&(R(de),S(`Rule changed to ${de.notation}`))}}break;case"KeyH":v&&(x.preventDefault(),k());break}},[e,o.isRunning,d.generation,m,f,g,w,R,S,r]),k=h.useCallback(()=>{const v="Keyboard shortcuts: "+["Space: Play/Pause simulation","Ctrl/Cmd + Right Arrow: Step forward","Ctrl/Cmd + R: Reset grid","Ctrl/Cmd + 1-5: Load preset rules","Escape: Close modals","Tab: Navigate focusable elements","Ctrl/Cmd + H: Show this help"].join(", ");S(v,"assertive"),j(v,{duration:5e3,icon:"⌨️"})},[S]),T=h.useCallback((x,v)=>{!r||!x||(requestAnimationFrame(()=>{x.focus(),v&&S(`Focus moved to ${v}`)}),a.current=x)},[r,S]),p=h.useCallback(x=>{if(!r)return()=>{};const v=x.querySelectorAll('button:not([disabled]), [href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"])'),E=v[0],N=v[v.length-1],L=I=>{I.key==="Tab"&&(I.shiftKey?document.activeElement===E&&(I.preventDefault(),N.focus()):document.activeElement===N&&(I.preventDefault(),E.focus()))};return x.addEventListener("keydown",L),()=>{x.removeEventListener("keydown",L)}},[r]),b=h.useCallback(()=>{if(!t)return null;if(!n.current){const x=document.createElement("div");x.setAttribute("aria-live","polite"),x.setAttribute("aria-atomic","true"),x.setAttribute("aria-relevant","text"),x.style.position="absolute",x.style.left="-10000px",x.style.width="1px",x.style.height="1px",x.style.overflow="hidden",document.body.appendChild(x),n.current=x}return n.current},[t]),C=h.useCallback((x,v)=>{Object.entries(v).forEach(([E,N])=>{x.setAttribute(E,N)})},[]);return h.useEffect(()=>{if(e)return document.addEventListener("keydown",P),()=>document.removeEventListener("keydown",P)},[P,e]),h.useEffect(()=>{const x=b();return()=>{x&&x.parentNode&&(x.parentNode.removeChild(x),n.current=null)}},[b]),h.useEffect(()=>{t&&S(`Cellular automata grid loaded. Size: ${d.width} by ${d.height}. Current rule: ${u.notation}`)},[]),h.useEffect(()=>{if(t&&o.isRunning){const x=setInterval(()=>{S(`Generation ${d.generation}, living cells: ${Array.from(d.current).filter(v=>v===1).length}`)},5e3);return()=>clearInterval(x)}},[o.isRunning,d.generation,d.current,S,t]),{announceToScreenReader:S,manageFocus:T,trapFocus:p,updateAriaProperties:C,showKeyboardShortcuts:k,getAccessibilityState:M,liveRegionRef:n}},z=class z{constructor(){y(this,"options");y(this,"fpsHistory",[]);y(this,"memoryHistory",[]);y(this,"rafId",null);y(this,"isMonitoring",!1);y(this,"onReportCallback");y(this,"warningThresholds");this.options={enableFPSMonitoring:!0,enableMemoryTracking:!0,enableBundleAnalysis:!0,sampleInterval:1e3,maxHistorySize:60},this.warningThresholds={frameRate:60,renderTime:16,memoryUsage:100,startupTime:2e3,targetFPS:60,maxMemoryMB:100,maxLoadTimeMS:2e3,maxBundleSizeMB:5,maxRuleSwitchingMS:50,maxGenerationTimeMS:16},this.setupPerformanceObserver()}static getInstance(){return z.instance||(z.instance=new z),z.instance}setOptions(e){this.options={...this.options,...e}}setReportCallback(e){this.onReportCallback=e}setWarningThresholds(e){this.warningThresholds={...this.warningThresholds,...e}}startMonitoring(){this.isMonitoring||(this.isMonitoring=!0,this.options.enableFPSMonitoring&&this.startFPSMonitoring(),this.options.enableMemoryTracking&&this.startMemoryTracking())}stopMonitoring(){this.isMonitoring&&(this.isMonitoring=!1,this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null))}startFPSMonitoring(){let e=performance.now(),t=0,r=e;const s=n=>{if(!this.isMonitoring)return;t++;const a=n-r;if(a>=1e3){const c=Math.round(t*1e3/a);this.recordFPS(c),t=0,r=n}this.rafId=requestAnimationFrame(s)};this.rafId=requestAnimationFrame(s)}startMemoryTracking(){const e=()=>{if(!this.isMonitoring)return;const t=this.getMemoryInfo();t&&this.recordMemory(t),setTimeout(e,this.options.sampleInterval)};e()}recordFPS(e){this.fpsHistory.push(e),this.fpsHistory.length>this.options.maxHistorySize&&this.fpsHistory.shift(),e<this.warningThresholds.targetFPS*.8&&this.detectPerformanceDegradation()}recordMemory(e){this.memoryHistory.push(e),this.memoryHistory.length>this.options.maxHistorySize&&this.memoryHistory.shift(),e.usedJSHeapSize/1024/1024>this.warningThresholds.maxMemoryMB&&this.detectMemoryLeak()}getMemoryInfo(){const e=performance.memory;return e?{usedJSHeapSize:e.usedJSHeapSize,totalJSHeapSize:e.totalJSHeapSize,jsHeapSizeLimit:e.jsHeapSizeLimit}:null}detectPerformanceDegradation(){const e=this.fpsHistory.slice(-10),t=e.reduce((r,s)=>r+s,0)/e.length;t<this.warningThresholds.targetFPS*.6?(console.warn(`[PerformanceProfiler] Severe FPS degradation detected: ${t}fps`),this.triggerDegradationWarning("severe","Low FPS detected")):t<this.warningThresholds.targetFPS*.8&&(console.warn(`[PerformanceProfiler] Moderate FPS degradation detected: ${t}fps`),this.triggerDegradationWarning("moderate","FPS below target"))}detectMemoryLeak(){if(this.memoryHistory.length<10)return;const e=this.memoryHistory.slice(-10),t=this.calculateMemoryGrowthRate(e);t>5&&(console.warn(`[PerformanceProfiler] Potential memory leak detected: ${t}MB/min growth`),this.triggerDegradationWarning("moderate","Memory usage growing rapidly"))}calculateMemoryGrowthRate(e){if(e.length<2)return 0;const t=e[0],r=e[e.length-1];if(!t||!r)return 0;const s=t.usedJSHeapSize/1024/1024,n=r.usedJSHeapSize/1024/1024,a=(e.length-1)*(this.options.sampleInterval/1e3/60);return(n-s)/a}triggerDegradationWarning(e,t){const r=this.generateReport();r.degradation.detected=!0,r.degradation.severity=e,r.degradation.causes.push(t),this.onReportCallback&&this.onReportCallback(r)}measureOperationTime(e,t){const r=performance.now(),s=e(),a=performance.now()-r;return console.log(`[PerformanceProfiler] ${t}: ${a.toFixed(2)}ms`),t.includes("rule switching")&&a>this.warningThresholds.maxRuleSwitchingMS&&console.warn(`[PerformanceProfiler] Slow rule switching: ${a.toFixed(2)}ms`),t.includes("generation")&&a>this.warningThresholds.maxGenerationTimeMS&&console.warn(`[PerformanceProfiler] Slow generation computation: ${a.toFixed(2)}ms`),s}async measureAsyncOperation(e,t){const r=performance.now(),s=await e(),a=performance.now()-r;return console.log(`[PerformanceProfiler] ${t}: ${a.toFixed(2)}ms`),s}generateReport(){const e=this.getMemoryInfo()||{usedJSHeapSize:0,totalJSHeapSize:0,jsHeapSizeLimit:0},t=this.calculateFPSMetrics(),r=this.calculateMemoryMetrics(e),s=this.getLoadTimeMetrics(),n=this.estimateBundleSize();return{fps:t,memory:r,loadTime:s,bundleSize:n,degradation:{detected:!1,severity:"none",causes:[],recommendations:this.generateRecommendations(t,r)},timestamp:new Date}}calculateFPSMetrics(){if(this.fpsHistory.length===0)return{current:0,average:0,min:0,max:0,history:[]};const e=this.fpsHistory[this.fpsHistory.length-1]||0,t=this.fpsHistory.reduce((n,a)=>n+a,0)/this.fpsHistory.length,r=Math.min(...this.fpsHistory),s=Math.max(...this.fpsHistory);return{current:e,average:Math.round(t),min:r,max:s,history:[...this.fpsHistory]}}calculateMemoryMetrics(e){const t=this.memoryHistory.reduce((n,a)=>a.usedJSHeapSize>n.usedJSHeapSize?a:n,e),r=this.memoryHistory.length>1?this.calculateMemoryGrowthRate(this.memoryHistory):0,s=r>2;return{current:e,peak:t,leaked:s,growthRate:r,history:[...this.memoryHistory]}}getLoadTimeMetrics(){try{const t=(performance.getEntriesByType?performance.getEntriesByType("navigation"):[])[0];return t?{initial:t.loadEventEnd-t.fetchStart,interactive:t.domInteractive-t.fetchStart,complete:t.loadEventEnd-t.fetchStart}:{initial:0,interactive:0,complete:0}}catch{return{initial:0,interactive:0,complete:0}}}estimateBundleSize(){const e=performance.getEntriesByType("resource");let t=0;const r={};return e.forEach(s=>{if(s.name.includes(".js")||s.name.includes(".css")){const n=s.transferSize||s.encodedBodySize||0;t+=n;const a=s.name.split("/").pop()||"unknown";r[a]=n}}),{total:t,chunks:r,estimated:!0}}generateRecommendations(e,t){const r=[];return e.average<this.warningThresholds.targetFPS*.8&&(r.push("Consider reducing grid size for better performance"),r.push("Enable performance mode in settings")),t.current.usedJSHeapSize/1024/1024>this.warningThresholds.maxMemoryMB&&(r.push("Clear grid history to free memory"),r.push("Avoid running simulations for extended periods")),t.leaked&&(r.push("Refresh the page to clear memory leaks"),r.push("Report persistent memory issues")),r}runBenchmarks(){const e=[],t=this.generateReport();e.push({name:"Average FPS",target:this.warningThresholds.targetFPS,current:t.fps.average,status:t.fps.average>=this.warningThresholds.targetFPS?"pass":t.fps.average>=this.warningThresholds.targetFPS*.8?"warning":"fail",impact:"high"});const r=t.memory.current.usedJSHeapSize/1024/1024;e.push({name:"Memory Usage (MB)",target:this.warningThresholds.maxMemoryMB,current:Math.round(r),status:r<=this.warningThresholds.maxMemoryMB?"pass":r<=this.warningThresholds.maxMemoryMB*1.2?"warning":"fail",impact:"medium"}),e.push({name:"Initial Load Time (ms)",target:this.warningThresholds.maxLoadTimeMS,current:Math.round(t.loadTime.initial),status:t.loadTime.initial<=this.warningThresholds.maxLoadTimeMS?"pass":t.loadTime.initial<=this.warningThresholds.maxLoadTimeMS*1.2?"warning":"fail",impact:"medium"});const s=t.bundleSize.total/1024/1024;return e.push({name:"Bundle Size (MB)",target:this.warningThresholds.maxBundleSizeMB,current:Math.round(s*100)/100,status:s<=this.warningThresholds.maxBundleSizeMB?"pass":s<=this.warningThresholds.maxBundleSizeMB*1.1?"warning":"fail",impact:"low"}),e}setupPerformanceObserver(){if("PerformanceObserver"in window)try{new PerformanceObserver(t=>{t.getEntries().forEach(s=>{s.entryType==="measure"&&console.log(`[PerformanceProfiler] ${s.name}: ${s.duration.toFixed(2)}ms`)})}).observe({entryTypes:["measure","navigation","paint"]})}catch{console.warn("[PerformanceProfiler] PerformanceObserver not fully supported")}}markStart(e){performance.mark(`${e}-start`)}markEnd(e){performance.mark(`${e}-end`);try{performance.measure(e,`${e}-start`,`${e}-end`)}catch{console.warn(`[PerformanceProfiler] Failed to measure ${e}`)}}clearMarks(e){e?(performance.clearMarks(`${e}-start`),performance.clearMarks(`${e}-end`),performance.clearMeasures(e)):(performance.clearMarks(),performance.clearMeasures())}getDetailedReport(){const e=this.generateReport(),t=this.runBenchmarks();return`
# Performance Report - ${e.timestamp.toLocaleString()}

## FPS Metrics
- Current: ${e.fps.current} fps
- Average: ${e.fps.average} fps
- Min: ${e.fps.min} fps
- Max: ${e.fps.max} fps

## Memory Usage
- Current: ${Math.round(e.memory.current.usedJSHeapSize/1024/1024)}MB
- Peak: ${Math.round(e.memory.peak.usedJSHeapSize/1024/1024)}MB
- Growth Rate: ${e.memory.growthRate.toFixed(2)}MB/min
- Memory Leak: ${e.memory.leaked?"Detected":"None"}

## Load Performance
- Initial Load: ${Math.round(e.loadTime.initial)}ms
- Interactive: ${Math.round(e.loadTime.interactive)}ms
- Complete: ${Math.round(e.loadTime.complete)}ms

## Bundle Analysis
- Total Size: ${Math.round(e.bundleSize.total/1024/1024*100)/100}MB
- Main Chunks: ${Object.entries(e.bundleSize.chunks).map(([r,s])=>`${r}: ${Math.round(s/1024)}KB`).join(", ")}

## Benchmarks
${t.map(r=>`- ${r.name}: ${r.current}/${r.target} - ${r.status.toUpperCase()}`).join(`
`)}

## Recommendations
${e.degradation.recommendations.map(r=>`- ${r}`).join(`
`)}
`}};y(z,"instance");let xe=z;const X=xe.getInstance();var Ie=(i=>(i.LOW="low",i.MEDIUM="medium",i.HIGH="high",i.CRITICAL="critical",i))(Ie||{});class $e extends Error{constructor(t,r,s="medium",n=void 0,a=!0){super(r);y(this,"code");y(this,"severity");y(this,"context");y(this,"recoverable");this.name="CellularLabError",this.code=t,this.severity=s,this.context=n,this.recoverable=a}}const _=class _{constructor(){y(this,"errorLog",[]);y(this,"maxLogSize",100);y(this,"onErrorCallback")}static getInstance(){return _.instance||(_.instance=new _),_.instance}setErrorCallback(e){this.onErrorCallback=e}getSystemInfo(){return{browserInfo:navigator.userAgent,timestamp:new Date,userAgent:navigator.userAgent}}createErrorInfo(e,t){if(e instanceof $e)return{code:e.code,message:e.message,severity:e.severity,context:{...this.getSystemInfo(),...e.context||{},...t||{}},recoverable:e.recoverable,userMessage:this.getUserMessage(e.code,e.message),recoveryActions:this.getRecoveryActions(e.code)};const r=this.classifyError(e),s=this.determineSeverity(r,e);return{code:r,message:e.message,severity:s,context:{...this.getSystemInfo(),...t||{},stackTrace:e.stack||"No stack trace available"},recoverable:this.isRecoverable(r),userMessage:this.getUserMessage(r,e.message),recoveryActions:this.getRecoveryActions(r)}}classifyError(e){const t=e.message.toLowerCase(),r=e.stack?.toLowerCase()||"";return t.includes("canvas")||t.includes("2d")||t.includes("webgl")?"CANVAS_NOT_SUPPORTED":t.includes("memory")||t.includes("heap")?"MEMORY_EXCEEDED":t.includes("fetch")||t.includes("network")?"NETWORK_ERROR":t.includes("rle")||t.includes("pattern")?"PATTERN_IMPORT_FAILED":t.includes("rule")||t.includes("notation")?"INVALID_RULE_FORMAT":t.includes("grid")&&t.includes("size")?"GRID_SIZE_INVALID":r.includes("gridrenderer")||r.includes("rendering")?"RENDERING_FAILED":r.includes("ruleengine")||r.includes("simulation")?"SIMULATION_ERROR":"UNKNOWN_ERROR"}determineSeverity(e,t){switch(e){case"CANVAS_NOT_SUPPORTED":case"MEMORY_EXCEEDED":return"critical";case"RENDERING_FAILED":case"SIMULATION_ERROR":return"high";case"PATTERN_IMPORT_FAILED":case"INVALID_RULE_FORMAT":case"GRID_SIZE_INVALID":return"medium";case"NETWORK_ERROR":return"low";default:return"medium"}}isRecoverable(e){return!["CANVAS_NOT_SUPPORTED"].includes(e)}getUserMessage(e,t){return{CANVAS_NOT_SUPPORTED:"Your browser does not support HTML5 Canvas, which is required for this application. Please use a modern browser like Chrome, Firefox, Safari, or Edge.",MEMORY_EXCEEDED:"The application has run out of memory. Try reducing the grid size or refreshing the page.",PATTERN_IMPORT_FAILED:"Failed to import the pattern. Please check that the file format is correct (RLE or JSON).",INVALID_RULE_FORMAT:'The rule format is invalid. Please use the format "B3/S23" where numbers represent neighbor counts.',GRID_SIZE_INVALID:"The grid size is too large or invalid. Please choose a size between 20x20 and 200x200.",RENDERING_FAILED:"Failed to render the grid. This may be due to browser limitations or memory constraints.",SIMULATION_ERROR:"An error occurred during simulation. The simulation has been paused.",NETWORK_ERROR:"Network connection failed. Some features may not work properly.",UNKNOWN_ERROR:"An unexpected error occurred. Please try refreshing the page."}[e]||`An error occurred: ${t}`}getRecoveryActions(e){return{CANVAS_NOT_SUPPORTED:["Update your browser to the latest version","Try a different browser (Chrome, Firefox, Safari, Edge)","Enable hardware acceleration in browser settings"],MEMORY_EXCEEDED:["Reduce grid size to 100x100 or smaller","Close other browser tabs","Refresh the page to clear memory","Restart your browser"],PATTERN_IMPORT_FAILED:["Check file format (should be .rle or .json)","Verify file is not corrupted","Try a smaller pattern","Use manual pattern creation instead"],INVALID_RULE_FORMAT:['Use format B[numbers]/S[numbers] (e.g., "B3/S23")',"Check for typos in the rule","Try a preset rule instead","Refer to rule documentation"],GRID_SIZE_INVALID:["Choose size between 20x20 and 200x200","Use preset sizes","Clear browser cache if size persists","Refresh the page"],RENDERING_FAILED:["Reduce grid size","Close other applications using graphics","Update graphics drivers","Try refreshing the page"],SIMULATION_ERROR:["Reset the grid","Try a different rule","Reduce simulation speed","Refresh the page"],NETWORK_ERROR:["Check internet connection","Try again in a few moments","Use offline features only","Contact support if persistent"],UNKNOWN_ERROR:["Refresh the page","Clear browser cache","Try in a different browser","Report the issue if it persists"]}[e]||["Refresh the page","Try again","Contact support if the issue persists"]}handle(e,t){const r=this.createErrorInfo(e,t);return this.logError(r),this.notifyUser(r),this.onErrorCallback&&this.onErrorCallback(r),r}logError(e){console.error(`[CellularLab] ${e.code}: ${e.message}`,e.context),this.errorLog.unshift(e),this.errorLog.length>this.maxLogSize&&(this.errorLog=this.errorLog.slice(0,this.maxLogSize))}notifyUser(e){const t=this.getToastDuration(e.severity),r=this.getErrorIcon(e.severity);j.error(e.userMessage,{duration:t,icon:r,style:{maxWidth:"400px"}}),e.severity==="critical"&&this.showCriticalErrorModal(e)}getToastDuration(e){switch(e){case"low":return 3e3;case"medium":return 5e3;case"high":return 8e3;case"critical":return 0;default:return 5e3}}getErrorIcon(e){switch(e){case"low":return"⚠️";case"medium":return"❗";case"high":return"🚨";case"critical":return"💥";default:return"❗"}}showCriticalErrorModal(e){const t=document.createElement("div");t.className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",t.setAttribute("role","dialog"),t.setAttribute("aria-modal","true"),t.setAttribute("aria-labelledby","error-title"),t.innerHTML=`
      <div class="bg-white dark:bg-gray-800 p-6 rounded-lg max-w-md mx-4 shadow-xl">
        <h2 id="error-title" class="text-xl font-bold text-red-600 dark:text-red-400 mb-4">
          Critical Error
        </h2>
        <p class="text-gray-700 dark:text-gray-300 mb-4">
          ${e.userMessage}
        </p>
        <div class="mb-4">
          <h3 class="font-semibold text-gray-900 dark:text-gray-100 mb-2">
            Try these solutions:
          </h3>
          <ul class="list-disc list-inside text-sm text-gray-600 dark:text-gray-400 space-y-1">
            ${e.recoveryActions?.map(n=>`<li>${n}</li>`).join("")||""}
          </ul>
        </div>
        <div class="flex gap-2">
          <button id="error-close" class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors">
            Close
          </button>
          <button id="error-refresh" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors">
            Refresh Page
          </button>
        </div>
      </div>
    `;const r=t.querySelector("#error-close"),s=t.querySelector("#error-refresh");r?.addEventListener("click",()=>{document.body.removeChild(t)}),s?.addEventListener("click",()=>{window.location.reload()}),document.body.appendChild(t),requestAnimationFrame(()=>{t.querySelector("button")?.focus()})}getErrorLog(){return[...this.errorLog]}clearErrorLog(){this.errorLog=[]}createCanvasNotSupportedFallback(){const e=document.createElement("div");return e.className="flex flex-col items-center justify-center min-h-[400px] p-8 text-center bg-gray-50 dark:bg-gray-900 border-2 border-gray-200 dark:border-gray-700 rounded-lg",e.innerHTML=`
      <div class="text-6xl mb-4">🖥️</div>
      <h2 class="text-2xl font-bold text-gray-900 dark:text-gray-100 mb-4">
        Canvas Not Supported
      </h2>
      <p class="text-gray-600 dark:text-gray-400 mb-6 max-w-md">
        Your browser doesn't support HTML5 Canvas, which is required for this cellular automata simulator.
      </p>
      <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-600 mb-6">
        <h3 class="font-semibold text-gray-900 dark:text-gray-100 mb-2">
          Recommended Browsers:
        </h3>
        <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
          <li>• Chrome 80 or later</li>
          <li>• Firefox 75 or later</li>
          <li>• Safari 13 or later</li>
          <li>• Edge 80 or later</li>
        </ul>
      </div>
      <button onclick="window.location.reload()" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
        Try Again
      </button>
    `,e}checkBrowserSupport(){const e=[];return document.createElement("canvas").getContext||e.push("HTML5 Canvas"),window.localStorage||e.push("Local Storage"),(!window.CSS||!window.CSS.supports||!window.CSS.supports("display","grid"))&&e.push("CSS Grid"),(!window.CSS||!window.CSS.supports||!window.CSS.supports("--custom-property","value"))&&e.push("CSS Custom Properties"),Array.from||e.push("ES2015 Array.from"),Promise||e.push("ES2015 Promises"),{isSupported:e.length===0,missingFeatures:e}}};y(_,"instance");let ye=_;const ve=ye.getInstance(),q=(i,e)=>ve.handle(i,e),lr=(i,e,t="medium",r,s=!0)=>new $e(i,e,t,r,s);function cr(){const i=h.useRef(null),e=h.useRef(null),{grid:t,simulation:r,rule:s,startSimulation:n,stopSimulation:a,stepSimulation:c,clearGrid:o,centerPattern:d,setPatternPlacementMode:u}=oe(),{announceToScreenReader:m,showKeyboardShortcuts:f,getAccessibilityState:g}=or({enableKeyboardShortcuts:!0,enableScreenReaderAnnouncements:!0,enableFocusManagement:!0});h.useEffect(()=>(X.startMonitoring(),X.setWarningThresholds({targetFPS:60,maxMemoryMB:100,maxLoadTimeMS:2e3,maxBundleSizeMB:5,maxRuleSwitchingMS:50,maxGenerationTimeMS:16}),()=>{X.stopMonitoring()}),[]),h.useEffect(()=>{const p=ve.checkBrowserSupport();if(!p.isSupported&&(console.error("Browser support issues:",p.missingFeatures),p.missingFeatures.includes("HTML5 Canvas"))){const b=ve.createCanvasNotSupportedFallback(),C=document.querySelector('[data-testid="grid-container"]');C&&C.parentNode&&C.parentNode.replaceChild(b,C)}},[]);const w=g(),R=h.useCallback(()=>{const p=r.isRunning?"pause":"start";try{X.measureOperationTime(()=>{r.isRunning?a():n()},"simulation toggle");const b=r.isRunning?"Simulation paused":"Simulation started";re.success(b),m(b)}catch(b){const C=q(b,{component:"App",operation:`simulation ${p}`});console.error("Simulation toggle failed:",C)}},[r.isRunning,n,a,m]),M=h.useCallback(()=>{try{X.measureOperationTime(()=>{c()},"generation computation");const p=`Generation ${t.generation+1}`;re.success(p),m(`Step completed. ${p}`)}catch(p){const b=q(p,{component:"App",operation:"step simulation"});console.error("Step simulation failed:",b)}},[c,t.generation,m]),S=h.useCallback(()=>{try{r.isRunning&&a(),X.measureOperationTime(()=>{o()},"grid reset");const p="Grid cleared";re.success(p),m(p)}catch(p){const b=q(p,{component:"App",operation:"reset grid"});console.error("Grid reset failed:",b)}},[r.isRunning,a,o,m]),P=h.useCallback(p=>{try{const b=d(p);if(b.success){const C=`${p.name} placed on grid`;re.success(C),m(C),u(!1)}else{const C=lr("PATTERN_PLACEMENT_FAILED",b.error||"Failed to place pattern",Ie.MEDIUM);q(C,{component:"App",operation:"pattern placement"})}}catch(b){const C=q(b,{component:"App",operation:"pattern placement"});console.error("Pattern placement failed:",C)}},[d,u,m]),k=h.useCallback(()=>{f()},[f]),T=["min-h-screen bg-background text-text-primary",w.highContrastMode&&"high-contrast",w.hasReducedMotion&&"reduce-motion"].filter(Boolean).join(" ");return l.jsxs("div",{ref:e,className:T,"data-testid":"app-root",children:[l.jsxs("div",{className:"container mx-auto px-4 py-6 max-w-7xl",children:[l.jsxs("header",{className:"text-center mb-8 animate-slide-up",children:[l.jsxs("div",{className:"mb-6",children:[l.jsx("h1",{className:"text-4xl md:text-5xl font-bold bg-gradient-to-r from-cell-alive to-primary-400 bg-clip-text text-transparent mb-3 animate-float",children:"CellularLab"}),l.jsx("p",{className:"text-lg text-text-secondary max-w-2xl mx-auto",children:"Interactive Cellular Automata Explorer"}),l.jsx("div",{className:"w-24 h-1 bg-gradient-to-r from-cell-alive to-primary-400 mx-auto mt-4 rounded-full"})]}),l.jsxs("div",{className:"sr-only",children:["Current rule: ",s.notation,". Grid size: ",t.width," by ",t.height,". Generation: ",t.generation,". Press Ctrl+H for keyboard shortcuts."]})]}),l.jsxs("main",{role:"main",className:"grid grid-cols-1 xl:grid-cols-5 gap-8",children:[l.jsx("section",{className:"xl:col-span-4","aria-labelledby":"grid-heading",children:l.jsxs("div",{className:"card p-6 animate-slide-in-from-left",children:[l.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4",children:[l.jsxs("div",{children:[l.jsxs("h2",{id:"grid-heading",className:"text-2xl font-bold text-text-primary mb-2",children:["Grid (",t.width,"×",t.height,")"]}),l.jsx("div",{className:"flex items-center gap-4 text-sm text-text-secondary",children:l.jsxs("div",{className:"flex items-center gap-2","data-testid":"generation","aria-live":"polite","aria-atomic":"true",children:[l.jsx("div",{className:"w-2 h-2 bg-cell-alive rounded-full animate-pulse"}),"Generation: ",l.jsx("span",{className:"font-mono text-text-accent font-semibold",children:t.generation})]})})]}),l.jsxs("div",{className:"flex gap-3",children:[l.jsxs("button",{onClick:R,className:`btn-${r.isRunning?"warning":"primary"} flex items-center gap-2 text-sm`,"aria-pressed":r.isRunning,"aria-label":r.isRunning?"Pause simulation":"Start simulation","data-testid":"play-pause-button",children:[r.isRunning?l.jsx(st,{size:16}):l.jsx(it,{size:16}),r.isRunning?"Pause":"Play"]}),l.jsxs("button",{onClick:M,disabled:r.isRunning,className:"btn-secondary flex items-center gap-2 text-sm disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none disabled:hover:scale-100","aria-label":"Step simulation forward one generation","aria-describedby":r.isRunning?"step-disabled-help":void 0,"data-testid":"step-button",children:[l.jsx(ct,{size:16}),"Step"]}),l.jsxs("button",{onClick:S,className:"btn-danger flex items-center gap-2 text-sm","aria-label":"Reset grid to empty state","data-testid":"reset-button",children:[l.jsx(ot,{size:16}),"Reset"]})]}),r.isRunning&&l.jsx("div",{id:"step-disabled-help",className:"sr-only",children:"Step button is disabled while simulation is running"})]}),l.jsx(sr,{showPerformanceMetrics:!0,canvasRef:i,"aria-label":`Cellular automata grid, ${t.width} by ${t.height} cells, generation ${t.generation}`})]})}),l.jsxs("aside",{className:"space-y-6 animate-slide-in-from-right","aria-label":"Simulation controls and information",children:[l.jsxs("section",{className:"card p-6","aria-labelledby":"rule-heading",children:[l.jsxs("h3",{id:"rule-heading",className:"text-lg font-semibold mb-4 text-text-primary flex items-center gap-2",children:[l.jsx("div",{className:"w-3 h-3 bg-gradient-to-r from-cell-alive to-primary-400 rounded-full"}),"Current Rule"]}),l.jsxs("div",{className:"text-center bg-surface-elevated rounded-xl p-4 border border-grid-line/20",children:[l.jsx("div",{className:"text-3xl font-mono font-bold text-transparent bg-gradient-to-r from-cell-alive to-primary-400 bg-clip-text mb-2","aria-label":`Rule notation: ${s.notation}`,children:s.notation}),l.jsx("div",{className:"text-sm text-text-secondary",children:"Conway's Game of Life"})]})]}),l.jsxs("section",{className:"card p-6","aria-labelledby":"speed-heading",children:[l.jsxs("h3",{id:"speed-heading",className:"text-lg font-semibold mb-4 text-text-primary flex items-center gap-2",children:[l.jsx("div",{className:"w-3 h-3 bg-gradient-to-r from-warning to-warning/60 rounded-full"}),"Simulation Speed"]}),l.jsxs("div",{className:"text-center bg-surface-elevated rounded-xl p-4 border border-grid-line/20",children:[l.jsxs("div",{className:"text-2xl font-mono font-bold text-warning mb-1","aria-label":`${r.speed} milliseconds per generation`,children:[r.speed,"ms"]}),l.jsx("div",{className:"text-sm text-text-secondary",children:"per generation"})]})]}),l.jsxs("section",{className:"card p-6","aria-labelledby":"help-heading",children:[l.jsxs("h3",{id:"help-heading",className:"text-lg font-semibold mb-4 text-text-primary flex items-center gap-2",children:[l.jsx("div",{className:"w-3 h-3 bg-gradient-to-r from-info to-info/60 rounded-full"}),"Help"]}),l.jsxs("button",{onClick:k,className:"btn-secondary w-full flex items-center justify-center gap-2","aria-label":"Show keyboard shortcuts",children:[l.jsx(tt,{size:16}),"Keyboard Shortcuts"]})]})]})]}),l.jsx("section",{className:"mt-12 animate-slide-in-from-bottom","aria-labelledby":"patterns-heading",children:l.jsxs("div",{className:"card-elevated p-8",children:[l.jsx("div",{className:"flex items-center justify-center mb-6",children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:"w-4 h-4 bg-gradient-to-r from-cell-alive to-primary-400 rounded-full animate-pulse"}),l.jsx("h2",{id:"patterns-heading",className:"text-2xl font-bold text-text-primary",children:"Pattern Library"}),l.jsx("div",{className:"w-4 h-4 bg-gradient-to-r from-primary-400 to-cell-alive rounded-full animate-pulse"})]})}),l.jsx(ar,{onPatternSelect:P,grid:t.current,gridWidth:t.width,gridHeight:t.height,rule:s.notation,generation:t.generation,canvasRef:i})]})})]}),!1]})}const Ae=document.getElementById("root");if(!Ae)throw new Error("Root element not found");Ye.createRoot(Ae).render(l.jsxs(Ue.StrictMode,{children:[l.jsx(cr,{}),l.jsx(Qt,{position:"top-right",toastOptions:{duration:3e3,style:{background:"#1e1e2f",color:"#ffffff",border:"1px solid #333344"}}})]}));
